<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <meta name="description" content="HVAC Sales-to-Install Material List Generator">
  <title>Field Buddy - Install Material List</title>
  <style>
    /* ==================== BASE STYLES ==================== */
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    body { 
      font: 16px -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
      padding: 8px;
      padding-bottom: 80px;
      color: #1a1a1a;
    }
    
    /* ==================== INPUTS ==================== */
    input, select, textarea, button {
      font-size: 16px;
      padding: 14px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 100%;
      margin: 8px 0;
      font-family: inherit;
      -webkit-appearance: none;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #007AFF;
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: 1.5;
    }
    
    input[readonly] {
      background: #f8f8f8;
      color: #666;
      cursor: not-allowed;
    }
    
    input[type="checkbox"] {
      width: 28px;
      height: 28px;
      margin-right: 12px;
      cursor: pointer;
      accent-color: #007AFF;
    }
    
    label {
      display: block;
      font-size: 13px;
      color: #666;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    label.check {
      display: flex;
      align-items: center;
      font-size: 15px;
      color: #1a1a1a;
      margin: 10px 0;
      padding: 12px;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
    }
    
    label.check:hover {
      background: #f8f8f8;
      border-color: #007AFF;
    }
    
    label.check input:checked {
      accent-color: #34C759;
    }
    
    label.check.checked {
      background: #e3f2fd;
      border-color: #007AFF;
    }
    
    /* ==================== BUTTONS ==================== */
    button {
      background: #007AFF;
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.2s;
    }
    
    button:active {
      opacity: 0.7;
      transform: scale(0.98);
    }
    
    button.secondary { background: #8E8E93; }
    button.success { background: #34C759; }
    button.danger { background: #FF3B30; }
    button.warning { background: #FF9500; }
    button.small { 
      padding: 10px 14px;
      font-size: 14px;
      min-height: 40px;
    }
    
    /* ==================== CARDS ==================== */
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .card-header {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card-subheader {
      font-size: 15px;
      font-weight: 600;
      color: #007AFF;
      margin: 16px 0 8px 0;
      padding-top: 12px;
      border-top: 1px solid #e0e0e0;
    }
    
    /* ==================== GRID LAYOUTS ==================== */
    .grid-2 { 
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .grid-3 { 
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }
    
    .grid-4 { 
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    
    @media (max-width: 640px) {
      .grid-2, .grid-3, .grid-4 {
        grid-template-columns: 1fr;
      }
    }
    
    /* ==================== DYNAMIC FIELDS ==================== */
    .dynamic-item {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      border: 1px solid #e0e0e0;
      position: relative;
    }
    
    .dynamic-item .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #FF3B30;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: unset;
      padding: 0;
    }
    
    .add-btn {
      background: #34C759;
      margin-top: 8px;
    }
    
    /* ==================== STATUS INDICATORS ==================== */
    .status {
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.4;
    }
    
    .status.good { 
      background: #D1F4E0; 
      color: #0F5132; 
      border-left: 4px solid #34C759;
    }
    
    .status.warn { 
      background: #FFF3CD; 
      color: #664D03; 
      border-left: 4px solid #FF9500;
    }
    
    .status.info {
      background: #D1ECF1;
      color: #0C5460;
      border-left: 4px solid #007AFF;
    }
    
    /* ==================== COLLAPSIBLE SECTIONS ==================== */
    .section {
      margin: 16px 0;
    }
    
    .section-toggle {
      background: white;
      border: 2px solid #ddd;
      color: #1a1a1a;
      font-weight: 600;
      padding: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      border-radius: 8px;
      margin: 8px 0;
      transition: all 0.2s;
    }
    
    .section-toggle:hover {
      background: #f8f8f8;
      border-color: #007AFF;
    }
    
    .section-toggle .arrow {
      font-size: 18px;
      transition: transform 0.2s;
    }
    
    .section.open .arrow {
      transform: rotate(180deg);
    }
    
    .section-content {
      display: none;
      background: white;
      padding: 16px;
      border-radius: 0 0 8px 8px;
      border: 2px solid #ddd;
      border-top: none;
      margin-top: -8px;
    }
    
    .section.open .section-content {
      display: block;
    }
    
    /* ==================== MATERIAL LIST OUTPUT ==================== */
    .material-list-output {
      background: #f8f8f8;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-x: auto;
      margin: 12px 0;
      border: 1px solid #ddd;
    }
    
    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin: 4px 0;
      padding: 4px 0;
    }
    
    .checklist-item::before {
      content: '‚òê';
      font-size: 18px;
      color: #666;
    }
    
    /* ==================== STICKY ACTION BAR ==================== */
    .actions {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 10px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      display: flex;
      gap: 8px;
      z-index: 100;
    }
    
    .actions button {
      flex: 1;
      font-size: 14px;
      padding: 12px 8px;
    }
    
    /* ==================== HIDDEN ==================== */
    .hidden { display: none !important; }
    
    /* ==================== UTILITY ==================== */
    .mt-8 { margin-top: 8px; }
    .mt-16 { margin-top: 16px; }
    .mb-8 { margin-bottom: 8px; }
    .text-muted { color: #666; font-size: 13px; }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="card">
    <div class="card-header">
      <div>
        <div style="font-size: 20px;">‚ö° Field Buddy</div>
        <div style="font-size: 12px; color: #666; font-weight: 400; margin-top: 4px;">Install Material List Generator</div>
      </div>
    </div>
    <div class="status info">
      <span>‚ÑπÔ∏è</span>
      <span>Create detailed material lists for install crews - prevent truck rolls and delays</span>
    </div>
  </div>

  <!-- Job Info -->
  <div class="card">
    <div class="card-header">
      <span>üìã Job Information</span>
    </div>
    
    <label>Customer Name</label>
    <input type="text" id="customer" placeholder="Full name">
    
    <label>Address</label>
    <input type="text" id="address" placeholder="Street, City, State">
    
    <div class="grid-2">
      <div>
        <label>Sold By (Sales Tech)</label>
        <input type="text" id="sales-tech" placeholder="Your name">
      </div>
      <div>
        <label>Sale Date</label>
        <input type="date" id="sale-date">
      </div>
    </div>
    
    <div class="grid-2">
      <div>
        <label>Scheduled Install Date</label>
        <input type="date" id="install-date">
      </div>
      <div>
        <label>Estimated Labor Hours</label>
        <input type="number" id="labor-hours" step="0.5" placeholder="e.g., 6.5">
      </div>
    </div>
  </div>

  <!-- Equipment Selection -->
  <div class="card">
    <div class="card-header">
      <span>‚öôÔ∏è Equipment Being Installed</span>
    </div>
    
    <div class="status warn">
      <span>‚ö†Ô∏è</span>
      <span>Check ALL items being replaced/installed</span>
    </div>
    
    <label class="check">
      <input type="checkbox" id="equip-condenser" onchange="toggleEquipmentSection('condenser')">
      <span>Condenser (Outdoor Unit)</span>
    </label>
    
    <div id="section-condenser" class="hidden mt-8">
      <div class="grid-2">
        <div>
          <label>Brand</label>
          <select id="condenser-brand">
            <option value="">Select brand...</option>
            <option value="carrier">Carrier</option>
            <option value="trane">Trane</option>
            <option value="lennox">Lennox</option>
            <option value="rheem">Rheem</option>
            <option value="goodman">Goodman</option>
            <option value="york">York</option>
            <option value="american-standard">American Standard</option>
            <option value="bryant">Bryant</option>
            <option value="daikin">Daikin</option>
          </select>
        </div>
        <div>
          <label>Tonnage</label>
          <select id="condenser-tonnage">
            <option value="">Select...</option>
            <option value="1.5">1.5 Ton</option>
            <option value="2">2 Ton</option>
            <option value="2.5">2.5 Ton</option>
            <option value="3">3 Ton</option>
            <option value="3.5">3.5 Ton</option>
            <option value="4">4 Ton</option>
            <option value="5">5 Ton</option>
          </select>
        </div>
      </div>
      <div class="grid-2">
        <div>
          <label>SEER Rating</label>
          <select id="condenser-seer">
            <option value="">Select...</option>
            <option value="14">14 SEER</option>
            <option value="15">15 SEER</option>
            <option value="16">16 SEER</option>
            <option value="17">17 SEER</option>
            <option value="18">18 SEER</option>
            <option value="20">20 SEER</option>
          </select>
        </div>
        <div>
          <label>Model Number</label>
          <input type="text" id="condenser-model" placeholder="e.g., 24ACC636">
        </div>
      </div>
      <label>Line Set Required</label>
      <div class="grid-2">
        <select id="condenser-lineset-size">
          <option value="">Select size...</option>
          <option value="1/4-3/8">1/4" x 3/8"</option>
          <option value="1/4-1/2">1/4" x 1/2"</option>
          <option value="3/8-3/4">3/8" x 3/4"</option>
          <option value="3/8-7/8">3/8" x 7/8"</option>
        </select>
        <input type="number" id="condenser-lineset-length" placeholder="Length (ft)" min="15">
      </div>
    </div>
    
    <label class="check">
      <input type="checkbox" id="equip-evap-coil" onchange="toggleEquipmentSection('evap-coil')">
      <span>Evaporator Coil</span>
    </label>
    
    <div id="section-evap-coil" class="hidden mt-8">
      <div class="grid-2">
        <div>
          <label>Brand</label>
          <select id="evap-brand">
            <option value="">Select brand...</option>
            <option value="carrier">Carrier</option>
            <option value="trane">Trane</option>
            <option value="lennox">Lennox</option>
            <option value="rheem">Rheem</option>
            <option value="goodman">Goodman</option>
          </select>
        </div>
        <div>
          <label>Tonnage</label>
          <select id="evap-tonnage">
            <option value="">Select...</option>
            <option value="1.5">1.5 Ton</option>
            <option value="2">2 Ton</option>
            <option value="2.5">2.5 Ton</option>
            <option value="3">3 Ton</option>
            <option value="3.5">3.5 Ton</option>
            <option value="4">4 Ton</option>
            <option value="5">5 Ton</option>
          </select>
        </div>
      </div>
      <div class="grid-2">
        <div>
          <label>Orientation</label>
          <select id="evap-orientation">
            <option value="">Select...</option>
            <option value="vertical">Vertical Slab</option>
            <option value="horizontal">Horizontal Slab</option>
            <option value="a-coil">A-Coil</option>
            <option value="n-coil">N-Coil</option>
          </select>
        </div>
        <div>
          <label>Model Number</label>
          <input type="text" id="evap-model" placeholder="e.g., CNPVP3617">
        </div>
      </div>
    </div>
    
    <label class="check">
      <input type="checkbox" id="equip-air-handler" onchange="toggleEquipmentSection('air-handler')">
      <span>Air Handler</span>
    </label>
    
    <div id="section-air-handler" class="hidden mt-8">
      <div class="grid-2">
        <div>
          <label>Brand</label>
          <select id="air-handler-brand">
            <option value="">Select brand...</option>
            <option value="carrier">Carrier</option>
            <option value="trane">Trane</option>
            <option value="lennox">Lennox</option>
            <option value="rheem">Rheem</option>
            <option value="goodman">Goodman</option>
          </select>
        </div>
        <div>
          <label>Tonnage</label>
          <select id="air-handler-tonnage">
            <option value="">Select...</option>
            <option value="2">2 Ton</option>
            <option value="2.5">2.5 Ton</option>
            <option value="3">3 Ton</option>
            <option value="3.5">3.5 Ton</option>
            <option value="4">4 Ton</option>
            <option value="5">5 Ton</option>
          </select>
        </div>
      </div>
      <div class="grid-2">
        <div>
          <label>Type</label>
          <select id="air-handler-type">
            <option value="">Select...</option>
            <option value="multi-speed">Multi-Speed</option>
            <option value="variable-speed">Variable Speed</option>
            <option value="ecm">ECM Motor</option>
          </select>
        </div>
        <div>
          <label>Model Number</label>
          <input type="text" id="air-handler-model" placeholder="e.g., FE4ANB006">
        </div>
      </div>
    </div>
    
    <label class="check">
      <input type="checkbox" id="equip-furnace" onchange="toggleEquipmentSection('furnace')">
      <span>Furnace</span>
    </label>
    
    <div id="section-furnace" class="hidden mt-8">
      <div class="grid-2">
        <div>
          <label>Brand</label>
          <select id="furnace-brand">
            <option value="">Select brand...</option>
            <option value="carrier">Carrier</option>
            <option value="trane">Trane</option>
            <option value="lennox">Lennox</option>
            <option value="rheem">Rheem</option>
            <option value="goodman">Goodman</option>
            <option value="york">York</option>
          </select>
        </div>
        <div>
          <label>BTU Input</label>
          <select id="furnace-btu">
            <option value="">Select...</option>
            <option value="40000">40,000 BTU</option>
            <option value="60000">60,000 BTU</option>
            <option value="80000">80,000 BTU</option>
            <option value="100000">100,000 BTU</option>
            <option value="120000">120,000 BTU</option>
          </select>
        </div>
      </div>
      <div class="grid-2">
        <div>
          <label>Efficiency</label>
          <select id="furnace-efficiency">
            <option value="">Select...</option>
            <option value="80">80% AFUE (Single Stage)</option>
            <option value="92">92% AFUE (Two Stage)</option>
            <option value="96">96% AFUE (Modulating)</option>
            <option value="98">98% AFUE (Condensing)</option>
          </select>
        </div>
        <div>
          <label>Model Number</label>
          <input type="text" id="furnace-model" placeholder="e.g., 58MCA">
        </div>
      </div>
    </div>
  </div>

  <!-- Plenum & Ductwork -->
  <div class="section">
    <div class="section-toggle" onclick="toggleSection('plenum-ductwork')">
      <span>üå¨Ô∏è Plenum & Ductwork Modifications</span>
      <span class="arrow">‚ñº</span>
    </div>
    <div class="section-content" id="section-plenum-ductwork">
      
      <label class="check">
        <input type="checkbox" id="plenum-supply" onchange="toggleSubSection('supply-plenum-fields')">
        <span>Supply Plenum Replacement</span>
      </label>
      
      <div id="supply-plenum-fields" class="hidden mt-8">
        <label>Supply Plenum Dimensions</label>
        <div class="grid-3">
          <input type="number" id="supply-width" placeholder="Width (in)" min="10" max="36">
          <input type="number" id="supply-height" placeholder="Height (in)" min="10" max="36">
          <input type="number" id="supply-length" placeholder="Length (in)" min="12" max="72">
        </div>
        <label>Sheet Metal Gauge</label>
        <select id="supply-gauge">
          <option value="26ga">26 Gauge</option>
          <option value="24ga">24 Gauge</option>
          <option value="22ga">22 Gauge</option>
        </select>
      </div>
      
      <label class="check mt-16">
        <input type="checkbox" id="plenum-return" onchange="toggleSubSection('return-plenum-fields')">
        <span>Return Plenum Replacement</span>
      </label>
      
      <div id="return-plenum-fields" class="hidden mt-8">
        <label>Return Plenum Dimensions</label>
        <div class="grid-3">
          <input type="number" id="return-width" placeholder="Width (in)" min="14" max="36">
          <input type="number" id="return-height" placeholder="Height (in)" min="14" max="36">
          <input type="number" id="return-length" placeholder="Length (in)" min="12" max="48">
        </div>
        <label>Sheet Metal Gauge</label>
        <select id="return-gauge">
          <option value="26ga">26 Gauge</option>
          <option value="24ga">24 Gauge</option>
          <option value="22ga">22 Gauge</option>
        </select>
      </div>
      
      <div class="card-subheader">Collar Schedule</div>
      <div class="status info">
        <span>‚ÑπÔ∏è</span>
        <span>Add all collars needed for supply and return connections</span>
      </div>
      
      <div id="collar-list"></div>
      <button class="add-btn small" onclick="addCollar()">+ Add Collar</button>
      
      <div class="card-subheader">Flex Duct Runs</div>
      <div id="flex-duct-list"></div>
      <button class="add-btn small" onclick="addFlexDuct()">+ Add Flex Duct Run</button>
      
      <div class="card-subheader">Registers & Grilles</div>
      <div id="register-list"></div>
      <button class="add-btn small" onclick="addRegister()">+ Add Register/Grille</button>
      
    </div>
  </div>

  <!-- IAQ Upgrades -->
  <div class="section">
    <div class="section-toggle" onclick="toggleSection('iaq-upgrades')">
      <span>üí® Indoor Air Quality Upgrades</span>
      <span class="arrow">‚ñº</span>
    </div>
    <div class="section-content" id="section-iaq-upgrades">
      
      <label class="check">
        <input type="checkbox" id="iaq-reme-halo">
        <span>REME HALO (Standard)</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="iaq-reme-halo-led">
        <span>REME HALO LED (Low Maintenance)</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="iaq-uv-light">
        <span>UV Light System</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="iaq-media-filter" onchange="toggleSubSection('media-filter-fields')">
        <span>Media Filter Cabinet</span>
      </label>
      
      <div id="media-filter-fields" class="hidden mt-8">
        <label>Filter Cabinet Size</label>
        <select id="media-filter-size">
          <option value="">Select size...</option>
          <option value="16x25">16x25</option>
          <option value="20x25">20x25</option>
          <option value="20x20">20x20</option>
        </select>
        <label>MERV Rating</label>
        <select id="media-filter-merv">
          <option value="11">MERV 11</option>
          <option value="13">MERV 13</option>
          <option value="16">MERV 16</option>
        </select>
      </div>
      
      <label class="check">
        <input type="checkbox" id="iaq-bipolar">
        <span>Bipolar Ionization</span>
      </label>
      
      <label class="mt-16">Other IAQ Equipment</label>
      <textarea id="iaq-other" placeholder="Specify any other air quality upgrades" rows="2"></textarea>
      
    </div>
  </div>

  <!-- Drain & Safety -->
  <div class="section">
    <div class="section-toggle" onclick="toggleSection('drain-safety')">
      <span>üíß Drain System & Safety Devices</span>
      <span class="arrow">‚ñº</span>
    </div>
    <div class="section-content" id="section-drain-safety">
      
      <label class="check">
        <input type="checkbox" id="drain-emergency-pan">
        <span>Emergency Drain Pan</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="drain-float-primary">
        <span>Float Switch (Primary)</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="drain-float-secondary">
        <span>Float Switch (Secondary/Pan)</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="drain-pump">
        <span>Condensate Pump</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="drain-pvc-work" onchange="toggleSubSection('pvc-work-fields')">
        <span>PVC Drain Line Work</span>
      </label>
      
      <div id="pvc-work-fields" class="hidden mt-8">
        <div class="grid-2">
          <div>
            <label>PVC Size</label>
            <select id="pvc-size">
              <option value="3/4">3/4"</option>
              <option value="1">1"</option>
              <option value="1-1/4">1-1/4"</option>
            </select>
          </div>
          <div>
            <label>Length Needed (ft)</label>
            <input type="number" id="pvc-length" placeholder="e.g., 25" min="1">
          </div>
        </div>
        <label class="check">
          <input type="checkbox" id="pvc-trap">
          <span>P-Trap Required</span>
        </label>
      </div>
      
    </div>
  </div>

  <!-- Electrical Materials -->
  <div class="section">
    <div class="section-toggle" onclick="toggleSection('electrical')">
      <span>‚ö° Electrical Materials</span>
      <span class="arrow">‚ñº</span>
    </div>
    <div class="section-content" id="section-electrical">
      
      <label class="check">
        <input type="checkbox" id="elec-disconnect" onchange="toggleSubSection('disconnect-fields')">
        <span>Disconnect Box</span>
      </label>
      
      <div id="disconnect-fields" class="hidden mt-8">
        <label>Disconnect Rating</label>
        <select id="disconnect-rating">
          <option value="">Select...</option>
          <```html
          <option value="30A-nf">30A Non-Fused</option>
          <option value="60A-nf">60A Non-Fused</option>
          <option value="30A-fused">30A Fused Pull-Out</option>
          <option value="60A-fused">60A Fused Pull-Out</option>
        </select>
      </div>
      
      <label class="check">
        <input type="checkbox" id="elec-breaker" onchange="toggleSubSection('breaker-fields')">
        <span>New Breaker Required</span>
      </label>
      
      <div id="breaker-fields" class="hidden mt-8">
        <label>Breaker Size</label>
        <select id="breaker-size">
          <option value="">Select...</option>
          <option value="15A-1P">15A Single Pole</option>
          <option value="20A-1P">20A Single Pole</option>
          <option value="30A-2P">30A Double Pole</option>
          <option value="40A-2P">40A Double Pole</option>
          <option value="50A-2P">50A Double Pole</option>
          <option value="60A-2P">60A Double Pole</option>
        </select>
      </div>
      
      <label class="check">
        <input type="checkbox" id="elec-wire-run" onchange="toggleSubSection('wire-run-fields')">
        <span>Power Wire Run</span>
      </label>
      
      <div id="wire-run-fields" class="hidden mt-8">
        <div class="grid-3">
          <div>
            <label>Wire Size</label>
            <select id="wire-gauge">
              <option value="">Select...</option>
              <option value="14/2">14/2 w/Ground</option>
              <option value="12/2">12/2 w/Ground</option>
              <option value="10/2">10/2 w/Ground</option>
              <option value="10/3">10/3 w/Ground</option>
              <option value="8/2">8/2 w/Ground</option>
            </select>
          </div>
          <div>
            <label>Type</label>
            <select id="wire-type">
              <option value="romex">Romex</option>
              <option value="thhn">THHN in Conduit</option>
            </select>
          </div>
          <div>
            <label>Length (ft)</label>
            <input type="number" id="wire-length" placeholder="e.g., 50" min="1">
          </div>
        </div>
      </div>
      
      <label class="check">
        <input type="checkbox" id="elec-tstat-wire" onchange="toggleSubSection('tstat-wire-fields')">
        <span>Thermostat Wire</span>
      </label>
      
      <div id="tstat-wire-fields" class="hidden mt-8">
        <div class="grid-2">
          <div>
            <label>Wire Type</label>
            <select id="tstat-wire-type">
              <option value="">Select...</option>
              <option value="18/5">18/5 (5-conductor)</option>
              <option value="18/7">18/7 (7-conductor)</option>
              <option value="18/8">18/8 (8-conductor)</option>
            </select>
          </div>
          <div>
            <label>Length (ft)</label>
            <input type="number" id="tstat-wire-length" placeholder="e.g., 75" min="1">
          </div>
        </div>
      </div>
      
      <label class="check mt-16">
        <input type="checkbox" id="elec-thermostat" onchange="toggleSubSection('thermostat-fields')">
        <span>New Thermostat</span>
      </label>
      
      <div id="thermostat-fields" class="hidden mt-8">
        <label>Thermostat Model</label>
        <select id="thermostat-model">
          <option value="">Select...</option>
          <option value="ecobee-smart">Ecobee SmartThermostat</option>
          <option value="honeywell-t6">Honeywell T6 Pro</option>
          <option value="nest-learning">Nest Learning</option>
          <option value="carrier-cor">Carrier Cor WiFi</option>
          <option value="basic-programmable">Basic Programmable</option>
          <option value="basic-non-prog">Basic Non-Programmable</option>
        </select>
      </div>
      
    </div>
  </div>

  <!-- Mounting & Accessories -->
  <div class="section">
    <div class="section-toggle" onclick="toggleSection('mounting')">
      <span>üîß Mounting & Accessories</span>
      <span class="arrow">‚ñº</span>
    </div>
    <div class="section-content" id="section-mounting">
      
      <label class="check">
        <input type="checkbox" id="mount-pad">
        <span>Equipment Pad/Stand</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="mount-vibration">
        <span>Vibration Isolators</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="mount-hangers">
        <span>Duct Hangers/Straps</span>
      </label>
      
      <label>Sealing Materials</label>
      <div class="grid-2">
        <div>
          <label>Mastic (quarts)</label>
          <input type="number" id="mastic-qty" placeholder="e.g., 2" min="0" step="0.5">
        </div>
        <div>
          <label>Foil Tape (rolls)</label>
          <input type="number" id="foil-tape-qty" placeholder="e.g., 2" min="0">
        </div>
      </div>
      
      <label class="mt-16">Other Materials/Notes</label>
      <textarea id="other-materials" placeholder="Sheet metal screws, anchors, connectors, etc." rows="3"></textarea>
      
    </div>
  </div>

  <!-- Site Conditions -->
  <div class="card">
    <div class="card-header">
      <span>üìç Site Conditions & Access</span>
    </div>
    
    <label>Equipment Location</label>
    <input type="text" id="equipment-location" placeholder="e.g., Attic above master bedroom, crawlspace">
    
    <label>Access Type</label>
    <select id="access-type">
      <option value="">Select...</option>
      <option value="attic-pulldown">Attic Pull-Down Ladder</option>
      <option value="attic-scuttle">Attic Scuttle (No Ladder)</option>
      <option value="crawlspace">Crawlspace Access</option>
      <option value="closet">Closet Access</option>
      <option value="garage">Garage</option>
      <option value="basement">Basement</option>
      <option value="exterior">Exterior Wall Mount</option>
    </select>
    
    <div class="grid-2">
      <div>
        <label>Access Opening Size</label>
        <input type="text" id="access-size" placeholder='e.g., 22" x 30"'>
      </div>
      <div>
        <label>Workspace Condition</label>
        <select id="workspace">
          <option value="">Select...</option>
          <option value="adequate">Adequate - No Issues</option>
          <option value="tight">Tight - Careful Maneuvering</option>
          <option value="very-tight">Very Tight - May Need Two Techs</option>
          <option value="excellent">Excellent - Plenty of Room</option>
        </select>
      </div>
    </div>
    
    <label>Parking for Truck</label>
    <select id="parking">
      <option value="driveway">Driveway - Direct Access</option>
      <option value="street">Street Parking Available</option>
      <option value="limited">Limited - May Need Permission</option>
      <option value="long-walk">Long Walk from Truck</option>
    </select>
    
    <label>Special Site Notes</label>
    <textarea id="site-notes" placeholder="HOA restrictions, pets, valuables to move, tight clearances, etc." rows="3"></textarea>
    
    <div class="grid-2 mt-8">
      <label class="check">
        <input type="checkbox" id="site-customer-home">
        <span>Customer will be home</span>
      </label>
      <label class="check">
        <input type="checkbox" id="site-power-off">
        <span>Power shutoff required</span>
      </label>
    </div>
  </div>

  <!-- Special Instructions -->
  <div class="card">
    <div class="card-header">
      <span>üìù Special Instructions for Install Crew</span>
    </div>
    
    <div class="status warn">
      <span>‚ö†Ô∏è</span>
      <span>Include any critical information the crew needs to know before arrival</span>
    </div>
    
    <label>Reason for Replacement</label>
    <textarea id="replacement-reason" placeholder="e.g., Old coil heavily contaminated with microbial growth, customer complained of odors" rows="2"></textarea>
    
    <label>Customer Concerns/Expectations</label>
    <textarea id="customer-concerns" placeholder="e.g., Worried about noise, wants minimal disruption, concerned about air quality" rows="2"></textarea>
    
    <label>Critical Pre-Install Checks</label>
    <textarea id="preinstall-checks" placeholder="e.g., Verify electrical panel capacity before starting, check that new unit fits in existing space" rows="2"></textarea>
    
    <label>Post-Install Testing Requirements</label>
    <textarea id="postinstall-tests" placeholder="e.g., Run system for 30 min and verify no odors, test all float switches, confirm airflow at each register" rows="2"></textarea>
  </div>

  <!-- Actions -->
  <div class="actions">
    <button onclick="generateMaterialList()" class="success">üìã Generate List</button>
    <button onclick="exportList()" class="secondary">üìÑ Export</button>
    <button onclick="clearForm()" class="danger">üóëÔ∏è Clear</button>
  </div>

  <script>
    // ==================== GLOBAL STATE ====================
    const $ = id => document.getElementById(id);
    let collars = [];
    let flexDucts = [];
    let registers = [];
    
    // ==================== DYNAMIC SECTIONS ====================
    function toggleEquipmentSection(section) {
      const checkbox = $(`equip-${section}`);
      const div = $(`section-${section}`);
      
      if (checkbox.checked) {
        div.classList.remove('hidden');
      } else {
        div.classList.add('hidden');
      }
    }
    
    function toggleSection(sectionId) {
      const section = $(`section-${sectionId}`).closest('.section');
      section.classList.toggle('open');
    }
    
    function toggleSubSection(fieldId) {
      const field = $(fieldId);
      if (field) {
        field.classList.toggle('hidden');
      }
    }
    
    // ==================== DYNAMIC LISTS ====================
    function addCollar() {
      const id = Date.now();
      collars.push(id);
      
      const item = document.createElement('div');
      item.className = 'dynamic-item';
      item.id = `collar-${id}`;
      item.innerHTML = `
        <button class="remove-btn" onclick="removeCollar(${id})">√ó</button>
        <div class="grid-2">
          <div>
            <label>Collar Size</label>
            <select id="collar-size-${id}">
              <option value="">Select size...</option>
              <option value='4"'>4"</option>
              <option value='5"'>5"</option>
              <option value='6"'>6"</option>
              <option value='7"'>7"</option>
              <option value='8"'>8"</option>
              <option value='9"'>9"</option>
              <option value='10"'>10"</option>
              <option value='12"'>12"</option>
              <option value='14"'>14"</option>
            </select>
          </div>
          <div>
            <label>Quantity</label>
            <input type="number" id="collar-qty-${id}" placeholder="Qty" min="1" value="1">
          </div>
        </div>
        <label>Purpose/Location</label>
        <input type="text" id="collar-purpose-${id}" placeholder="e.g., Supply to master bedroom">
      `;
      
      $('#collar-list').appendChild(item);
    }
    
    function removeCollar(id) {
      collars = collars.filter(c => c !== id);
      $(`collar-${id}`).remove();
    }
    
    function addFlexDuct() {
      const id = Date.now();
      flexDucts.push(id);
      
      const item = document.createElement('div');
      item.className = 'dynamic-item';
      item.id = `flex-${id}`;
      item.innerHTML = `
        <button class="remove-btn" onclick="removeFlexDuct(${id})">√ó</button>
        <div class="grid-3">
          <div>
            <label>Diameter</label>
            <select id="flex-size-${id}">
              <option value="">Size...</option>
              <option value='4"'>4"</option>
              <option value='6"'>6"</option>
              <option value='8"'>8"</option>
              <option value='10"'>10"</option>
              <option value='12"'>12"</option>
              <option value='14"'>14"</option>
            </select>
          </div>
          <div>
            <label>R-Value</label>
            <select id="flex-rvalue-${id}">
              <option value="R-4.2">R-4.2</option>
              <option value="R-6">R-6</option>
              <option value="R-8">R-8</option>
            </select>
          </div>
          <div>
            <label>Length (ft)</label>
            <input type="number" id="flex-length-${id}" placeholder="e.g., 25" min="1">
          </div>
        </div>
        <label>Purpose/Route</label>
        <input type="text" id="flex-purpose-${id}" placeholder="e.g., New run to upstairs bedroom">
      `;
      
      $('#flex-duct-list').appendChild(item);
    }
    
    function removeFlexDuct(id) {
      flexDucts = flexDucts.filter(f => f !== id);
      $(`flex-${id}`).remove();
    }
    
    function addRegister() {
      const id = Date.now();
      registers.push(id);
      
      const item = document.createElement('div');
      item.className = 'dynamic-item';
      item.id = `register-${id}`;
      item.innerHTML = `
        <button class="remove-btn" onclick="removeRegister(${id})">√ó</button>
        <div class="grid-3">
          <div>
            <label>Type</label>
            <select id="register-type-${id}">
              <option value="supply">Supply Register</option>
              <option value="return">Return Grille</option>
            </select>
          </div>
          <div>
            <label>Size</label>
            <select id="register-size-${id}">
              <option value="">Select...</option>
              <option value="4x10">4x10</option>
              <option value="6x10">6x10</option>
              <option value="6x12">6x12</option>
              <option value="8x10">8x10</option>
              <option value="10x10">10x10</option>
              <option value="12x12">12x12</option>
              <option value="14x20">14x20</option>
              <option value="16x20">16x20</option>
              <option value="20x20">20x20</option>
              <option value="20x25">20x25</option>
              <option value="24x24">24x24</option>
            </select>
          </div>
          <div>
            <label>Quantity</label>
            <input type="number" id="register-qty-${id}" placeholder="Qty" min="1" value="1">
          </div>
        </div>
        <label>Location</label>
        <input type="text" id="register-location-${id}" placeholder="e.g., Living room ceiling">
      `;
      
      $('#register-list').appendChild(item);
    }
    
    function removeRegister(id) {
      registers = registers.filter(r => r !== id);
      $(`register-${id}`).remove();
    }
    
    // ==================== MATERIAL LIST GENERATION ====================
    function generateMaterialList() {
      const data = collectFormData();
      const listText = buildMaterialListText(data);
      
      sessionStorage.setItem('materialList', JSON.stringify(data));
      displayMaterialList(listText);
    }
    
    function collectFormData() {
      const data = {
        job: {
          customer: $('customer').value,
          address: $('address').value,
          salesTech: $('sales-tech').value,
          saleDate: $('sale-date').value,
          installDate: $('install-date').value,
          laborHours: $('labor-hours').value
        },
        equipment: {
          condenser: $('equip-condenser').checked ? {
            brand: $('condenser-brand').value,
            tonnage: $('condenser-tonnage').value,
            seer: $('condenser-seer').value,
            model: $('condenser-model').value,
            linesetSize: $('condenser-lineset-size').value,
            linesetLength: $('condenser-lineset-length').value
          } : null,
          evapCoil: $('equip-evap-coil').checked ? {
            brand: $('evap-brand').value,
            tonnage: $('evap-tonnage').value,
            orientation: $('evap-orientation').value,
            model: $('evap-model').value
          } : null,
          airHandler: $('equip-air-handler').checked ? {
            brand: $('air-handler-brand').value,
            tonnage: $('air-handler-tonnage').value,
            type: $('air-handler-type').value,
            model: $('air-handler-model').value
          } : null,
          furnace: $('equip-furnace').checked ? {
            brand: $('furnace-brand').value,
            btu: $('furnace-btu').value,
            efficiency: $('furnace-efficiency').value,
            model: $('furnace-model').value
          } : null
        },
        ductwork: {
          supplyPlenum: $('plenum-supply').checked ? {
            width: $('supply-width').value,
            height: $('supply-height').value,
            length: $('supply-length').value,
            gauge: $('supply-gauge').value
          } : null,
          returnPlenum: $('plenum-return').checked ? {
            width: $('return-width').value,
            height: $('return-height').value,
            length: $('return-length').value,
            gauge: $('return-gauge').value
          } : null,
          collars: collars.map(id => ({
            size: $(`collar-size-${id}`).value,
            qty: $(`collar-qty-${id}`).value,
            purpose: $(`collar-purpose-${id}`).value
          })),
          flexDuct: flexDucts.map(id => ({
            size: $(`flex-size-${id}`).value,
            rValue: $(`flex-rvalue-${id}`).value,
            length: $(`flex-length-${id}`).value,
            purpose: $(`flex-purpose-${id}`).value
          })),
          registers: registers.map(id => ({
            type: $(`register-type-${id}`).value,
            size: $(`register-size-${id}`).value,
            qty: $(`register-qty-${id}`).value,
            location: $(`register-location-${id}`).value
          }))
        },
        iaq: {
          remeHalo: $('iaq-reme-halo').checked,
          remeHaloLED: $('iaq-reme-halo-led').checked,
          uvLight: $('iaq-uv-light').checked,
          mediaFilter: $('iaq-media-filter').checked ? {
            size: $('media-filter-size').value,
            merv: $('media-filter-merv').value
          } : null,
          bipolar: $('iaq-bipolar').checked,
          other: $('iaq-other').value
        },
        drain: {
          emergencyPan: $('drain-emergency-pan').checked,
          floatPrimary: $('drain-float-primary').checked,
          floatSecondary: $('drain-float-secondary').checked,
          pump: $('drain-pump').checked,
          pvcWork: $('drain-pvc-work').checked ? {
            size: $('pvc-size').value,
            length: $('pvc-length').value,
            trap: $('pvc-trap').checked
          } : null
        },
        electrical: {
          disconnect: $('elec-disconnect').checked ? {
            rating: $('disconnect-rating').value
          } : null,
          breaker: $('elec-breaker').checked ? {
            size: $('breaker-size').value
          } : null,
          wireRun: $('elec-wire-run').checked ? {
            gauge: $('wire-gauge').value,
            type: $('wire-type').value,
            length: $('wire-length').value
          } : null,
          tstatWire: $('elec-tstat-wire').checked ? {
            type: $('tstat-wire-type').value,
            length: $('tstat-wire-length').value
          } : null,
          thermostat: $('elec-thermostat').checked ? {
            model: $('thermostat-model').value
          } : null
        },
        mounting: {
          pad: $('mount-pad').checked,
          vibration: $('mount-vibration').checked,
          hangers: $('mount-hangers').checked,
          mastic: $('mastic-qty').value,
          foilTape: $('foil-tape-qty').value,
          other: $('other-materials').value
        },
        site: {
          location: $('equipment-location').value,
          accessType: $('access-type').value,
          accessSize: $('access-size').value,
          workspace: $('workspace').value,
          parking: $('parking').value,
          notes: $('site-notes').value,
          customerHome: $('site-customer-home').checked,
          powerOff: $('site-power-off').checked
        },
        instructions: {
          reason: $('replacement-reason').value,
          concerns: $('customer-concerns').value,
          preInstall: $('preinstall-checks').value,
          postInstall: $('postinstall-tests').value
        }
      };
      
      return data;
    }
    
    function buildMaterialListText(data) {
      let text = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë          INSTALL MATERIALS LIST & JOB SHEET                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

JOB INFORMATION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Customer: ${data.job.customer}
Address: ${data.job.address}
Sold By: ${data.job.salesTech}
Sale Date: ${data.job.saleDate}
Scheduled Install: ${data.job.installDate}
Estimated Labor: ${data.job.laborHours} hours

`;

      // Equipment Section
      text += `
EQUIPMENT TO INSTALL
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
      
      if (data.equipment.condenser) {
        const c = data.equipment.condenser;
        text += `‚òê CONDENSER: ${c.brand} ${c.tonnage} Ton ${c.seer} SEER\n`;
        text += `  Model: ${c.model}\n`;
        if (c.linesetSize && c.linesetLength) {
          text += `  ‚Üí Line Set: ${c.linesetSize} x ${c.linesetLength}ft\n`;
        }
        text += '\n';
      }
      
      if (data.equipment.evapCoil) {
        const e = data.equipment.evapCoil;
        text += `‚òê EVAPORATOR COIL: ${e.brand} ${e.tonnage} Ton ${e.orientation}\n`;
        text += `  Model: ${e.model}\n\n`;
      }
      
      if (data.equipment.airHandler) {
        const a = data.equipment.airHandler;
        text += `‚òê AIR HANDLER: ${a.brand} ${a.tonnage} Ton ${a.type}\n`;
        text += `  Model: ${a.model}\n\n`;
      }
      
      if (data.equipment.furnace) {
        const f = data.equipment.furnace;
        text += `‚òê FURNACE: ${f.brand} ${f.btu} BTU ${f.efficiency} AFUE\n`;
        text += `  Model: ${f.model}\n\n`;
      }

      // Ductwork Section
      if (data.ductwork.supplyPlenum || data.ductwork.returnPlenum || 
          data.ductwork.collars.length || data.ductwork.flexDuct.length) {
        text += `
DUCTWORK MATERIALS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
        
        if (data.ductwork.supplyPlenum) {
          const sp = data.ductwork.supplyPlenum;
          text += `‚òê Supply Plenum: ${sp.width}" x ${sp.height}" x ${sp.length}" (${sp.gauge})\n`;
        }
        
        if (data.ductwork.returnPlenum) {
          const rp = data.ductwork.returnPlenum;
          text += `‚òê Return Plenum: ${rp.width}" x ${rp.height}" x ${rp.length}" (${rp.gauge})\n`;
        }
        
        if (data.ductwork.collars.length) {
          text += `\nCollars (Crimp/Drive):\n`;
          data.ductwork.collars.forEach(collar => {
            if (collar.size && collar.qty) {
              text += `  ‚òê ${collar.size} - Qty: ${collar.qty}`;
              if (collar.purpose) text += ` (${collar.purpose})`;
              text += '\n';
            }
          });
        }
        
        if (data.ductwork.flexDuct.length) {
          text += `\nFlex Duct Runs:\n`;
          data.ductwork.flexDuct.forEach(flex => {
            if (flex.size && flex.length) {
              text += `  ‚òê ${flex.size} ${flex.rValue} - ${flex.length}ft`;
              if (flex.purpose) text += ` (${flex.purpose})`;
              text += '\n';
            }
          });
        }
        
        if (data.ductwork.registers.length) {
          text += `\nRegisters & Grilles:\n`;
          data.ductwork.registers.forEach(reg => {
            if (reg.size && reg.qty) {
              const type = reg.type === 'supply' ? 'Supply Register' : 'Return Grille';
              text += `  ‚òê ${type} ${reg.size} - Qty: ${reg.qty}`;
              if (reg.location) text += ` (${reg.location})`;
              text += '\n';
            }
          });
        }
        
        text += '\n';
      }

      // IAQ Section
      if (data.iaq.remeHalo || data.iaq.remeHaloLED || data.iaq.uvLight || 
          data.iaq.mediaFilter || data.iaq.bipolar || data.iaq.other) {
        text += `
INDOOR AIR QUALITY UPGRADES
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
        if (data.iaq.remeHalo) text += `‚òê REME HALO (Standard) - Mount in supply plenum, 24V power\n`;
        if (data.iaq.remeHaloLED) text += `‚òê REME HALO LED - Mount in supply plenum, 24V power\n`;
        if (data.iaq.uvLight) text += `‚òê UV Light System\n`;
        if (data.iaq.mediaFilter) {
          text += `‚òê Media Filter Cabinet: ${data.iaq.mediaFilter.size} MERV ${data.iaq.mediaFilter.merv}\n`;
        }
        if (data.iaq.bipolar) text += `‚òê Bipolar Ionization System\n`;
        if (data.iaq.other) text += `‚òê Other: ${data.iaq.other}\n`;
        text += '\n';
      }

      // Drain Section
      if (data.drain.emergencyPan || data.drain.floatPrimary || 
          data.drain.floatSecondary || data.drain.pump || data.drain.pvcWork) {
        text += `
DRAIN SYSTEM & SAFETY
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
        if (data.drain.emergencyPan) text += `‚òê Emergency Drain Pan (30" x 30" or sized to unit)\n`;
        if (data.drain.floatPrimary) text += `‚òê Float Switch - Primary (Normally Open)\n`;
        if (data.drain.floatSecondary) text += `‚òê Float Switch - Secondary/Pan (Normally Closed)\n`;
        if (data.drain.pump) text += `‚òê Condensate Pump\n`;
        if (data.drain.pvcWork) {
          const pvc = data.drain.pvcWork;
          text += `‚òê PVC Pipe: ${pvc.size}" - ${pvc.length}ft\n`;
          if (pvc.trap) text += `‚òê PVC P-Trap (${pvc.size}")\n`;
          text += `‚òê PVC Primer & Cement\n`;
        }
        text += '\n';
      }

      // Electrical Section
      if (data.electrical.disconnect || data.electrical.breaker || 
          data.electrical.wireRun || data.electrical.tstatWire || data.electrical.thermostat) {
        text += `
ELECTRICAL MATERIALS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
        if (data.electrical.disconnect) {
          text += `‚òê Disconnect Box: ${data.electrical.disconnect.rating}\n`;
        }
        if (data.electrical.breaker) {
          text += `‚òê Breaker: ${data.electrical.breaker.size}\n`;
        }
        if (data.electrical.wireRun) {
          const w = data.electrical.wireRun;
          text += `‚òê Power Wire: ${w.gauge} ${w.type} - ${w.length}ft\n`;
        }
        if (data.electrical.tstatWire) {
          const t = data.electrical.tstatWire;
          text += `‚òê Thermostat Wire: ${t.type} - ${t.length}ft\n`;
        }
        if (data.electrical.thermostat) {
          text += `‚òê Thermostat: ${data.electrical.thermostat.model}\n`;
        }
        text += `‚òê Wire Nuts (Assorted)\n`;
        text += `‚òê Electrical Tape\n\n`;
      }

      // Mounting & Accessories
      if (data.mounting.pad || data.mounting.vibration || data.mounting.hangers || 
          data.mounting.mastic || data.mounting.foilTape || data.mounting.other) {
        text += `
MOUNTING & ACCESSORIES
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
        if (data.mounting.pad) text += `‚òê Equipment Pad/Stand\n`;
        if (data.mounting.vibration) text += `‚òê Vibration Isolators\n`;
        if (data.mounting.hangers) text += `‚òê Duct Hangers/Straps\n`;
        if (data.mounting.mastic) text += `‚òê Mastic: ${data.mounting.mastic} quart(s)\n`;
        if (data.mounting.foilTape) text += `‚òê Foil Tape: ${data.mounting.foilTape} roll(s)\n`;
        text += `‚òê Sheet Metal Screws (1 lb box)\n`;
        if (data.mounting.other) text += `‚òê Other: ${data.mounting.other}\n`;
        text += '\n';
      }

      // Site Conditions
      text += `
SITE CONDITIONS & ACCESS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Location: ${data.site.location}
Access Type: ${data.site.accessType}
${data.site.accessSize ? `Access Opening: ${data.site.accessSize}` : ''}
Workspace: ${data.site.workspace}
Parking: ${data.site.parking}
${data.site.customerHome ? '‚úì Customer will be home during install' : ''}
${data.site.powerOff ? '‚úì Power shutoff required' : ''}

${data.site.notes ? `Site Notes:\n${data.site.notes}\n` : ''}
`;

      // Special Instructions
      if (data.instructions.reason || data.instructions.concerns || 
          data.instructions.preInstall || data.instructions.postInstall) {
        text += `
SPECIAL INSTRUCTIONS FOR CREW
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
`;
        if (data.instructions.reason) {
          text += `Reason for Replacement:\n${data.instructions.reason}\n\n`;
        }
        if (data.instructions.concerns) {
          text += `Customer Concerns:\n${data.instructions.concerns}\n\n`;
        }
        if (data.instructions.preInstall) {
          text += `Pre-Install Checks:\n${data.instructions.preInstall}\n\n`;
        }
        if (data.instructions.postInstall) {
          text += `Post-Install Testing:\n${data.instructions.postInstall}\n\n`;
        }
      }

      // Footer
      text += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
>>> STAGE ALL MATERIALS BEFORE LEAVING SHOP <<<
>>> VERIFY EQUIPMENT MATCH AND AHRI CERTIFICATION <<<

Installer Sign-Off: _____________________ Date: __________

Material List Generated: ${new Date().toLocaleString()}
Sales Tech: ${data.job.salesTech}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;

      return text;
    }
    
    function displayMaterialList(listText) {
      // Remove existing list if present
      const existing = document.querySelector('.material-list-output')?.closest('.card');
      if (existing) existing.remove();
      
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-header">
          <span>üìã Generated Material List</span>
        </div>
        <div class="status good">
          <span>‚úì</span>
          <span>Material list ready - review before printing</span>
        </div>
        <pre class="material-list-output">${listText}</pre>
        <div class="grid-2 mt-8">
          <button onclick="copyToClipboard()" class="success">üìã Copy to Clipboard</button>
          <button onclick="printList()" class="secondary">üñ®Ô∏è Print</button>
        </div>
      `;
      
      // Insert before actions bar
      document.querySelector('.actions').before(card);
      
      // Scroll to list
      card.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    function copyToClipboard() {
      const text = document.querySelector('.material-list-output').textContent;
      navigator.clipboard.writeText(text)
        .then(() => alert('‚úì Material list copied to clipboard!'))
        .catch(() => alert('Copy failed - please select and copy manually'));
    }
    
    function printList() {
      const text = document.querySelector('.material-list-output').textContent;
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <html>
        <head>
          <title>Install Material List</title>
          <style>
            body { 
              font-family: 'Courier New', monospace; 
              font-size: 12px; 
              line-height: 1.4; 
              margin: 0.5in; 
              white-space: pre-wrap;
            }
            @media print {
              body { margin: 0.25in; }
            }
          </style>
        </head>
        <body>${text}</body>
        </html>
      `);
      printWindow.document.close();
      printWindow.focus();
      setTimeout(() => {
        printWindow.print();
        printWindow.close();
      }, 250);
    }
    
    function exportList() {
      const data = sessionStorage.getItem('materialList');
      if (!data) {
        alert('Generate list first');
        return;
      }
      
      const parsed = JSON.parse(data);
      const text = document.querySelector('.material-list-output').textContent;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `MaterialList_${parsed.job.customer.replace(/\s/g, '_')}_${parsed.job.installDate}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // ==================== FORM MANAGEMENT ====================
    function clearForm() {
      if (!confirm('Clear all data? This cannot be undone.')) return;
      
      // Clear all inputs
      document.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'checkbox') {
          el.checked = false;
        } else {
          el.value = '';
        }
      });
      
      // Clear dynamic lists
      collars = [];
      flexDucts = [];
      registers = [];
      $('#collar-list').innerHTML = '';
      $('#flex-duct-list').innerHTML = '';
      $('#register-list').innerHTML = '';
      
      // Hide equipment sections
      document.querySelectorAll('[id^="section-"]').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Close all sections
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('open');
      });
      
      // Remove generated list
      const existing = document.querySelector('.material-list-output')?.closest('.card');
      if (existing) existing.remove();
      
      sessionStorage.removeItem('materialList');
      
      alert('Form cleared');
    }
    
    // ==================== AUTO-SAVE ====================
    function autoSave() {
      const draft = {
        customer: $('customer').value,
        address: $('address').value,
        salesTech: $('sales-tech').value,
        timestamp: Date.now()
      };
      
      localStorage.setItem('materialListDraft', JSON.stringify(draft));
    }
    
    let saveTimer;
    document.addEventListener('input', () => {
      clearTimeout(saveTimer);
      saveTimer = setTimeout(autoSave, 3000);
    });
    
    // ==================== INITIALIZATION ====================
    window.addEventListener('load', () => {
      // Set today's date
      const today = new Date().toISOString().split('T')[0];
      $('sale-date').value = today;
      
      // Load draft if exists
      const draft = localStorage.getItem('materialListDraft');
      if (draft) {
        const data = JSON.parse(draft);
        const ageMinutes = (Date.now() - data.timestamp) / 60000;
        
        if (ageMinutes < 1440 && confirm('Resume previous session?')) {
          $('customer').value = data.customer || '';
          $('address').value = data.address || '';
          $('sales-tech').value = data.salesTech || '';
        }
      }
      
      console.log('%cüì¶ Field Buddy - Material List Generator Loaded', 'color:#007AFF; font-size:14px; font-weight:bold');
    });
    
    // ==================== CHECKBOX STYLING ====================
    document.addEventListener('change', (e) => {
      if (e.target.type === 'checkbox') {
        const label = e.target.closest('label.check');
        if (label) {
          if (e.target.checked) {
            label.classList.add('checked');
          } else {
            label.classList.remove('checked');
          }
        }
      }
    });
    
  </script>
</body>
</html>
