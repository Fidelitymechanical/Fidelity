<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content="Field Buddy Pro v2.0 - Master Tech Edition: Professional HVAC diagnostics, materials management, and intelligent field documentation">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Field Buddy Pro v2.0 - Master Tech Edition</title>
  
  <style>
    /* ==================== DESIGN SYSTEM ==================== */
    :root {
      --primary: #0066FF;
      --primary-dark: #0052CC;
      --primary-light: #3385FF;
      --secondary: #5856D6;
      --success: #34C759;
      --warning: #FF9500;
      --danger: #FF3B30;
      --info: #5AC8FA;
      
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-300: #D1D5DB;
      --gray-400: #9CA3AF;
      --gray-500: #6B7280;
      --gray-600: #4B5563;
      --gray-700: #374151;
      --gray-800: #1F2937;
      --gray-900: #111827;
      
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      --radius-sm: 6px;
      --radius: 8px;
      --radius-md: 10px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 12px;
      --spacing-lg: 16px;
      --spacing-xl: 24px;
      --spacing-2xl: 32px;
      
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* ==================== BASE RESET ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      scroll-behavior: smooth;
      scroll-padding-top: 80px;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--gray-900);
      font-size: 16px;
      line-height: 1.5;
      padding-bottom: 100px;
    }
    
    /* ==================== HEADER ==================== */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-lg) var(--spacing-xl);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      font-weight: 700;
      font-size: 20px;
      color: var(--gray-900);
    }
    
    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
      box-shadow: var(--shadow);
    }
    
    .version-badge {
      display: inline-block;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      box-shadow: var(--shadow-sm);
    }
    
    /* ==================== CONTAINER ==================== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }
    
    /* ==================== MODE SELECTOR ==================== */
    .mode-selector {
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--spacing-sm);
      box-shadow: var(--shadow-lg);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-xl);
    }
    
    .mode-btn {
      padding: var(--spacing-lg);
      border: none;
      background: transparent;
      border-radius: var(--radius-lg);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      color: var(--gray-600);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }
    
    .mode-btn:hover {
      background: var(--gray-50);
      color: var(--gray-900);
    }
    
    .mode-btn.active {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }
    
    /* ==================== CARDS ==================== */
    .card {
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-lg);
      transition: var(--transition);
    }
    
    .card:hover {
      box-shadow: var(--shadow-xl);
      transform: translateY(-2px);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-lg);
      border-bottom: 2px solid var(--gray-100);
    }
    
    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--gray-900);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .card-subtitle {
      font-size: 15px;
      font-weight: 600;
      color: var(--primary);
      margin: var(--spacing-lg) 0 var(--spacing-md);
      padding-top: var(--spacing-md);
      border-top: 1px solid var(--gray-100);
    }
    
    /* ==================== TOGGLE SWITCHES ==================== */
    .toggle-group {
      display: inline-flex;
      background: var(--gray-100);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xs);
      gap: var(--spacing-xs);
      margin-bottom: var(--spacing-lg);
    }
    
    .toggle-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      background: transparent;
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      color: var(--gray-600);
    }
    
    .toggle-btn.active {
      background: white;
      color: var(--gray-900);
      box-shadow: var(--shadow-sm);
    }
    
    .toggle-btn.cooling.active {
      color: #0066FF;
    }
    
    .toggle-btn.heating.active {
      color: #FF6B00;
    }
    
    /* ==================== FORM ELEMENTS ==================== */
    .form-group {
      margin-bottom: var(--spacing-lg);
    }
    
    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: var(--spacing-sm);
      letter-spacing: 0.3px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-lg);
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-md);
      font-size: 15px;
      font-family: inherit;
      background: white;
      transition: var(--transition);
      -webkit-appearance: none;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
    }
    
    input[readonly] {
      background: var(--gray-50);
      color: var(--gray-600);
      cursor: not-allowed;
    }
    
    textarea {
      resize: vertical;
      min-height: 100px;
      line-height: 1.6;
    }
    
    /* ==================== GRID LAYOUTS ==================== */
    .grid {
      display: grid;
      gap: var(--spacing-lg);
    }
    
    .grid-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-4 { grid-template-columns: repeat(4, 1fr); }
    
    @media (max-width: 768px) {
      .grid-2, .grid-3, .grid-4 {
        grid-template-columns: 1fr;
      }
    }
    
    /* ==================== BUTTONS ==================== */
    .btn {
      padding: var(--spacing-md) var(--spacing-xl);
      border: none;
      border-radius: var(--radius-md);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      min-height: 48px;
      width: 100%;
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: var(--shadow-md);
    }
    
    .btn-primary:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-1px);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #34C759, #28A745);
      color: white;
      box-shadow: var(--shadow-md);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #FF3B30, #DC2626);
      color: white;
      box-shadow: var(--shadow-md);
    }
    
    .btn-secondary {
      background: var(--gray-100);
      color: var(--gray-700);
    }
    
    .btn-secondary:hover {
      background: var(--gray-200);
    }
    
    /* ==================== STATUS INDICATORS ==================== */
    .status-indicator {
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin: var(--spacing-md) 0;
      border-left: 4px solid;
    }
    
    .status-good {
      background: #D1F4E0;
      color: #0F5132;
      border-color: var(--success);
    }
    
    .status-warning {
      background: #FFF3CD;
      color: #664D03;
      border-color: var(--warning);
    }
    
    .status-critical {
      background: #F8D7DA;
      color: #842029;
      border-color: var(--danger);
    }
    
    .status-info {
      background: #D1ECF1;
      color: #0C5460;
      border-color: var(--info);
    }
    
    /* ==================== DIAGNOSTIC RESULTS ==================== */
    .diagnostic-panel {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: var(--radius-xl);
      padding: var(--spacing-xl);
      margin: var(--spacing-xl) 0;
      box-shadow: var(--shadow-xl);
    }
    
    .diagnostic-title {
      color: white;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .diagnostic-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
    }
    
    .diagnostic-card:last-child {
      margin-bottom: 0;
    }
    
    .diagnostic-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-sm);
    }
    
    .diagnostic-card-title {
      font-weight: 700;
      font-size: 15px;
    }
    
    .severity-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .severity-good { background: var(--success); color: white; }
    .severity-warning { background: var(--warning); color: white; }
    .severity-critical { background: var(--danger); color: white; }
    
    .recommendations {
      margin-top: var(--spacing-md);
      padding-top: var(--spacing-md);
      border-top: 1px solid var(--gray-200);
    }
    
    .recommendations ul {
      margin: var(--spacing-sm) 0;
      padding-left: var(--spacing-xl);
    }
    
    .recommendations li {
      margin: var(--spacing-xs) 0;
      color: var(--gray-700);
      line-height: 1.6;
    }
    
    /* ==================== MATERIALS LIST ==================== */
    .material-item {
      background: var(--gray-50);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: var(--transition);
    }
    
    .material-item:hover {
      background: var(--gray-100);
    }
    
    .material-info {
      flex: 1;
    }
    
    .material-name {
      font-weight: 600;
      color: var(--gray-900);
    }
    
    .material-spec {
      font-size: 13px;
      color: var(--gray-600);
      margin-top: var(--spacing-xs);
    }
    
    .material-quantity {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary);
      padding: 6px 12px;
      background: white;
      border-radius: var(--radius);
    }
    
    /* ==================== CHECKBOXES ==================== */
    .checkbox-label {
      display: flex;
      align-items: center;
      padding: var(--spacing-md);
      background: white;
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
      margin-bottom: var(--spacing-sm);
    }
    
    .checkbox-label:hover {
      border-color: var(--primary);
      background: var(--gray-50);
    }
    
    .checkbox-label.checked {
      border-color: var(--success);
      background: #E6F7EC;
    }
    
    input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-right: var(--spacing-md);
      accent-color: var(--success);
      cursor: pointer;
      flex-shrink: 0;
    }
    
    /* ==================== TOAST NOTIFICATIONS ==================== */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--gray-900);
      color: white;
      padding: var(--spacing-lg) var(--spacing-xl);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      z-index: 9999;
      font-weight: 600;
      opacity: 0;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      max-width: 90%;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    .toast.success { background: var(--success); }
    .toast.danger { background: var(--danger); }
    .toast.warning { background: var(--warning); }
    
    /* ==================== MODAL ==================== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: var(--spacing-xl);
    }
    
    .modal-overlay.show {
      display: flex;
    }
    
    .modal {
      background: white;
      border-radius: var(--radius-xl);
      padding: var(--spacing-xl);
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow-xl);
      transform: scale(0.9);
      transition: var(--transition);
    }
    
    .modal-overlay.show .modal {
      transform: scale(1);
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: var(--spacing-md);
      color: var(--gray-900);
    }
    
    .modal-content {
      color: var(--gray-700);
      margin-bottom: var(--spacing-xl);
      line-height: 1.6;
    }
    
    .modal-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-md);
    }
    
    /* ==================== REPORT PREVIEW ==================== */
    .report-preview {
      background: var(--gray-50);
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-x: auto;
      max-height: 600px;
      overflow-y: auto;
    }
    
    /* ==================== HIDDEN ELEMENTS ==================== */
    .hidden {
      display: none !important;
    }
    
    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-md);
      }
      
      .card {
        padding: var(--spacing-lg);
      }
      
      .header-inner {
        padding: var(--spacing-md);
      }
      
      .logo {
        font-size: 16px;
      }
      
      .logo-icon {
        width: 32px;
        height: 32px;
        font-size: 16px;
      }
    }
    
    /* ==================== ANIMATIONS ==================== */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-in {
      animation: slideIn 0.3s ease-out;
    }
    
    /* ==================== SCROLLBAR ==================== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--gray-100);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--gray-400);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--gray-500);
    }
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-inner">
      <div class="logo">
        <div class="logo-icon">🔧</div>
        <div>
          <div>Field Buddy Pro</div>
          <span class="version-badge">v2.0 Master</span>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTAINER -->
  <div class="container">
    
    <!-- MODE SELECTOR -->
    <div class="mode-selector">
      <button class="mode-btn active" id="btn-service" onclick="setMode('service')">
        <span>🔧</span>
        <span>Service Call</span>
      </button>
      <button class="mode-btn" id="btn-materials" onclick="setMode('materials')">
        <span>📦</span>
        <span>Materials List</span>
      </button>
    </div>

    <!-- SERVICE MODE -->
    <div id="service-mode" class="mode-content">
      
      <!-- JOB INFORMATION -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>📋</span>
            <span>Job Information</span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Call Type</label>
          <div class="toggle-group">
            <button class="toggle-btn active" id="call-trouble" onclick="setCallType('trouble')">Trouble Call</button>
            <button class="toggle-btn" id="call-maintenance" onclick="setCallType('maintenance')">Maintenance</button>
          </div>
        </div>
        
        <div class="grid grid-2">
          <div class="form-group">
            <label>Customer Name</label>
            <input type="text" id="customer-name" placeholder="Enter customer name">
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" id="service-date">
          </div>
        </div>
        
        <div class="form-group">
          <label>Service Address</label>
          <input type="text" id="service-address" placeholder="123 Main St, City, State ZIP">
        </div>
        
        <div class="form-group">
          <label>Customer Complaint / Reason for Service</label>
          <textarea id="customer-complaint" placeholder="Describe the issue or maintenance reason..."></textarea>
        </div>
      </div>

      <!-- SYSTEM MODE TOGGLE -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>❄️</span>
            <span>System Mode</span>
          </div>
        </div>
        
        <div class="toggle-group">
          <button class="toggle-btn cooling active" id="mode-cooling" onclick="setSystemMode('cooling')">
            <span>❄️</span>
            <span>Cooling</span>
          </button>
          <button class="toggle-btn heating" id="mode-heating" onclick="setSystemMode('heating')">
            <span>🔥</span>
            <span>Heating</span>
          </button>
        </div>
      </div>

      <!-- EQUIPMENT INFORMATION -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>🏠</span>
            <span>Equipment Information</span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Unit Type</label>
          <select id="unit-type" onchange="updateUnitFields()">
            <option value="">Select unit type...</option>
            <option value="split">Split System</option>
            <option value="package">Package Unit</option>
            <option value="mini-split">Mini-Split</option>
            <option value="heat-pump">Heat Pump</option>
          </select>
        </div>
        
        <div class="grid grid-2">
          <div class="form-group">
            <label>Indoor Unit (Model/Serial)</label>
            <input type="text" id="indoor-unit" placeholder="Model & Serial Number">
          </div>
          <div class="form-group" id="outdoor-unit-group">
            <label>Outdoor Unit (Model/Serial)</label>
            <input type="text" id="outdoor-unit" placeholder="Model & Serial Number">
          </div>
        </div>
        
        <div class="grid grid-3">
          <div class="form-group">
            <label>Tonnage</label>
            <select id="tonnage">
              <option value="">Select...</option>
              <option value="1.5">1.5 Ton</option>
              <option value="2">2 Ton</option>
              <option value="2.5">2.5 Ton</option>
              <option value="3">3 Ton</option>
              <option value="3.5">3.5 Ton</option>
              <option value="4">4 Ton</option>
              <option value="5">5 Ton</option>
            </select>
          </div>
          <div class="form-group">
            <label>Refrigerant Type</label>
            <select id="refrigerant-type">
              <option value="R410A">R-410A</option>
              <option value="R22">R-22</option>
              <option value="R454B">R-454B</option>
              <option value="R32">R-32</option>
            </select>
          </div>
          <div class="form-group">
            <label>Filter Size</label>
            <input type="text" id="filter-size" placeholder="e.g., 16x25x1">
          </div>
        </div>
      </div>

      <!-- MEASUREMENTS - COOLING MODE -->
      <div class="card animate-in" id="cooling-measurements">
        <div class="card-header">
          <div class="card-title">
            <span>📊</span>
            <span>Diagnostic Measurements</span>
          </div>
        </div>
        
        <div class="card-subtitle">Temperature Readings</div>
        <div class="grid grid-3">
          <div class="form-group">
            <label>Ambient Temp (°F)</label>
            <input type="number" step="0.1" id="ambient-temp" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Return Temp (°F)</label>
            <input type="number" step="0.1" id="return-temp" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Supply Temp (°F)</label>
            <input type="number" step="0.1" id="supply-temp" oninput="calculateDiagnostics()">
          </div>
        </div>
        
        <div class="form-group">
          <label>Delta-T</label>
          <input type="text" id="delta-t" readonly>
        </div>
        
        <div class="card-subtitle">Refrigerant Pressures & Temps</div>
        <div class="grid grid-2">
          <div class="form-group">
            <label>Suction Pressure (PSI)</label>
            <input type="number" step="0.1" id="suction-pressure" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Suction Line Temp (°F)</label>
            <input type="number" step="0.1" id="suction-temp" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Liquid Pressure (PSI)</label>
            <input type="number" step="0.1" id="liquid-pressure" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Liquid Line Temp (°F)</label>
            <input type="number" step="0.1" id="liquid-temp" oninput="calculateDiagnostics()">
          </div>
        </div>
        
        <div class="grid grid-2">
          <div class="form-group">
            <label>Superheat (°F)</label>
            <input type="text" id="superheat" readonly>
          </div>
          <div class="form-group">
            <label>Subcool (°F)</label>
            <input type="text" id="subcool" readonly>
          </div>
        </div>
        
        <div class="card-subtitle">Airflow & Electrical</div>
        <div class="grid grid-3">
          <div class="form-group">
            <label>Static Pressure (in w.c.)</label>
            <input type="number" step="0.01" id="static-pressure" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Voltage (V)</label>
            <input type="number" step="0.1" id="voltage">
          </div>
          <div class="form-group">
            <label>Amperage (A)</label>
            <input type="number" step="0.1" id="amperage">
          </div>
        </div>
      </div>

      <!-- MEASUREMENTS - HEATING MODE -->
      <div class="card animate-in hidden" id="heating-measurements">
        <div class="card-header">
          <div class="card-title">
            <span>📊</span>
            <span>Heating Diagnostic Measurements</span>
          </div>
        </div>
        
        <div class="card-subtitle">Temperature Readings</div>
        <div class="grid grid-3">
          <div class="form-group">
            <label>Return Temp (°F)</label>
            <input type="number" step="0.1" id="return-temp-heat" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Supply Temp (°F)</label>
            <input type="number" step="0.1" id="supply-temp-heat" oninput="calculateDiagnostics()">
          </div>
          <div class="form-group">
            <label>Temp Rise (°F)</label>
            <input type="text" id="temp-rise" readonly>
          </div>
        </div>
        
        <div class="card-subtitle">Gas Furnace / Heat Measurements</div>
        <div class="grid grid-3">
          <div class="form-group">
            <label>Manifold Pressure (in w.c.)</label>
            <input type="number" step="0.01" id="manifold-pressure">
          </div>
          <div class="form-group">
            <label>Voltage (V)</label>
            <input type="number" step="0.1" id="voltage-heat">
          </div>
          <div class="form-group">
            <label>Amperage (A)</label>
            <input type="number" step="0.1" id="amperage-heat">
          </div>
        </div>
      </div>

      <!-- VISUAL INSPECTION CHECKLIST -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>👁️</span>
            <span>Visual Inspection Checklist</span>
          </div>
        </div>
        
        <div class="card-subtitle">Filter & Airflow</div>
        <label class="checkbox-label">
          <input type="checkbox" id="check-filter" onchange="updateCheckbox(this)">
          <span>Filter inspected (clean/dirty?)</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="check-coil" onchange="updateCheckbox(this)">
          <span>Evaporator coil inspected (clean/restricted?)</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="check-blower" onchange="updateCheckbox(this)">
          <span>Blower wheel inspected (clean/buildup?)</span>
        </label>
        
        <div class="card-subtitle">Condensing Unit</div>
        <label class="checkbox-label">
          <input type="checkbox" id="check-condenser" onchange="updateCheckbox(this)">
          <span>Condenser coil inspected (clean/dirty?)</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="check-fan" onchange="updateCheckbox(this)">
          <span>Condenser fan operation checked</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="check-capacitor" onchange="updateCheckbox(this)">
          <span>Capacitor(s) tested</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="check-contactor" onchange="updateCheckbox(this)">
          <span>Contactor inspected (pitting/burning?)</span>
        </label>
        
        <div class="card-subtitle">Electrical & Safety</div>
        <label class="checkbox-label">
          <input type="checkbox" id="check-wiring" onchange="updateCheckbox(this)">
          <span>Wiring connections inspected</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="check-disconnect" onchange="updateCheckbox(this)">
          <span>Disconnect switch checked</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="check-drain" onchange="updateCheckbox(this)">
          <span>Condensate drain inspected</span>
        </label>
      </div>

      <!-- DIAGNOSTIC RESULTS -->
      <div id="diagnostic-results" class="hidden"></div>

      <!-- FINDINGS & WORK PERFORMED -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>📝</span>
            <span>Findings & Work Performed</span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Findings</label>
          <textarea id="findings" placeholder="Describe what you found during the service call..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Recommendations</label>
          <textarea id="recommendations" placeholder="What do you recommend to the customer?"></textarea>
        </div>
        
        <div class="form-group">
          <label>Work Performed</label>
          <textarea id="work-performed" placeholder="Detail the work you completed..."></textarea>
        </div>
      </div>

      <!-- TECHNICIAN INFO -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>👤</span>
            <span>Technician Information</span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Technician Name</label>
          <input type="text" id="tech-name" placeholder="Your name">
        </div>
      </div>

      <!-- ACTION BUTTONS -->
      <div class="grid grid-2">
        <button class="btn btn-success" onclick="generateServiceReport()">
          <span>✓</span>
          <span>Generate Report</span>
        </button>
        <button class="btn btn-secondary" onclick="clearForm()">
          <span>🗑️</span>
          <span>Clear Form</span>
        </button>
      </div>
    </div>

    <!-- MATERIALS MODE -->
    <div id="materials-mode" class="mode-content hidden">
      
      <!-- JOB INFO -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>📋</span>
            <span>Job Information</span>
          </div>
        </div>
        
        <div class="grid grid-2">
          <div class="form-group">
            <label>Customer/Job Name</label>
            <input type="text" id="mat-customer" placeholder="Enter customer or job name">
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" id="mat-date">
          </div>
        </div>
        
        <div class="form-group">
          <label>Job Address</label>
          <input type="text" id="mat-address" placeholder="123 Main St, City, State ZIP">
        </div>
        
        <div class="form-group">
          <label>Job Notes</label>
          <textarea id="mat-notes" placeholder="Special instructions, access codes, etc."></textarea>
        </div>
      </div>

      <!-- MATERIALS CATALOG -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>📦</span>
            <span>Materials Catalog (2025)</span>
          </div>
        </div>
        
        <div id="materials-catalog">
          <!-- Populated dynamically -->
        </div>
      </div>

      <!-- SELECTED MATERIALS -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>✓</span>
            <span>Selected Materials</span>
          </div>
        </div>
        
        <div id="selected-materials">
          <div class="status-info">
            <span>ℹ️</span>
            <span>No materials selected yet. Use the catalog above to add items.</span>
          </div>
        </div>
      </div>

      <!-- TECHNICIAN INFO -->
      <div class="card animate-in">
        <div class="card-header">
          <div class="card-title">
            <span>👤</span>
            <span>Technician Information</span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Technician Name</label>
          <input type="text" id="mat-tech-name" placeholder="Your name">
        </div>
      </div>

      <!-- ACTION BUTTONS -->
      <div class="grid grid-2">
        <button class="btn btn-success" onclick="generateMaterialsList()">
          <span>✓</span>
          <span>Generate Materials List</span>
        </button>
        <button class="btn btn-secondary" onclick="clearForm()">
          <span>🗑️</span>
          <span>Clear Form</span>
        </button>
      </div>
    </div>

    <!-- REPORT PREVIEW (populated dynamically) -->
    <div id="report-container"></div>

  </div>

  <!-- TOAST NOTIFICATION -->
  <div class="toast" id="toast"></div>

  <!-- MODAL -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal">
      <div class="modal-title" id="modal-title">Confirm Action</div>
      <div class="modal-content" id="modal-content">Are you sure?</div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal(false)">Cancel</button>
        <button class="btn btn-primary" onclick="closeModal(true)">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    // ==================== STATE MANAGEMENT ====================
    let currentMode = 'service';
    let callType = 'trouble';
    let systemMode = 'cooling';
    let selectedMaterials = [];
    let diagnosticResults = [];
    
    // ==================== 2025 MATERIALS CATALOG ====================
    const materialsCatalog = {
      'Capacitors': [
        { name: 'Dual Run Capacitor 40/5 MFD 440V', spec: 'Round', unit: 'ea' },
        { name: 'Dual Run Capacitor 35/5 MFD 440V', spec: 'Round', unit: 'ea' },
        { name: 'Dual Run Capacitor 45/5 MFD 440V', spec: 'Round', unit: 'ea' },
        { name: 'Dual Run Capacitor 50/5 MFD 440V', spec: 'Round', unit: 'ea' },
        { name: 'Start Capacitor 88-108 MFD 330V', spec: 'Hard Start', unit: 'ea' },
        { name: 'Start Capacitor 145-174 MFD 330V', spec: 'Hard Start', unit: 'ea' }
      ],
      'Contactors': [
        { name: '1-Pole Contactor 30A 24V', spec: '30A Single Pole', unit: 'ea' },
        { name: '2-Pole Contactor 40A 24V', spec: '40A Double Pole', unit: 'ea' },
        { name: '3-Pole Contactor 50A 24V', spec: '50A Three Pole', unit: 'ea' },
        { name: '2-Pole Contactor 30A 24V', spec: '30A Double Pole', unit: 'ea' }
      ],
      'Refrigerant': [
        { name: 'R-410A Refrigerant', spec: '25 lb Cylinder', unit: 'lbs' },
        { name: 'R-22 Refrigerant', spec: '30 lb Cylinder', unit: 'lbs' },
        { name: 'R-454B Refrigerant', spec: '25 lb Cylinder', unit: 'lbs' },
        { name: 'R-32 Refrigerant', spec: '20 lb Cylinder', unit: 'lbs' }
      ],
      'Line Sets': [
        { name: 'Line Set 1/4" x 3/8"', spec: 'Insulated, 15ft', unit: 'ft' },
        { name: 'Line Set 1/4" x 1/2"', spec: 'Insulated, 25ft', unit: 'ft' },
        { name: 'Line Set 3/8" x 3/4"', spec: 'Insulated, 35ft', unit: 'ft' },
        { name: 'Line Set 1/2" x 7/8"', spec: 'Insulated, 50ft', unit: 'ft' }
      ],
      'Filters': [
        { name: 'Disposable Filter 16x25x1 MERV 8', spec: 'Standard', unit: 'ea' },
        { name: 'Disposable Filter 20x25x1 MERV 8', spec: 'Standard', unit: 'ea' },
        { name: 'Disposable Filter 16x20x1 MERV 8', spec: 'Standard', unit: 'ea' },
        { name: 'Media Filter 16x25x4 MERV 11', spec: 'High Efficiency', unit: 'ea' },
        { name: 'Media Filter 20x25x4 MERV 13', spec: 'Premium', unit: 'ea' }
      ],
      'Thermostats': [
        { name: 'WiFi Smart Thermostat', spec: 'Programmable, Color Touch', unit: 'ea' },
        { name: 'Programmable Thermostat 7-Day', spec: 'Non-WiFi', unit: 'ea' },
        { name: 'Digital Non-Programmable', spec: 'Basic', unit: 'ea' }
      ],
      'Condensate': [
        { name: 'Condensate Pump', spec: 'Standard 115V', unit: 'ea' },
        { name: 'Condensate Safety Switch', spec: 'Float Type', unit: 'ea' },
        { name: 'PVC 3/4" Drain Pipe', spec: 'Schedule 40', unit: 'ft' },
        { name: 'Condensate Pan', spec: 'Secondary', unit: 'ea' }
      ],
      'Electrical': [
        { name: 'Disconnect Box 30A', spec: 'Outdoor Non-Fused', unit: 'ea' },
        { name: 'Disconnect Box 60A', spec: 'Outdoor Fused', unit: 'ea' },
        { name: 'Whip 6ft 10/3', spec: 'Pre-wired with Disconnect', unit: 'ea' },
        { name: 'Low Voltage Wire 18/5', spec: 'Thermostat Wire', unit: 'ft' },
        { name: 'Low Voltage Wire 18/8', spec: 'Thermostat Wire', unit: 'ft' }
      ],
      'IAQ Products': [
        { name: 'UV Light System', spec: 'Single Lamp 24V', unit: 'ea' },
        { name: 'UV Light System', spec: 'Dual Lamp 24V', unit: 'ea' },
        { name: 'Whole-Home Humidifier', spec: 'Bypass', unit: 'ea' },
        { name: 'Whole-Home Dehumidifier', spec: '90 Pint', unit: 'ea' },
        { name: 'Air Purifier REME HALO', spec: '24V', unit: 'ea' }
      ],
      'Miscellaneous': [
        { name: 'Refrigerant Oil', spec: 'POE 8oz', unit: 'ea' },
        { name: 'Filter Drier', spec: '3/8" Flare', unit: 'ea' },
        { name: 'TXV Valve', spec: 'Universal 2-5 Ton', unit: 'ea' },
        { name: 'Coil Cleaner', spec: 'Aerosol Can', unit: 'ea' },
        { name: 'Nitrogen Tank', spec: 'Pressure Test', unit: 'ea' }
      ]
    };
    
    // ==================== R410A PRESSURE-TEMPERATURE CHART ====================
    const R410A_PT = {
      85: 40.4, 90: 44.7, 95: 47.1, 100: 49.6, 105: 52.2, 110: 54.9,
      115: 57.7, 120: 60.6, 125: 63.6, 130: 66.7, 135: 69.9, 140: 73.2,
      145: 76.6, 150: 80.1, 155: 83.7, 160: 87.4, 165: 91.3, 170: 95.2,
      175: 99.3, 180: 103.5, 185: 107.8, 190: 112.2, 195: 116.7, 200: 121.4,
      205: 126.1, 210: 131.0, 215: 135.9, 220: 140.9
    };
    
    // ==================== HELPER FUNCTIONS ====================
    function $(id) {
      return document.getElementById(id);
    }
    
    function showToast(message, type = 'success') {
      const toast = $('toast');
      toast.textContent = message;
      toast.className = `toast show ${type}`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
    
    function showModal(title, content) {
      return new Promise((resolve) => {
        $('modal-title').textContent = title;
        $('modal-content').textContent = content;
        $('modal-overlay').classList.add('show');
        window.modalResolve = resolve;
      });
    }
    
    function closeModal(result) {
      $('modal-overlay').classList.remove('show');
      if (window.modalResolve) {
        window.modalResolve(result);
        window.modalResolve = null;
      }
    }
    
    // ==================== MODE SWITCHING ====================
    function setMode(mode) {
      currentMode = mode;
      $('service-mode').classList.toggle('hidden', mode !== 'service');
      $('materials-mode').classList.toggle('hidden', mode !== 'materials');
      $('btn-service').classList.toggle('active', mode === 'service');
      $('btn-materials').classList.toggle('active', mode === 'materials');
      showToast(`Switched to ${mode === 'service' ? 'Service Call' : 'Materials'} mode`);
    }
    
    function setCallType(type) {
      callType = type;
      $('call-trouble').classList.toggle('active', type === 'trouble');
      $('call-maintenance').classList.toggle('active', type === 'maintenance');
    }
    
    function setSystemMode(mode) {
      systemMode = mode;
      $('mode-cooling').classList.toggle('active', mode === 'cooling');
      $('mode-heating').classList.toggle('active', mode === 'heating');
      $('cooling-measurements').classList.toggle('hidden', mode !== 'cooling');
      $('heating-measurements').classList.toggle('hidden', mode !== 'heating');
      calculateDiagnostics();
    }
    
    function updateUnitFields() {
      const unitType = $('unit-type').value;
      const outdoorGroup = $('outdoor-unit-group');
      if (unitType === 'package' || unitType === 'mini-split') {
        outdoorGroup.classList.add('hidden');
      } else {
        outdoorGroup.classList.remove('hidden');
      }
    }
    
    function updateCheckbox(checkbox) {
      const label = checkbox.closest('.checkbox-label');
      label.classList.toggle('checked', checkbox.checked);
    }
    
    // ==================== DIAGNOSTIC CALCULATIONS ====================
    function calculateDiagnostics() {
      if (systemMode === 'cooling') {
        calculateCoolingDiagnostics();
      } else {
        calculateHeatingDiagnostics();
      }
    }
    
    function calculateCoolingDiagnostics() {
      const returnTemp = parseFloat($('return-temp').value);
      const supplyTemp = parseFloat($('supply-temp').value);
      const suctionPressure = parseFloat($('suction-pressure').value);
      const suctionTemp = parseFloat($('suction-temp').value);
      const liquidPressure = parseFloat($('liquid-pressure').value);
      const liquidTemp = parseFloat($('liquid-temp').value);
      
      // Calculate Delta-T
      if (!isNaN(returnTemp) && !isNaN(supplyTemp)) {
        const deltaT = returnTemp - supplyTemp;
        $('delta-t').value = `${deltaT.toFixed(1)}°F`;
      }
      
      // Calculate Superheat
      if (!isNaN(suctionPressure) && !isNaN(suctionTemp)) {
        const satTemp = getSaturationTemp(suctionPressure);
        if (satTemp) {
          const superheat = suctionTemp - satTemp;
          $('superheat').value = `${superheat.toFixed(1)}°F`;
        }
      }
      
      // Calculate Subcool
      if (!isNaN(liquidPressure) && !isNaN(liquidTemp)) {
        const satTemp = getSaturationTemp(liquidPressure);
        if (satTemp) {
          const subcool = satTemp - liquidTemp;
          $('subcool').value = `${subcool.toFixed(1)}°F`;
        }
      }
      
      // Run diagnostic analysis
      runDiagnosticAnalysis();
    }
    
    function calculateHeatingDiagnostics() {
      const returnTemp = parseFloat($('return-temp-heat').value);
      const supplyTemp = parseFloat($('supply-temp-heat').value);
      
      if (!isNaN(returnTemp) && !isNaN(supplyTemp)) {
        const tempRise = supplyTemp - returnTemp;
        $('temp-rise').value = `${tempRise.toFixed(1)}°F`;
      }
      
      runDiagnosticAnalysis();
    }
    
    function getSaturationTemp(pressure) {
      const pressures = Object.keys(R410A_PT).map(Number);
      const closest = pressures.reduce((prev, curr) => 
        Math.abs(curr - pressure) < Math.abs(prev - pressure) ? curr : prev
      );
      return R410A_PT[closest];
    }
    
    // ==================== MASTER TECH DIAGNOSTIC ENGINE ====================
    function runDiagnosticAnalysis() {
      diagnosticResults = [];
      
      if (systemMode === 'cooling') {
        analyzeCoolingSystem();
      } else {
        analyzeHeatingSystem();
      }
      
      displayDiagnosticResults();
    }
    
    function analyzeCoolingSystem() {
      const returnTemp = parseFloat($('return-temp').value);
      const supplyTemp = parseFloat($('supply-temp').value);
      const deltaT = returnTemp && supplyTemp ? returnTemp - supplyTemp : null;
      const staticPressure = parseFloat($('static-pressure').value);
      const superheat = parseFloat($('superheat').value.replace('°F', ''));
      const subcool = parseFloat($('subcool').value.replace('°F', ''));
      
      // Airflow Analysis
      if (deltaT !== null) {
        if (deltaT < 14) {
          diagnosticResults.push({
            category: 'Airflow',
            severity: 'critical',
            title: 'Low Delta-T Detected',
            message: `Delta-T is ${deltaT.toFixed(1)}°F (Expected: 16-22°F)`,
            recommendations: [
              'Check filter condition - replace if dirty',
              'Inspect evaporator coil for dirt/restrictions',
              'Verify blower motor operation and speed',
              'Check for closed or blocked supply vents',
              'Measure static pressure to confirm restriction',
              'Consider refrigerant charge if airflow is confirmed good'
            ]
          });
        } else if (deltaT >= 16 && deltaT <= 22) {
          diagnosticResults.push({
            category: 'Airflow',
            severity: 'good',
            title: 'Delta-T in Optimal Range',
            message: `Delta-T is ${deltaT.toFixed(1)}°F - System airflow is good`,
            recommendations: []
          });
        } else if (deltaT > 24) {
          diagnosticResults.push({
            category: 'Airflow',
            severity: 'warning',
            title: 'High Delta-T - Possible Restriction',
            message: `Delta-T is ${deltaT.toFixed(1)}°F (Expected: 16-22°F)`,
            recommendations: [
              'Check filter immediately - likely very dirty',
              'Inspect ductwork for kinks or crushing',
              'Check blower speed settings',
              'Verify return air path is unrestricted'
            ]
          });
        }
      }
      
      // Static Pressure Analysis
      if (!isNaN(staticPressure)) {
        if (staticPressure > 0.7) {
          diagnosticResults.push({
            category: 'Airflow',
            severity: 'critical',
            title: 'High Static Pressure',
            message: `Static pressure is ${staticPressure.toFixed(2)} in w.c. (Max: 0.50 acceptable)`,
            recommendations: [
              'Replace filter immediately if dirty',
              'Inspect ductwork for restrictions',
              'Check for closed dampers',
              'Verify proper duct sizing for tonnage'
            ]
          });
        } else if (staticPressure <= 0.5) {
          diagnosticResults.push({
            category: 'Airflow',
            severity: 'good',
            title: 'Static Pressure Acceptable',
            message: `Static pressure is ${staticPressure.toFixed(2)} in w.c.`,
            recommendations: []
          });
        }
      }
      
      // Refrigerant Charge Analysis
      if (!isNaN(superheat) && !isNaN(subcool)) {
        if (superheat > 20 && subcool < 8) {
          diagnosticResults.push({
            category: 'Refrigerant',
            severity: 'critical',
            title: 'System Appears Undercharged',
            message: `Superheat: ${superheat.toFixed(1)}°F, Subcool: ${subcool.toFixed(1)}°F`,
            recommendations: [
              'Check for refrigerant leaks at evaporator coil',
              'Inspect service valve connections',
              'Look for oil residue at brazed joints',
              'Check line set for damage/leaks',
              'Add refrigerant by weight or subcool method',
              'Re-verify charge after adding refrigerant'
            ]
          });
        } else if (superheat < 5 && subcool > 15) {
          diagnosticResults.push({
            category: 'Refrigerant',
            severity: 'warning',
            title: 'System May Be Overcharged',
            message: `Superheat: ${superheat.toFixed(1)}°F, Subcool: ${subcool.toFixed(1)}°F`,
            recommendations: [
              'Verify charge was not added incorrectly',
              'Check for non-condensables in system',
              'Confirm outdoor unit has adequate airflow',
              'Consider recovering excess refrigerant'
            ]
          });
        } else if (superheat >= 8 && superheat <= 15 && subcool >= 8 && subcool <= 12) {
          diagnosticResults.push({
            category: 'Refrigerant',
            severity: 'good',
            title: 'Refrigerant Charge Within Range',
            message: `Superheat: ${superheat.toFixed(1)}°F, Subcool: ${subcool.toFixed(1)}°F`,
            recommendations: []
          });
        } else if (superheat > 25 && subcool >= 8) {
          diagnosticResults.push({
            category: 'Refrigerant',
            severity: 'critical',
            title: 'Possible TXV Failure',
            message: `High superheat with normal subcool suggests TXV issue`,
            recommendations: [
              'Check TXV bulb placement and contact',
              'Verify TXV is not stuck closed',
              'Inspect sensing bulb for damage',
              'Consider TXV replacement'
            ]
          });
        }
      }
    }
    
    function analyzeHeatingSystem() {
      const returnTemp = parseFloat($('return-temp-heat').value);
      const supplyTemp = parseFloat($('supply-temp-heat').value);
      const tempRise = supplyTemp && returnTemp ? supplyTemp - returnTemp : null;
      const manifoldPressure = parseFloat($('manifold-pressure').value);
      
      // Temperature Rise Analysis
      if (tempRise !== null) {
        if (tempRise < 35) {
          diagnosticResults.push({
            category: 'Heating',
            severity: 'critical',
            title: 'Low Temperature Rise',
            message: `Temp rise is ${tempRise.toFixed(1)}°F (Expected: 35-65°F)`,
            recommendations: [
              'Check gas input - verify manifold pressure',
              'Inspect burners for proper flame pattern',
              'Check for excessive airflow (blower speed too high)',
              'Verify gas valve is fully opening'
            ]
          });
        } else if (tempRise > 65) {
          diagnosticResults.push({
            category: 'Heating',
            severity: 'critical',
            title: 'High Temperature Rise',
            message: `Temp rise is ${tempRise.toFixed(1)}°F (Expected: 35-65°F)`,
            recommendations: [
              'Check airflow - possible restriction',
              'Verify blower speed is correct',
              'Inspect heat exchanger for restrictions',
              'Check limit switches for proper operation'
            ]
          });
        } else {
          diagnosticResults.push({
            category: 'Heating',
            severity: 'good',
            title: 'Temperature Rise in Range',
            message: `Temp rise is ${tempRise.toFixed(1)}°F`,
            recommendations: []
          });
        }
      }
      
      // Manifold Pressure Analysis
      if (!isNaN(manifoldPressure)) {
        if (manifoldPressure < 3.3 || manifoldPressure > 3.8) {
          diagnosticResults.push({
            category: 'Heating',
            severity: 'warning',
            title: 'Manifold Pressure Out of Range',
            message: `Manifold pressure is ${manifoldPressure.toFixed(2)} in w.c. (Expected: 3.3-3.8)`,
            recommendations: [
              'Adjust gas valve regulator',
              'Check gas supply pressure',
              'Verify proper orifice size for gas type',
              'Consult furnace specifications'
            ]
          });
        } else {
          diagnosticResults.push({
            category: 'Heating',
            severity: 'good',
            title: 'Manifold Pressure Acceptable',
            message: `Manifold pressure is ${manifoldPressure.toFixed(2)} in w.c.`,
            recommendations: []
          });
        }
      }
    }
    
    function displayDiagnosticResults() {
      const container = $('diagnostic-results');
      
      if (diagnosticResults.length === 0) {
        container.classList.add('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      
      let html = '<div class="diagnostic-panel animate-in">';
      html += '<div class="diagnostic-title">🎯 Master Tech Diagnostic Analysis</div>';
      
      diagnosticResults.forEach(result => {
        html += '<div class="diagnostic-card">';
        html += '<div class="diagnostic-card-header">';
        html += `<div class="diagnostic-card-title">${result.title}</div>`;
        html += `<span class="severity-badge severity-${result.severity}">${result.severity}</span>`;
        html += '</div>';
        html += `<p style="color: var(--gray-700); margin-bottom: var(--spacing-sm);">${result.message}</p>`;
        
        if (result.recommendations.length > 0) {
          html += '<div class="recommendations">';
          html += '<strong style="font-size: 13px; color: var(--gray-700);">Recommended Actions:</strong>';
          html += '<ul>';
          result.recommendations.forEach(rec => {
            html += `<li>${rec}</li>`;
          });
          html += '</ul>';
          html += '</div>';
        }
        
        html += '</div>';
      });
      
      html += '</div>';
      container.innerHTML = html;
    }
    
    // ==================== MATERIALS MANAGEMENT ====================
    function initMaterialsCatalog() {
      const catalog = $('materials-catalog');
      let html = '';
      
      Object.keys(materialsCatalog).forEach(category => {
        html += `<div class="card-subtitle">${category}</div>`;
        
        materialsCatalog[category].forEach(item => {
          html += '<label class="checkbox-label">';
          html += `<input type="checkbox" onchange="toggleMaterial('${category}', '${item.name}', '${item.spec}', '${item.unit}')">`;
          html += '<div>';
          html += `<div class="material-name">${item.name}</div>`;
          html += `<div class="material-spec">${item.spec}</div>`;
          html += '</div>';
          html += '</label>';
        });
      });
      
      catalog.innerHTML = html;
    }
    
    function toggleMaterial(category, name, spec, unit) {
      const existing = selectedMaterials.find(m => m.name === name);
      
      if (existing) {
        selectedMaterials = selectedMaterials.filter(m => m.name !== name);
      } else {
        selectedMaterials.push({ category, name, spec, unit, quantity: 1 });
      }
      
      displaySelectedMaterials();
    }
    
    function displaySelectedMaterials() {
      const container = $('selected-materials');
      
      if (selectedMaterials.length === 0) {
        container.innerHTML = '<div class="status-info"><span>ℹ️</span><span>No materials selected yet.</span></div>';
        return;
      }
      
      let html = '';
      selectedMaterials.forEach((item, index) => {
        html += '<div class="material-item">';
        html += '<div class="material-info">';
        html += `<div class="material-name">${item.name}</div>`;
        html += `<div class="material-spec">${item.spec}</div>`;
        html += '</div>';
        html += `<input type="number" class="material-quantity" value="${item.quantity}" min="1" onchange="updateQuantity(${index}, this.value)" style="width: 80px; margin: 0;">`;
        html += '</div>';
      });
      
      container.innerHTML = html;
    }
    
    function updateQuantity(index, value) {
      selectedMaterials[index].quantity = parseInt(value) || 1;
    }
    
    // ==================== REPORT GENERATION ====================
    function generateServiceReport() {
      const customer = $('customer-name').value || 'N/A';
      const date = $('service-date').value || new Date().toISOString().split('T')[0];
      const address = $('service-address').value || 'N/A';
      const complaint = $('customer-complaint').value || 'N/A';
      const tech = $('tech-name').value || 'Technician';
      
      let report = `╔════════════════════════════════════════════════════════════╗
║       FIELD BUDDY PRO - SERVICE REPORT (v2.0)              ║
╚════════════════════════════════════════════════════════════╝

JOB INFORMATION
───────────────────────────────────────────────────────────────
Customer: ${customer}
Date: ${date}
Address: ${address}
Call Type: ${callType === 'trouble' ? 'Trouble Call' : 'Maintenance'}
System Mode: ${systemMode === 'cooling' ? 'Cooling' : 'Heating'}

Customer Complaint:
${complaint}

EQUIPMENT INFORMATION
───────────────────────────────────────────────────────────────
Unit Type: ${$('unit-type').value || 'N/A'}
Indoor Unit: ${$('indoor-unit').value || 'N/A'}
Outdoor Unit: ${$('outdoor-unit').value || 'N/A'}
Tonnage: ${$('tonnage').value || 'N/A'} Ton
Refrigerant: ${$('refrigerant-type').value || 'R-410A'}
Filter Size: ${$('filter-size').value || 'N/A'}

`;

      // Add measurements
      if (systemMode === 'cooling') {
        report += `COOLING MEASUREMENTS
───────────────────────────────────────────────────────────────
Ambient Temp: ${$('ambient-temp').value || 'N/A'}°F
Return Air Temp: ${$('return-temp').value || 'N/A'}°F
Supply Air Temp: ${$('supply-temp').value || 'N/A'}°F
Delta-T: ${$('delta-t').value || 'N/A'}

Suction Pressure: ${$('suction-pressure').value || 'N/A'} PSI
Suction Line Temp: ${$('suction-temp').value || 'N/A'}°F
Superheat: ${$('superheat').value || 'N/A'}

Liquid Pressure: ${$('liquid-pressure').value || 'N/A'} PSI
Liquid Line Temp: ${$('liquid-temp').value || 'N/A'}°F
Subcool: ${$('subcool').value || 'N/A'}

Static Pressure: ${$('static-pressure').value || 'N/A'} in w.c.
Voltage: ${$('voltage').value || 'N/A'} V
Amperage: ${$('amperage').value || 'N/A'} A

`;
      } else {
        report += `HEATING MEASUREMENTS
───────────────────────────────────────────────────────────────
Return Air Temp: ${$('return-temp-heat').value || 'N/A'}°F
Supply Air Temp: ${$('supply-temp-heat').value || 'N/A'}°F
Temperature Rise: ${$('temp-rise').value || 'N/A'}

Manifold Pressure: ${$('manifold-pressure').value || 'N/A'} in w.c.
Voltage: ${$('voltage-heat').value || 'N/A'} V
Amperage: ${$('amperage-heat').value || 'N/A'} A

`;
      }

      // Add diagnostic results
      if (diagnosticResults.length > 0) {
        report += `DIAGNOSTIC ANALYSIS
═══════════════════════════════════════════════════════════════

`;
        diagnosticResults.forEach(result => {
          report += `${result.category.toUpperCase()} - ${result.title}
Severity: ${result.severity.toUpperCase()}
${result.message}

`;
          if (result.recommendations.length > 0) {
            report += 'Recommended Actions:\n';
            result.recommendations.forEach(rec => {
              report += `  • ${rec}\n`;
            });
            report += '\n';
          }
        });
      }

      // Add findings and work performed
      report += `FINDINGS & RECOMMENDATIONS
───────────────────────────────────────────────────────────────
Findings:
${$('findings').value || 'See diagnostic analysis above.'}

Recommendations:
${$('recommendations').value || 'N/A'}

Work Performed:
${$('work-performed').value || 'N/A'}

TECHNICIAN INFORMATION
───────────────────────────────────────────────────────────────
Technician: ${tech}
Generated: ${new Date().toLocaleString()}

───────────────────────────────────────────────────────────────
This report was generated by Field Buddy Pro v2.0 Master Tech Edition
`;

      displayReport(report, '✓ Service Report Generated');
      showToast('Service report generated successfully!', 'success');
    }
    
    function generateMaterialsList() {
      const customer = $('mat-customer').value || 'N/A';
      const date = $('mat-date').value || new Date().toISOString().split('T')[0];
      const address = $('mat-address').value || 'N/A';
      const notes = $('mat-notes').value || 'N/A';
      const tech = $('mat-tech-name').value || 'Technician';
      
      let report = `╔════════════════════════════════════════════════════════════╗
║       FIELD BUDDY PRO - MATERIALS LIST (v2.0)              ║
╚════════════════════════════════════════════════════════════╝

JOB INFORMATION
───────────────────────────────────────────────────────────────
Customer/Job: ${customer}
Date: ${date}
Address: ${address}
Notes: ${notes}

MATERIALS NEEDED
═══════════════════════════════════════════════════════════════

`;

      if (selectedMaterials.length === 0) {
        report += 'No materials added to list.\n\n';
      } else {
        // Group by category
        const grouped = {};
        selectedMaterials.forEach(item => {
          if (!grouped[item.category]) grouped[item.category] = [];
          grouped[item.category].push(item);
        });
        
        Object.keys(grouped).forEach(category => {
          report += `${category}:\n`;
          report += '─'.repeat(60) + '\n';
          grouped[category].forEach(item => {
            report += `☐ ${item.name}\n`;
            report += `  Spec: ${item.spec}\n`;
            report += `  Quantity: ${item.quantity} ${item.unit}\n\n`;
          });
          report += '\n';
        });
        
        const totalQty = selectedMaterials.reduce((sum, m) => sum + m.quantity, 0);
        report += '═'.repeat(60) + '\n';
        report += `TOTAL ITEMS: ${totalQty}\n`;
        report += `TOTAL LINE ITEMS: ${selectedMaterials.length}\n`;
        report += '═'.repeat(60) + '\n';
      }

      report += `\nTECHNICIAN INFORMATION
───────────────────────────────────────────────────────────────
Technician: ${tech}
Generated: ${new Date().toLocaleString()}

───────────────────────────────────────────────────────────────
This list was generated by Field Buddy Pro v2.0 Master Tech Edition
`;

      displayReport(report, '✓ Materials List Generated');
      showToast('Materials list generated successfully!', 'success');
    }
    
    function displayReport(text, title) {
      const container = $('report-container');
      
      let html = '<div class="card animate-in">';
      html += '<div class="card-header">';
      html += `<div class="card-title"><span>📄</span><span>${title}</span></div>`;
      html += '</div>';
      html += '<div class="status-good"><span>✓</span><span>Report ready to copy or print</span></div>';
      html += `<pre class="report-preview">${text}</pre>`;
      html += '<div class="grid grid-2" style="margin-top: var(--spacing-lg);">';
      html += '<button class="btn btn-success" onclick="copyReport()"><span>📋</span><span>Copy to Clipboard</span></button>';
      html += '<button class="btn btn-secondary" onclick="printReport()"><span>🖨️</span><span>Print Report</span></button>';
      html += '</div>';
      html += '</div>';
      
      container.innerHTML = html;
      container.scrollIntoView({ behavior: 'smooth' });
    }
    
    function copyReport() {
      const text = document.querySelector('.report-preview').textContent;
      
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      
      try {
        document.execCommand('copy');
        showToast('✓ Copied to clipboard!', 'success');
      } catch (err) {
        showToast('Failed to copy. Please copy manually.', 'danger');
      }
      
      document.body.removeChild(textarea);
    }
    
    function printReport() {
      const text = document.querySelector('.report-preview').textContent;
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <html>
        <head>
          <title>Field Buddy Pro Report</title>
          <style>
            body {
              font-family: 'Courier New', monospace;
              font-size: 12px;
              line-height: 1.4;
              margin: 0.5in;
              white-space: pre-wrap;
            }
            @media print {
              body { margin: 0.25in; }
            }
          </style>
        </head>
        <body>${text}</body>
        </html>
      `);
      printWindow.document.close();
      printWindow.focus();
      setTimeout(() => {
        printWindow.print();
        printWindow.close();
      }, 250);
    }
    
    // ==================== CLEAR FORM ====================
    async function clearForm() {
      const confirmed = await showModal(
        'Clear Form',
        'Are you sure you want to clear all data? This cannot be undone.'
      );
      
      if (!confirmed) return;
      
      document.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'checkbox') {
          el.checked = false;
          const label = el.closest('.checkbox-label');
          if (label) label.classList.remove('checked');
        } else if (el.id !== 'service-date' && el.id !== 'mat-date') {
          el.value = '';
        }
      });
      
      selectedMaterials = [];
      diagnosticResults = [];
      displaySelectedMaterials();
      $('diagnostic-results').classList.add('hidden');
      $('report-container').innerHTML = '';
      
      showToast('Form cleared successfully', 'success');
    }
    
    // ==================== INITIALIZATION ====================
    window.addEventListener('load', () => {
      const today = new Date().toISOString().split('T')[0];
      $('service-date').value = today;
      $('mat-date').value = today;
      
      initMaterialsCatalog();
      
      console.log('%c🔧 Field Buddy Pro v2.0 - Master Tech Edition Loaded', 
        'color: #0066FF; font-size: 16px; font-weight: bold;');
      console.log('%cFeatures: Master-level diagnostics, 2025 materials catalog, intelligent analysis', 
        'color: #666; font-size: 12px;');
    });
  </script>
</body>
</html>