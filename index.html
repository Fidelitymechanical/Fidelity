
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <title>Field Buddy - Real Tech Edition</title>
  <style>
    /* Ultra-minimal - I'm standing in an attic, I need BIG targets */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font: 16px -apple-system, system-ui, sans-serif;
      background: #f5f5f5;
      padding: 8px;
      padding-bottom: 80px; /* Room for sticky footer */
    }
    
    /* Every input needs to be 48px min for fat-finger friendliness */
    input, select, textarea, button {
      font-size: 16px; /* Prevents iOS zoom */
      padding: 14px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 100%;
      margin: 8px 0;
      -webkit-appearance: none;
    }
    
    button {
      background: #007AFF;
      color: white;
      font-weight: 600;
      border: none;
      min-height: 48px;
    }
    
    button.secondary { background: #666; }
    button.danger { background: #FF3B30; }
    button.success { background: #34C759; }
    
    /* Cards for each section */
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .card-header {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #eee;
    }
    
    /* Two-column layout for temps, pressures */
    .grid { 
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    /* Auto-calculated fields - different style */
    input[readonly] {
      background: #f8f8f8;
      color: #666;
      cursor: not-allowed;
    }
    
    /* Status indicators */
    .status {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .status.good { background: #D1F4E0; color: #0F5132; }
    .status.warn { background: #FFF3CD; color: #664D03; }
    .status.bad { background: #F8D7DA; color: #842029; }
    
    /* Voice button overlay */
    .voice-wrapper {
      position: relative;
    }
    .voice-btn {
      position: absolute;
      right: 4px;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      padding: 0;
      background: #007AFF;
      border-radius: 50%;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .voice-btn.listening { 
      background: #FF3B30;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    /* Sticky action bar */
    .actions {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 12px;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      display: flex;
      gap: 8px;
    }
    
    label {
      display: block;
      font-size: 13px;
      color: #666;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    /* Hide cooling/heating specific fields by default */
    .cooling-only, .heating-only { display: none; }
    body.mode-cooling .cooling-only { display: block; }
    body.mode-heating .heating-only { display: block; }
  </style>
</head>
<body class="mode-cooling">

  <!-- Job Context -->
  <div class="card">
    <div class="card-header">Job Info</div>
    <input type="text" id="customer" placeholder="Customer name">
    <input type="text" id="address" placeholder="Address">
    <textarea id="complaint" placeholder="Customer complaint (in their words)" rows="2"></textarea>
  </div>

  <!-- Equipment Identity -->
  <div class="card">
    <div class="card-header">Equipment</div>
    <input type="text" id="location" placeholder="Location (e.g., Attic above master BR)">
    <div class="voice-wrapper">
      <input type="text" id="indoor-data" placeholder="Indoor unit: Brand/Model/Serial">
      <button class="voice-btn" data-voice="indoor-data">üé§</button>
    </div>
    <div class="voice-wrapper">
      <input type="text" id="outdoor-data" placeholder="Outdoor unit: Brand/Model/Serial">
      <button class="voice-btn" data-voice="outdoor-data">üé§</button>
    </div>
    <input type="date" id="mfg-date">
    <select id="refrigerant">
      <option>Refrigerant type...</option>
      <option>R-410A</option>
      <option>R-22</option>
      <option>R-32</option>
    </select>
    
    <!-- Mode toggle -->
    <div style="display: flex; gap: 8px; margin-top: 8px;">
      <button onclick="setMode('cooling')" id="btn-cooling">‚ùÑÔ∏è Cooling</button>
      <button onclick="setMode('heating')" id="btn-heating" class="secondary">üî• Heating</button>
    </div>
  </div>

  <!-- Safety Check -->
  <div class="card">
    <div class="card-header">Safety (Do NOT skip)</div>
    <label><input type="checkbox" id="safety-disconnect"> Disconnect present & functional</label>
    <label><input type="checkbox" id="safety-clearances"> Clearances adequate</label>
    <label><input type="checkbox" id="safety-drain"> Drain trapped & flowing</label>
    <label><input type="checkbox" id="safety-floats"> Float switches tested</label>
    
    <div class="heating-only">
      <label><input type="checkbox" id="safety-gas"> Gas piping condition OK</label>
      <label><input type="checkbox" id="safety-vent"> Vent termination secure</label>
      <label><input type="checkbox" id="safety-co"> No CO detected</label>
    </div>
    
    <div class="voice-wrapper">
      <textarea id="safety-notes" placeholder="Any safety concerns" rows="2"></textarea>
      <button class="voice-btn" data-voice="safety-notes" style="top: 24px;">üé§</button>
    </div>
  </div>

  <!-- Operating Conditions -->
  <div class="card">
    <div class="card-header">Operating Conditions</div>
    
    <!-- Temps -->
    <div class="grid">
      <div>
        <label>Outdoor Temp (¬∞F)</label>
        <input type="number" id="outdoor-temp" step="0.1" inputmode="decimal">
      </div>
      <div>
        <label>Outdoor RH (%)</label>
        <input type="number" id="outdoor-rh" inputmode="decimal">
      </div>
    </div>
    
    <div class="grid">
      <div>
        <label>Return Air (¬∞F)</label>
        <input type="number" id="return-temp" step="0.1" inputmode="decimal" oninput="calcDelta()">
      </div>
      <div>
        <label>Supply Air (¬∞F)</label>
        <input type="number" id="supply-temp" step="0.1" inputmode="decimal" oninput="calcDelta()">
      </div>
    </div>
    
    <label>Delta T (auto)</label>
    <input type="text" id="delta-t" readonly>
    <div id="delta-status"></div>
    
    <!-- Static -->
    <div class="grid">
      <div>
        <label>Return Static (in w.c.)</label>
        <input type="number" id="return-static" step="0.01" inputmode="decimal" oninput="calcStatic()">
      </div>
      <div>
        <label>Supply Static (in w.c.)</label>
        <input type="number" id="supply-static" step="0.01" inputmode="decimal" oninput="calcStatic()">
      </div>
    </div>
    
    <label>Total Static (auto)</label>
    <input type="text" id="total-static" readonly>
    <div id="static-status"></div>
    
    <!-- Voltage -->
    <div class="grid">
      <div>
        <label>Voltage L1-L2</label>
        <input type="number" id="voltage-line" inputmode="decimal">
      </div>
      <div>
        <label>Voltage L1-N</label>
        <input type="number" id="voltage-neutral" inputmode="decimal">
      </div>
    </div>
    
    <!-- Cooling-specific -->
    <div class="cooling-only">
      <div class="grid">
        <div>
          <label>Suction Pressure (psig)</label>
          <input type="number" id="suction-pressure" step="0.1" inputmode="decimal" oninput="calcSuperheat()">
        </div>
        <div>
          <label>Liquid Pressure (psig)</label>
          <input type="number" id="liquid-pressure" step="0.1" inputmode="decimal" oninput="calcSubcool()">
        </div>
      </div>
      
      <div class="grid">
        <div>
          <label>Suction Line Temp (¬∞F)</label>
          <input type="number" id="suction-temp" step="0.1" inputmode="decimal" oninput="calcSuperheat()">
        </div>
        <div>
          <label>Liquid Line Temp (¬∞F)</label>
          <input type="number" id="liquid-temp" step="0.1" inputmode="decimal" oninput="calcSubcool()">
        </div>
      </div>
      
      <label>Superheat (auto)</label>
      <input type="text" id="superheat" readonly>
      <div id="superheat-status"></div>
      
      <label>Subcool (auto)</label>
      <input type="text" id="subcool" readonly>
      <div id="subcool-status"></div>
      
      <div class="grid">
        <div>
          <label>Compressor Amps</label>
          <input type="text" id="comp-amps" placeholder="Actual/Rated">
        </div>
        <div>
          <label>Condenser Fan Amps</label>
          <input type="number" id="cond-fan-amps" step="0.1" inputmode="decimal">
        </div>
      </div>
    </div>
    
    <!-- Heating-specific -->
    <div class="heating-only">
      <div class="grid">
        <div>
          <label>Gas Input (BTU/hr)</label>
          <input type="number" id="gas-input" inputmode="decimal">
        </div>
        <div>
          <label>Manifold Pressure (in w.c.)</label>
          <input type="number" id="manifold" step="0.1" inputmode="decimal">
        </div>
      </div>
      
      <label>Inducer Amps</label>
      <input type="number" id="inducer-amps" step="0.1" inputmode="decimal">
    </div>
    
    <label>Blower Amps</label>
    <input type="text" id="blower-amps" placeholder="Actual/Rated">
  </div>

  <!-- Component Condition -->
  <div class="card">
    <div class="card-header">Components</div>
    
    <div class="voice-wrapper">
      <input type="text" id="filter" placeholder="Filter size and condition">
      <button class="voice-btn" data-voice="filter">üé§</button>
    </div>
    
    <select id="evap-coil">
      <option>Evap coil condition...</option>
      <option>Clean</option>
      <option>Light dust</option>
      <option>Restricted - needs cleaning</option>
      <option>Corroded</option>
      <option>Leaking</option>
    </select>
    
    <select id="cond-coil">
      <option>Cond coil condition...</option>
      <option>Clean</option>
      <option>Light debris</option>
      <option>Restricted - needs cleaning</option>
      <option>Bent fins</option>
      <option>Corroded</option>
    </select>
    
    <div class="voice-wrapper">
      <input type="text" id="capacitor" placeholder="Capacitor: Actual/Rated ¬µF">
      <button class="voice-btn" data-voice="capacitor">üé§</button>
    </div>
    
    <select id="contactor">
      <option>Contactor condition...</option>
      <option>Good - clean contacts</option>
      <option>Light pitting</option>
      <option>Heavy pitting - recommend replacement</option>
      <option>Burned/welded</option>
    </select>
  </div>

  <!-- Findings -->
  <div class="card">
    <div class="card-header">Findings & Recommendations</div>
    <div class="voice-wrapper">
      <textarea id="findings" placeholder="What's wrong and why" rows="3"></textarea>
      <button class="voice-btn" data-voice="findings" style="top: 24px;">üé§</button>
    </div>
    
    <div class="voice-wrapper">
      <textarea id="recommendations" placeholder="Repair options and next steps" rows="3"></textarea>
      <button class="voice-btn" data-voice="recommendations" style="top: 24px;">üé§</button>
    </div>
  </div>

  <!-- Photos -->
  <div class="card">
    <div class="card-header">Photos</div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
      <button onclick="takePhoto('nameplate')" class="secondary">üì∑ Nameplate</button>
      <button onclick="takePhoto('coil')" class="secondary">üì∑ Coil</button>
      <button onclick="takePhoto('leak')" class="secondary">üì∑ Leak/Damage</button>
      <button onclick="takePhoto('other')" class="secondary">üì∑ Other</button>
    </div>
    <div id="photo-preview" style="margin-top: 12px;"></div>
  </div>

  <!-- Sticky action bar -->
  <div class="actions">
    <button onclick="generateReport()" class="success">Generate Report</button>
    <button onclick="exportPDF()" class="secondary">üìÑ PDF</button>
  </div>

  <script>
    // ==================== UTILITIES ====================
    const $ = id => document.getElementById(id);
    const num = val => { const n = parseFloat(val); return isNaN(n) ? null : n; };
    
    // ==================== MODE SWITCHING ====================
    function setMode(mode) {
      document.body.className = `mode-${mode}`;
      $('btn-cooling').className = mode === 'cooling' ? '' : 'secondary';
      $('btn-heating').className = mode === 'heating' ? '' : 'secondary';
    }
    
    // ==================== CALCULATIONS ====================
    function calcDelta() {
      const ret = num($('return-temp').value);
      const sup = num($('supply-temp').value);
      const mode = document.body.classList.contains('mode-cooling') ? 'cooling' : 'heating';
      
      if (ret === null || sup === null) return;
      
      const delta = mode === 'cooling' ? ret - sup : sup - ret;
      $('delta-t').value = delta.toFixed(1) + ' ¬∞F';
      
      // Status check
      const statusDiv = $('delta-status');
      if (mode === 'cooling') {
        if (delta < 14) {
          statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è Low delta - check airflow or oversizing</div>';
        } else if (delta > 24) {
          statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è High delta - possible low charge</div>';
        } else if (delta >= 16 && delta <= 22) {
          statusDiv.innerHTML = '<div class="status good">‚úì Delta T in optimal range</div>';
        } else {
          statusDiv.innerHTML = '<div class="status warn">‚ö†Ô∏è Delta T slightly off - monitor</div>';
        }
      } else {
        if (delta < 25) {
          statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è Low rise - check gas input or airflow</div>';
        } else if (delta > 90) {
          statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è High rise - possible airflow restriction</div>';
        } else if (delta >= 30 && delta <= 80) {
          statusDiv.innerHTML = '<div class="status good">‚úì Temperature rise in range</div>';
        } else {
          statusDiv.innerHTML = '<div class="status warn">‚ö†Ô∏è Temperature rise marginal</div>';
        }
      }
    }
    
    function calcStatic() {
      const ret = num($('return-static').value);
      const sup = num($('supply-static').value);
      
      if (ret === null || sup === null) return;
      
      const total = Math.abs(ret) + Math.abs(sup);
      $('total-static').value = total.toFixed(2) + ' in w.c.';
      
      const statusDiv = $('static-status');
      if (total <= 0.50) {
        statusDiv.innerHTML = '<div class="status good">‚úì Static pressure acceptable</div>';
      } else if (total <= 0.70) {
        statusDiv.innerHTML = '<div class="status warn">‚ö†Ô∏è Static pressure elevated - check ductwork</div>';
      } else {
        statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è Static pressure excessive - duct issues likely</div>';
      }
    }
    
    // Simplified PT chart for R-410A (subset for demo)
    const R410A_PT = {
      100: 50, 110: 55, 118: 60, 128: 65, 139: 70, 151: 75, 164: 80
    };
    
    function lookupSatTemp(psig, refrigerant) {
      if (refrigerant !== 'R-410A') return null; // Need full implementation
      
      // Find closest pressure
      let closest = null;
      let minDiff = Infinity;
      for (let pressure in R410A_PT) {
        const diff = Math.abs(pressure - psig);
        if (diff < minDiff) {
          minDiff = diff;
          closest = R410A_PT[pressure];
        }
      }
      return closest;
    }
    
    function calcSuperheat() {
      const pressure = num($('suction-pressure').value);
      const lineTemp = num($('suction-temp').value);
      const refrigerant = $('refrigerant').value;
      
      if (!pressure || !lineTemp || !refrigerant) return;
      
      const satTemp = lookupSatTemp(pressure, refrigerant);
      if (!satTemp) return;
      
      const superheat = lineTemp - satTemp;
      $('superheat').value = superheat.toFixed(1) + ' ¬∞F';
      
      const statusDiv = $('superheat-status');
      if (superheat < 5) {
        statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è Low SH - possible overcharge or TXV flooding</div>';
      } else if (superheat > 25) {
        statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è High SH - possible undercharge or restriction</div>';
      } else if (superheat >= 8 && superheat <= 18) {
        statusDiv.innerHTML = '<div class="status good">‚úì Superheat in target range</div>';
      } else {
        statusDiv.innerHTML = '<div class="status warn">‚ö†Ô∏è Superheat marginal - verify charge</div>';
      }
    }
    
    function calcSubcool() {
      const pressure = num($('liquid-pressure').value);
      const lineTemp = num($('liquid-temp').value);
      const refrigerant = $('refrigerant').value;
      
      if (!pressure || !lineTemp || !refrigerant) return;
      
      const satTemp = lookupSatTemp(pressure, refrigerant);
      if (!satTemp) return;
      
      const subcool = satTemp - lineTemp;
      $('subcool').value = subcool.toFixed(1) + ' ¬∞F';
      
      const statusDiv = $('subcool-status');
      if (subcool < 5) {
        statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è Low SC - possible undercharge</div>';
      } else if (subcool > 20) {
        statusDiv.innerHTML = '<div class="status bad">‚ö†Ô∏è High SC - possible overcharge or restriction</div>';
      } else if (subcool >= 8 && subcool <= 15) {
        statusDiv.innerHTML = '<div class="status good">‚úì Subcool in target range</div>';
      } else {
        statusDiv.innerHTML = '<div class="status warn">‚ö†Ô∏è Subcool marginal - verify charge</div>';
      }
    }
    
    // ==================== VOICE INPUT ====================
    let recognition = null;
    let currentTarget = null;
    
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      
      recognition.onresult = (e) => {
        if (currentTarget && e.results[0]) {
          const transcript = e.results[0][0].transcript;
          currentTarget.value = transcript;
          currentTarget.dispatchEvent(new Event('input'));
        }
      };
      
      recognition.onend = () => {
        document.querySelectorAll('.voice-btn.listening').forEach(btn => {
          btn.classList.remove('listening');
        });
      };
    }
    
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('voice-btn')) {
        const targetId = e.target.dataset.voice;
        currentTarget = $(targetId);
        
        if (recognition) {
          e.target.classList.add('listening');
          recognition.start();
        } else {
          alert('Voice input not supported on this device');
        }
      }
    });
    
    // ==================== PHOTOS ====================
    const photos = [];
    
    function takePhoto(purpose) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.capture = 'environment';
      
      input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = (event) => {
          photos.push({
            purpose: purpose,
            data: event.target.result,
            timestamp: new Date().toISOString()
          });
          
          updatePhotoPreview();
        };
        
        reader.readAsDataURL(file);
      };
      
      input.click();
    }
    
    function updatePhotoPreview() {
      const preview = $('photo-preview');
      preview.innerHTML = photos.map((p, i) => 
        `<div style="display:inline-block;margin:4px;position:relative;">
          <img src="${p.data}" style="width:80px;height:80px;object-fit:cover;border-radius:8px;">
          <div style="position:absolute;bottom:4px;left:4px;background:rgba(0,0,0,0.7);color:white;padding:2px 6px;border-radius:4px;font-size:10px;">${p.purpose}</div>
        </div>`
      ).join('');
    }// ==================== REPORT GENERATION ====================
    function generateReport() {
      const mode = document.body.classList.contains('mode-cooling') ? 'Cooling' : 'Heating';
      
      const report = {
        customer: $('customer').value,
        address: $('address').value,
        complaint: $('complaint').value,
        date: new Date().toLocaleDateString(),
        mode: mode,
        
        equipment: {
          location: $('location').value,
          indoor: $('indoor-data').value,
          outdoor: $('outdoor-data').value,
          mfgDate: $('mfg-date').value,
          refrigerant: $('refrigerant').value
        },
        
        safety: {
          disconnect: $('safety-disconnect').checked,
          clearances: $('safety-clearances').checked,
          drain: $('safety-drain').checked,
          floats: $('safety-floats').checked,
          gas: $('safety-gas')?.checked,
          vent: $('safety-vent')?.checked,
          co: $('safety-co')?.checked,
          notes: $('safety-notes').value
        },
        
        operating: {
          outdoorTemp: $('outdoor-temp').value,
          outdoorRH: $('outdoor-rh').value,
          returnTemp: $('return-temp').value,
          supplyTemp: $('supply-temp').value,
          deltaT: $('delta-t').value,
          returnStatic: $('return-static').value,
          supplyStatic: $('supply-static').value,
          totalStatic: $('total-static').value,
          voltageLine: $('voltage-line').value,
          voltageNeutral: $('voltage-neutral').value,
          suctionPressure: $('suction-pressure').value,
          liquidPressure: $('liquid-pressure').value,
          suctionTemp: $('suction-temp').value,
          liquidTemp: $('liquid-temp').value,
          superheat: $('superheat').value,
          subcool: $('subcool').value,
          compAmps: $('comp-amps').value,
          condFanAmps: $('cond-fan-amps').value,
          gasInput: $('gas-input')?.value,
          manifold: $('manifold')?.value,
          inducerAmps: $('inducer-amps')?.value,
          blowerAmps: $('blower-amps').value
        },
        
        components: {
          filter: $('filter').value,
          evapCoil: $('evap-coil').value,
          condCoil: $('cond-coil').value,
          capacitor: $('capacitor').value,
          contactor: $('contactor').value
        },
        
        findings: $('findings').value,
        recommendations: $('recommendations').value,
        photos: photos
      };
      
      // Store in sessionStorage
      sessionStorage.setItem('currentReport', JSON.stringify(report));
      
      // Generate readable summary
      displayReport(report);
    }
    
    function displayReport(report) {
      const summary = `
HVAC SERVICE REPORT
===================

Customer: ${report.customer}
Address: ${report.address}
Date: ${report.date}
Complaint: ${report.complaint}

EQUIPMENT IDENTITY
------------------
Location: ${report.equipment.location}
Indoor Unit: ${report.equipment.indoor}
Outdoor Unit: ${report.equipment.outdoor}
Manufacture Date: ${report.equipment.mfgDate}
Refrigerant: ${report.equipment.refrigerant}
Mode: ${report.mode}

SAFETY INSPECTION
-----------------
${report.safety.disconnect ? '‚úì' : '‚úó'} Disconnect present & functional
${report.safety.clearances ? '‚úì' : '‚úó'} Clearances adequate
${report.safety.drain ? '‚úì' : '‚úó'} Drain trapped & flowing
${report.safety.floats ? '‚úì' : '‚úó'} Float switches tested
${report.mode === 'Heating' ? `
${report.safety.gas ? '‚úì' : '‚úó'} Gas piping OK
${report.safety.vent ? '‚úì' : '‚úó'} Vent termination secure
${report.safety.co ? '‚úì' : '‚úó'} No CO detected` : ''}
Notes: ${report.safety.notes || 'None'}

OPERATING CONDITIONS
--------------------
Outdoor: ${report.operating.outdoorTemp}¬∞F, ${report.operating.outdoorRH}% RH
Return Air: ${report.operating.returnTemp}¬∞F
Supply Air: ${report.operating.supplyTemp}¬∞F
${report.mode === 'Cooling' ? 'Temperature Split' : 'Temperature Rise'}: ${report.operating.deltaT}

Static Pressure:
  Return: ${report.operating.returnStatic} in w.c.
  Supply: ${report.operating.supplyStatic} in w.c.
  Total: ${report.operating.totalStatic}

Electrical:
  Line Voltage: ${report.operating.voltageLine}V
  Neutral Voltage: ${report.operating.voltageNeutral}V
  Blower Amps: ${report.operating.blowerAmps}
${report.mode === 'Cooling' ? `  Compressor Amps: ${report.operating.compAmps}
  Condenser Fan Amps: ${report.operating.condFanAmps}` : `  Inducer Amps: ${report.operating.inducerAmps}`}

${report.mode === 'Cooling' ? `Refrigerant Circuit:
  Suction Pressure: ${report.operating.suctionPressure} psig
  Liquid Pressure: ${report.operating.liquidPressure} psig
  Suction Line Temp: ${report.operating.suctionTemp}¬∞F
  Liquid Line Temp: ${report.operating.liquidTemp}¬∞F
  Superheat: ${report.operating.superheat}
  Subcool: ${report.operating.subcool}` : `Heating Circuit:
  Gas Input: ${report.operating.gasInput} BTU/hr
  Manifold Pressure: ${report.operating.manifold} in w.c.`}

COMPONENT CONDITIONS
--------------------
Filter: ${report.components.filter}
Evaporator Coil: ${report.components.evapCoil}
Condenser Coil: ${report.components.condCoil}
Capacitor: ${report.components.capacitor}
Contactor: ${report.components.contactor}

FINDINGS
--------
${report.findings}

RECOMMENDATIONS
---------------
${report.recommendations}

PHOTOS ATTACHED
---------------
${report.photos.length} photo(s): ${report.photos.map(p => p.purpose).join(', ')}

---
Report generated by Field Buddy
Technician: [Sign here]
`;
      
      // Display in a modal or new section
      const reportCard = document.createElement('div');
      reportCard.className = 'card';
      reportCard.innerHTML = `
        <div class="card-header">Generated Report</div>
        <pre style="white-space: pre-wrap; font-size: 13px; line-height: 1.5; overflow-x: auto;">${summary}</pre>
        <button onclick="copyReport()" class="success">üìã Copy to Clipboard</button>
      `;
      
      // Insert before actions bar
      document.querySelector('.actions').before(reportCard);
      
      // Scroll to report
      reportCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    function copyReport() {
      const report = sessionStorage.getItem('currentReport');
      if (!report) return;
      
      const data = JSON.parse(report);
      const text = document.querySelector('pre').textContent;
      
      navigator.clipboard.writeText(text)
        .then(() => alert('‚úì Report copied to clipboard!'))
        .catch(() => alert('Copy failed - please select and copy manually'));
    }
    
    // ==================== PDF EXPORT ====================
    function exportPDF() {
      const report = sessionStorage.getItem('currentReport');
      if (!report) {
        alert('Generate report first');
        return;
      }
      
      // For now, just download as text
      // In production, you'd use jsPDF or html2pdf
      const data = JSON.parse(report);
      const blob = new Blob([document.querySelector('pre').textContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `HVAC_Report_${data.customer.replace(/\s/g, '_')}_${new Date().toISOString().slice(0,10)}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // ==================== AUTO-SAVE ====================
    function autoSave() {
      const draft = {
        customer: $('customer').value,
        address: $('address').value,
        complaint: $('complaint').value,
        location: $('location').value,
        indoorData: $('indoor-data').value,
        outdoorData: $('outdoor-data').value,
        mfgDate: $('mfg-date').value,
        refrigerant: $('refrigerant').value,
        // Add all other fields...
      };
      
      sessionStorage.setItem('draft', JSON.stringify(draft));
    }
    
    // Auto-save every 10 seconds
    setInterval(autoSave, 10000);
    
    // Auto-save on input
    document.addEventListener('input', () => {
      clearTimeout(window.saveTimer);
      window.saveTimer = setTimeout(autoSave, 2000);
    });
    
    // ==================== LOAD DRAFT ON STARTUP ====================
    window.addEventListener('load', () => {
      const draft = sessionStorage.getItem('draft');
      if (draft && confirm('Resume previous inspection?')) {
        const data = JSON.parse(draft);
        
        $('customer').value = data.customer || '';
        $('address').value = data.address || '';
        $('complaint').value = data.complaint || '';
        $('location').value = data.location || '';
        $('indoor-data').value = data.indoorData || '';
        $('outdoor-data').value = data.outdoorData || '';
        $('mfg-date').value = data.mfgDate || '';
        $('refrigerant').value = data.refrigerant || '';
        // Load all other fields...
      }
    });
  </script>
</body>
</html>
    
    
