<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <meta name="description" content="Professional HVAC field documentation system for sales, service, and installation">
  <title>Field Buddy - Hybrid Job System</title>
  <style>
    /*
      ==================== BASE STYLES ====================

      Throughout this stylesheet you'll notice grouped selectors with
      descriptive comments.  When editing or adding new rules try to
      preserve the order and grouping so that similar styles remain
      together.  In particular, note that `.service-only`, `.install-only`,
      `.ductwork-only`, `.cooling-only`, and `.heating-only` are used in
      conjunction with body classes set in the JS code – altering them
      affects visibility logic.
    */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-padding-top: 20px;
    }

    body {
      font: 16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f5f5;
      padding: 8px;
      padding-bottom: 90px;
      color: #1a1a1a;
    }

    /* ==================== INPUTS ==================== */
    input,
    select,
    textarea,
    button {
      font-size: 16px;
      padding: 14px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 100%;
      margin: 8px 0;
      font-family: inherit;
      -webkit-appearance: none;
      background: white;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: 1.5;
    }

    input[readonly] {
      background: #f8f8f8;
      color: #666;
      cursor: not-allowed;
    }

    input[type="checkbox"] {
      width: 24px;
      height: 24px;
      margin-right: 12px;
      cursor: pointer;
      accent-color: #007aff;
      flex-shrink: 0;
    }

    label {
      display: block;
      font-size: 13px;
      color: #666;
      margin-bottom: 4px;
      font-weight: 500;
    }

    label.check {
      display: flex;
      align-items: center;
      font-size: 15px;
      color: #1a1a1a;
      margin: 10px 0;
      padding: 12px;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
    }

    label.check:hover {
      background: #f8f8f8;
      border-color: #007aff;
    }

    label.check input:checked {
      accent-color: #34c759;
    }

    label.check.checked {
      background: #e6f7ec;
      border-color: #34c759;
    }

    /* ==================== BUTTONS ==================== */
    button {
      background: #007aff;
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.2s;
    }

    button:active {
      opacity: 0.7;
      transform: scale(0.98);
    }

    button.secondary {
      background: #8e8e93;
    }

    button.success {
      background: #34c759;
    }

    button.danger {
      background: #ff3b30;
    }

    button.warning {
      background: #ff9500;
    }

    button.small {
      padding: 10px 14px;
      font-size: 14px;
      min-height: 40px;
    }

    /* ==================== CARDS ==================== */
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .card-header {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-subheader {
      font-size: 15px;
      font-weight: 600;
      color: #007aff;
      margin: 16px 0 8px 0;
      padding-top: 12px;
      border-top: 1px solid #e0e0e0;
    }

    /* ==================== GRID LAYOUTS ==================== */
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }

    .grid-4 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    @media (max-width: 640px) {
      .grid-2,
      .grid-3,
      .grid-4 {
        grid-template-columns: 1fr;
      }
    }

    /* ==================== MODE TOGGLE ==================== */
    .mode-toggle {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin: 12px 0;
    }

    .mode-toggle button {
      background: white;
      color: #666;
      border: 2px solid #ddd;
      font-size: 15px;
      padding: 12px;
      min-height: 44px;
    }

    .mode-toggle button.active {
      background: #007aff;
      color: white;
      border-color: #007aff;
    }

    /* ==================== STATUS INDICATORS ==================== */
    .status {
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.4;
    }

    .status.good {
      background: #d1f4e0;
      color: #0f5132;
      border-left: 4px solid #34c759;
    }

    .status.warn {
      background: #fff3cd;
      color: #664d03;
      border-left: 4px solid #ff9500;
    }

    .status.bad {
      background: #f8d7da;
      color: #842029;
      border-left: 4px solid #ff3b30;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid #007aff;
    }

    /* ==================== VOICE INPUT ==================== */
    .voice-wrapper {
      position: relative;
    }

    .voice-btn {
      position: absolute;
      right: 4px;
      top: 12px;
      transform: translateY(0);
      width: 40px;
      height: 40px;
      padding: 0;
      background: #007aff;
      border-radius: 50%;
      font-size: 20px;
      z-index: 2;
      min-height: unset;
      margin: 0;
    }

    textarea + .voice-btn {
      top: 12px;
    }

    .voice-btn.listening {
      background: #ff3b30;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    .voice-wrapper input,
    .voice-wrapper textarea {
      padding-right: 50px;
    }

    /* ==================== DYNAMIC FIELDS ==================== */
    .dynamic-item {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      border: 1px solid #e0e0e0;
      position: relative;
    }

    .dynamic-item .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #ff3b30;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: unset;
      padding: 0;
      margin: 0;
    }

    .add-btn {
      background: #34c759;
      margin-top: 8px;
    }

    /* ==================== COLLAPSIBLE SECTIONS ==================== */
    .section {
      margin: 16px 0;
    }

    .section-toggle {
      background: white;
      border: 2px solid #ddd;
      color: #1a1a1a;
      font-weight: 600;
      padding: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      border-radius: 8px;
      margin: 8px 0;
      transition: all 0.2s;
    }

    .section-toggle:hover {
      background: #f8f8f8;
      border-color: #007aff;
    }

    .section-toggle .arrow {
      font-size: 18px;
      transition: transform 0.2s;
      transform-origin: center;
    }

    .section.open .arrow {
      transform: rotate(180deg);
    }

    .section-content {
      display: none;
      background: white;
      padding: 16px;
      border-radius: 0 0 8px 8px;
      border: 2px solid #ddd;
      border-top: none;
      margin-top: -8px;
    }

    .section.open .section-content {
      display: block;
    }

    /* ==================== MODE-SPECIFIC VISIBILITY ==================== */
    /* Note: the classes `.service-only`, `.install-only` and `.ductwork-only`
       control which parts of the form are visible depending on the selected
       mode.  An element with multiple of these classes will be shown if any
       of its classes match the current body class (e.g., mode-service).
       The default rule hides these elements, then mode-specific rules show
       them by lowering the selector specificity. */
    .service-only,
    .install-only,
    .ductwork-only,
    .cooling-only,
    .heating-only {
      display: none;
    }

    body.mode-service .service-only,
    body.mode-service .service-only.ductwork-only,
    body.mode-service .service-only.install-only {
      display: block;
    }

    body.mode-install .install-only,
    body.mode-install .install-only.ductwork-only,
    body.mode-install .install-only.service-only {
      display: block;
    }

    body.mode-ductwork .ductwork-only,
    body.mode-ductwork .ductwork-only.service-only,
    body.mode-ductwork .ductwork-only.install-only {
      display: block;
    }

    /* Special rules for heat/cool modes */
    body.mode-service.mode-cooling .cooling-only,
    body.mode-install.mode-cooling .cooling-only {
      display: block;
    }

    body.mode-service.mode-heating .heating-only,
    body.mode-install.mode-heating .heating-only {
      display: block;
    }

    /* ==================== PHOTOS ==================== */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
      margin-top: 12px;
    }

    .photo-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      background: #f0f0f0;
    }

    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .photo-label {
      position: absolute;
      bottom: 4px;
      left: 4px;
      right: 4px;
      background: rgba(0, 0, 0, 0.75);
      color: white;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      text-align: center;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .photo-delete {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #ff3b30;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.9;
      min-height: unset;
      padding: 0;
      margin: 0;
    }

    /* ==================== REPORT PREVIEW ==================== */
    .report-preview {
      background: #f8f8f8;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-x: auto;
      margin: 12px 0;
      border: 1px solid #ddd;
    }

    /* ==================== STICKY ACTION BAR ==================== */
    .actions {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 10px;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 8px;
      z-index: 100;
    }

    .actions button {
      flex: 1;
      font-size: 14px;
      padding: 12px 8px;
    }

    /* ==================== MODAL & TOAST ==================== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: scale(0.95);
      transition: transform 0.2s;
    }

    .modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }

    .modal-overlay.visible .modal-content {
      transform: scale(1);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .modal-body {
      font-size: 15px;
      color: #333;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .modal-actions {
      display: flex;
      gap: 8px;
    }

    .modal-actions button {
      flex: 1;
    }

    .toast-notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s, top 0.3s;
    }

    .toast-notification.visible {
      opacity: 1;
      visibility: visible;
      top: 30px;
    }

    .toast-notification.success {
      background: #34c759;
    }

    .toast-notification.danger {
      background: #ff3b30;
    }

    /* ==================== HIDDEN / UTILITY ==================== */
    .hidden {
      display: none !important;
    }
    .mt-8 {
      margin-top: 8px;
    }
    .mt-16 {
      margin-top: 16px;
    }
    .mb-8 {
      margin-bottom: 8px;
    }
    .text-muted {
      color: #666;
      font-size: 13px;
    }
  </style>
</head>
<body class="mode-service mode-cooling">
  <!-- Header -->
  <div class="card">
    <div class="card-header">
      <div>
        <div style="font-size: 20px;">⚡ Field Buddy</div>
        <div style="font-size: 12px; color: #666; font-weight: 400; margin-top: 4px;">Hybrid Job System</div>
      </div>
    </div>
    <div class="mode-toggle">
      <button onclick="setMode('service')" id="btn-service" class="active">🔧 Service</button>
      <button onclick="setMode('install')" id="btn-install">📦 Install</button>
      <button onclick="setMode('ductwork')" id="btn-ductwork">🌬️ Ductwork</button>
    </div>
  </div>

  <!-- Job Info -->
  <div class="card">
    <div class="card-header">
      <span>📋 Job Information</span>
    </div>
    <label for="customer">Customer Name</label>
    <input type="text" id="customer" placeholder="Full name" />

    <label for="address">Address</label>
    <input type="text" id="address" placeholder="Street, City, State" />

    <div class="grid-2">
      <div>
        <label for="sales-tech">Sold By (Sales Tech)</label>
        <input type="text" id="sales-tech" placeholder="Sales tech name" />
      </div>
      <div>
        <label for="sale-date">Sale Date</label>
        <input type="date" id="sale-date" />
      </div>
    </div>

    <div class="grid-2 install-only">
      <div>
        <label for="install-date">Scheduled Install Date</label>
        <input type="date" id="install-date" />
      </div>
      <div>
        <label for="labor-hours">Estimated Labor Hours</label>
        <input type="number" id="labor-hours" step="0.5" placeholder="e.g., 6.5" />
      </div>
    </div>

    <div class="service-only ductwork-only">
      <label>Job Type</label>
      <select id="job-type">
        <option value="">Select job type...</option>
        <option value="maintenance">Maintenance</option>
        <option value="repair">Repair</option>
        <option value="diagnostic">Diagnostic</option>
        <option value="ductwork">Ductwork Install/Repair</option>
      </select>
    </div>

    <div class="service-only">
      <label>Customer Complaint</label>
      <div class="voice-wrapper">
        <textarea id="complaint" placeholder="What's the issue? (in customer's words)" rows="3"></textarea>
        <button class="voice-btn" data-voice="complaint">🎤</button>
      </div>
    </div>
  </div>

  <!-- On-Site Time Tracking -->
  <div class="card service-only ductwork-only">
    <div class="card-header">
      <span>⏱️ Time Tracking</span>
    </div>

    <div class="grid-2">
      <div>
        <label>Arrival Time</label>
        <input type="time" id="arrival-time" />
      </div>
      <div>
        <label>Completion Time</label>
        <input type="time" id="completion-time" onchange="calculateLaborHours()" />
      </div>
    </div>

    <div class="grid-2">
      <div>
        <label>Travel Time (minutes)</label>
        <input type="number" id="travel-time" min="0" step="5" />
      </div>
      <div>
        <label>Total Labor Hours (auto)</label>
        <input type="text" id="total-hours" readonly />
      </div>
    </div>
  </div>

  <!-- Equipment Section -->
  <div class="card">
    <div class="card-header">
      <span>⚙️ Equipment</span>
    </div>

    <!-- Heat/Cool Toggle for Service/Install -->
    <div class="mode-toggle service-only install-only" style="grid-template-columns: 1fr 1fr; margin-bottom: 12px;">
      <button onclick="setHeatCoolMode('cooling')" id="btn-hc-cooling" class="active secondary">❄️ Cooling</button>
      <button onclick="setHeatCoolMode('heating')" id="btn-hc-heating" class="secondary">🔥 Heating</button>
    </div>

    <!-- SERVICE/DUCTWORK: Document Existing Equipment -->
    <div class="service-only ductwork-only">
      <label>Unit Type</label>
      <select id="unit-type" onchange="toggleUnitData()">
          <option value="">Select unit type...</option>
          <option value="split">Split System</option>
          <option value="package">Package Unit</option>
          <option value="minisplit">Mini-Split</option>
          <option value="heatpump">Heat Pump</option>
      </select>
      <label for="brand">Brand</label>
      <select id="brand">
        <option value="">Select brand...</option>
        <option value="Carrier">Carrier</option>
        <option value="Trane">Trane</option>
        <option value="Lennox">Lennox</option>
        <option value="Rheem">Rheem</option>
        <option value="Goodman">Goodman</option>
        <option value="York">York</option>
        <option value="American Standard">American Standard</option>
        <option value="Bryant">Bryant</option>
        <option value="Daikin">Daikin</option>
        <option value="Mitsubishi">Mitsubishi</option>
        <option value="Other">Other</option>
      </select>

      <div id="indoor-unit-fields" class="mt-8">
          <label>Indoor Unit Data (Nameplate)</label>
          <div class="voice-wrapper mb-8">
              <input type="text" id="indoor-data" placeholder="Model/Serial/Tonnage">
              <button class="voice-btn" data-voice="indoor-data">🎤</button>
          </div>
      </div>

      <div id="outdoor-unit-fields">
          <label>Outdoor Unit Data (Nameplate)</label>
          <div class="voice-wrapper mb-8">
              <input type="text" id="outdoor-data" placeholder="Model/Serial/SEER-BTU">
              <button class="voice-btn" data-voice="outdoor-data">🎤</button>
          </div>
      </div>
      
      <div class="grid-2">
        <div>
          <label for="tonnage">System Tonnage</label>
          <select id="tonnage">
            <option value="">Select...</option>
            <option value="1.5">1.5 Ton</option>
            <option value="2">2 Ton</option>
            <option value="2.5">2.5 Ton</option>
            <option value="3">3 Ton</option>
            <option value="3.5">3.5 Ton</option>
            <option value="4">4 Ton</option>
            <option value="5">5 Ton</option>
          </select>
        </div>
        <div>
          <label for="refrigerant">Refrigerant Type</label>
          <select id="refrigerant" onchange="clearRefrigerantCalculations()">
            <option value="">Select...</option>
            <option value="R-410A">R-410A</option>
            <option value="R-22">R-22 (Legacy)</option>
            <option value="R-32">R-32</option>
            <option value="R-454B">R-454B (A2L)</option>
          </select>
        </div>
      </div>

      <label for="mfg-date">Manufacture Date</label>
      <input type="date" id="mfg-date" onchange="calculateAge()">
      <div id="equipment-age" class="text-muted text-small"></div>
    </div>
    <!-- (The rest of the code continues with all the installation, ductwork, service and final sections, plus the full JavaScript code that drives the interface) -->
  </div>
</body>
</html>
