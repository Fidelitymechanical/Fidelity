<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content="Field Buddy Pro - Professional HVAC Field Service Management">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>Field Buddy Pro - Service Management</title>
  
  <style>
    /* ==================== SERVICETITAN-STYLE DESIGN SYSTEM ==================== */
    :root {
      /* ServiceTitan-inspired color palette */
      --primary-blue: #0066CC;
      --primary-dark: #004C99;
      --primary-light: #3385DB;
      
      --sidebar-bg: #1E293B;
      --sidebar-hover: #334155;
      --sidebar-active: #0066CC;
      
      --success: #10B981;
      --warning: #F59E0B;
      --danger: #EF4444;
      --info: #3B82F6;
      
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-300: #D1D5DB;
      --gray-400: #9CA3AF;
      --gray-500: #6B7280;
      --gray-600: #4B5563;
      --gray-700: #374151;
      --gray-800: #1F2937;
      --gray-900: #111827;
      
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      
      --radius-sm: 4px;
      --radius: 6px;
      --radius-lg: 8px;
      
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 12px;
      --spacing-lg: 16px;
      --spacing-xl: 24px;
      --spacing-2xl: 32px;
      
      --transition: all 0.2s ease;
    }
    
    /* ==================== RESET & BASE ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--gray-50);
      color: var(--gray-900);
      font-size: 14px;
      line-height: 1.5;
      overflow-x: hidden;
    }
    
    /* ==================== LAYOUT STRUCTURE ==================== */
    .app-container {
      display: flex;
      min-height: 100vh;
    }
    
    /* ==================== SIDEBAR NAVIGATION ==================== */
    .sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      color: white;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      z-index: 100;
      transition: var(--transition);
    }
    
    .sidebar-header {
      padding: var(--spacing-xl);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      font-size: 18px;
      font-weight: 700;
      color: white;
    }
    
    .sidebar-logo-icon {
      width: 36px;
      height: 36px;
      background: var(--primary-blue);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .sidebar-version {
      font-size: 10px;
      color: var(--gray-400);
      margin-top: 4px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .sidebar-nav {
      padding: var(--spacing-lg) 0;
    }
    
    .nav-section {
      margin-bottom: var(--spacing-lg);
    }
    
    .nav-section-title {
      padding: var(--spacing-sm) var(--spacing-xl);
      font-size: 11px;
      font-weight: 600;
      color: var(--gray-400);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-xl);
      color: var(--gray-300);
      cursor: pointer;
      transition: var(--transition);
      border-left: 3px solid transparent;
      font-size: 14px;
      font-weight: 500;
    }
    
    .nav-item:hover {
      background: var(--sidebar-hover);
      color: white;
    }
    
    .nav-item.active {
      background: rgba(0, 102, 204, 0.1);
      color: white;
      border-left-color: var(--primary-blue);
    }
    
    .nav-icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }
    
    /* ==================== MAIN CONTENT AREA ==================== */
    .main-content {
      margin-left: 260px;
      flex: 1;
      min-height: 100vh;
    }
    
    /* ==================== TOP HEADER BAR ==================== */
    .top-header {
      background: white;
      border-bottom: 1px solid var(--gray-200);
      padding: 0 var(--spacing-2xl);
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: var(--shadow-sm);
    }
    
    .header-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--gray-900);
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: var(--spacing-lg);
    }
    
    .header-user {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      background: var(--gray-100);
      border-radius: var(--radius-lg);
      font-size: 13px;
      font-weight: 500;
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      background: var(--primary-blue);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
    }
    
    /* ==================== CONTENT WORKSPACE ==================== */
    .workspace {
      padding: var(--spacing-2xl);
    }
    
    .page-header {
      margin-bottom: var(--spacing-xl);
    }
    
    .page-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: var(--spacing-sm);
    }
    
    .page-subtitle {
      color: var(--gray-600);
      font-size: 14px;
    }
    
    /* ==================== CARDS ==================== */
    .card {
      background: white;
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-200);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-sm);
    }
    
    .card-header {
      padding: var(--spacing-lg) var(--spacing-xl);
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--gray-900);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .card-body {
      padding: var(--spacing-xl);
    }
    
    .card-section {
      margin-bottom: var(--spacing-xl);
    }
    
    .card-section:last-child {
      margin-bottom: 0;
    }
    
    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: var(--spacing-md);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    
    /* ==================== FORM ELEMENTS ==================== */
    .form-grid {
      display: grid;
      gap: var(--spacing-lg);
    }
    
    .form-grid-2 { grid-template-columns: repeat(2, 1fr); }
    .form-grid-3 { grid-template-columns: repeat(3, 1fr); }
    .form-grid-4 { grid-template-columns: repeat(4, 1fr); }
    
    .form-group {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--gray-700);
      margin-bottom: var(--spacing-sm);
    }
    
    input, select, textarea {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius);
      font-size: 14px;
      font-family: inherit;
      background: white;
      transition: var(--transition);
      color: var(--gray-900);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
    }
    
    input[readonly] {
      background: var(--gray-100);
      color: var(--gray-600);
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: 1.5;
    }
    
    /* ==================== BUTTONS ==================== */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      min-height: 36px;
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn-primary {
      background: var(--primary-blue);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-success:hover {
      background: #059669;
    }
    
    .btn-secondary {
      background: var(--gray-200);
      color: var(--gray-700);
    }
    
    .btn-secondary:hover {
      background: var(--gray-300);
    }
    
    .btn-group {
      display: flex;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }
    
    .btn-full {
      width: 100%;
    }
    
    /* ==================== TOGGLE BUTTONS ==================== */
    .toggle-group {
      display: inline-flex;
      background: var(--gray-100);
      border-radius: var(--radius);
      padding: 2px;
      gap: 2px;
    }
    
    .toggle-btn {
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      background: transparent;
      border-radius: calc(var(--radius) - 2px);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      color: var(--gray-600);
      min-width: 100px;
    }
    
    .toggle-btn.active {
      background: white;
      color: var(--gray-900);
      box-shadow: var(--shadow-sm);
    }
    
    /* ==================== BADGES & STATUS ==================== */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    
    .badge-success {
      background: #D1FAE5;
      color: #065F46;
    }
    
    .badge-warning {
      background: #FEF3C7;
      color: #92400E;
    }
    
    .badge-danger {
      background: #FEE2E2;
      color: #991B1B;
    }
    
    .badge-info {
      background: #DBEAFE;
      color: #1E40AF;
    }
    
    .status-card {
      padding: var(--spacing-md);
      border-radius: var(--radius);
      border-left: 4px solid;
      font-size: 13px;
      line-height: 1.6;
    }
    
    .status-card.success {
      background: #F0FDF4;
      border-color: var(--success);
      color: #166534;
    }
    
    .status-card.warning {
      background: #FFFBEB;
      border-color: var(--warning);
      color: #92400E;
    }
    
    .status-card.danger {
      background: #FEF2F2;
      border-color: var(--danger);
      color: #991B1B;
    }
    
    .status-card.info {
      background: #EFF6FF;
      border-color: var(--info);
      color: #1E40AF;
    }
    
    /* ==================== DIAGNOSTIC PANEL ==================== */
    .diagnostic-panel {
      background: linear-gradient(135deg, #0066CC 0%, #004C99 100%);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin: var(--spacing-xl) 0;
      color: white;
    }
    
    .diagnostic-header {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .diagnostic-card {
      background: white;
      border-radius: var(--radius);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      color: var(--gray-900);
    }
    
    .diagnostic-card:last-child {
      margin-bottom: 0;
    }
    
    .diagnostic-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-sm);
    }
    
    .diagnostic-card-title {
      font-weight: 600;
      font-size: 14px;
    }
    
    .diagnostic-recommendations {
      margin-top: var(--spacing-md);
      padding-top: var(--spacing-md);
      border-top: 1px solid var(--gray-200);
    }
    
    .diagnostic-recommendations ul {
      margin: var(--spacing-sm) 0;
      padding-left: var(--spacing-xl);
      font-size: 13px;
    }
    
    .diagnostic-recommendations li {
      margin: var(--spacing-xs) 0;
      color: var(--gray-700);
    }
    
    /* ==================== CHECKLIST ==================== */
    .checklist-item {
      display: flex;
      align-items: flex-start;
      padding: var(--spacing-md);
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius);
      margin-bottom: var(--spacing-sm);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .checklist-item:hover {
      border-color: var(--primary-blue);
      background: white;
    }
    
    .checklist-item.checked {
      border-color: var(--success);
      background: #F0FDF4;
    }
    
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: var(--spacing-md);
      accent-color: var(--success);
      cursor: pointer;
      flex-shrink: 0;
      margin-top: 2px;
    }
    
    .checklist-item label {
      margin: 0;
      cursor: pointer;
      font-weight: 400;
      font-size: 13px;
      line-height: 1.6;
    }
    
    /* ==================== MATERIALS TABLE ==================== */
    .materials-category {
      margin-bottom: var(--spacing-xl);
    }
    
    .category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--gray-100);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius);
      cursor: pointer;
      user-select: none;
      transition: var(--transition);
    }
    
    .category-header:hover {
      background: var(--gray-200);
    }
    
    .category-title-group {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }
    
    .category-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--gray-900);
    }
    
    .category-count {
      font-size: 12px;
      color: var(--gray-600);
      background: white;
      padding: 2px 8px;
      border-radius: 10px;
    }
    
    .category-arrow {
      transition: transform 0.3s ease;
      color: var(--gray-600);
    }
    
    .materials-category.expanded .category-arrow {
      transform: rotate(180deg);
    }
    
    .category-items {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .materials-category.expanded .category-items {
      max-height: 5000px;
    }
    
    .material-item {
      display: flex;
      align-items: center;
      padding: var(--spacing-md) var(--spacing-lg);
      border: 1px solid var(--gray-200);
      border-top: none;
      background: white;
    }
    
    .material-item:last-child {
      border-bottom-left-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
    }
    
    .material-info {
      flex: 1;
    }
    
    .material-name {
      font-weight: 500;
      font-size: 13px;
      color: var(--gray-900);
    }
    
    .material-spec {
      font-size: 12px;
      color: var(--gray-600);
      margin-top: 2px;
    }
    
    /* ==================== SELECTED MATERIALS ==================== */
    .selected-material {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius);
      margin-bottom: var(--spacing-sm);
    }
    
    .selected-material-info {
      flex: 1;
    }
    
    .selected-material-controls {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .selected-material-controls select,
    .selected-material-controls input {
      padding: 6px 10px;
      font-size: 13px;
    }
    
    .selected-material-controls select {
      width: 140px;
    }
    
    .selected-material-controls input {
      width: 60px;
      text-align: center;
    }
    
    /* ==================== REPORT PREVIEW ==================== */
    .report-container {
      background: var(--gray-50);
      border: 1px solid var(--gray-200);
      border-radius: var(--radius);
      padding: var(--spacing-lg);
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
    }
    
    /* ==================== UTILITIES ==================== */
    .hidden {
      display: none !important;
    }
    
    .mt-lg { margin-top: var(--spacing-lg); }
    .mb-lg { margin-bottom: var(--spacing-lg); }
    
    /* ==================== TOAST NOTIFICATIONS ==================== */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--gray-900);
      color: white;
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      z-index: 9999;
      font-size: 13px;
      font-weight: 500;
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition);
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .toast.success { background: var(--success); }
    .toast.danger { background: var(--danger); }
    .toast.warning { background: var(--warning); }
    
    /* ==================== MODAL ==================== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: var(--spacing-xl);
    }
    
    .modal-overlay.show {
      display: flex;
    }
    
    .modal {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow-lg);
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      color: var(--gray-900);
    }
    
    .modal-content {
      color: var(--gray-700);
      margin-bottom: var(--spacing-xl);
      line-height: 1.6;
      font-size: 14px;
    }
    
    .modal-actions {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: flex-end;
    }
    
    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.mobile-open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .form-grid-2,
      .form-grid-3,
      .form-grid-4 {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .workspace {
        padding: var(--spacing-lg);
      }
      
      .top-header {
        padding: 0 var(--spacing-lg);
      }
    }
  </style>
</head>

<body>
  <div class="app-container">
    
    <!-- SIDEBAR NAVIGATION -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">🔧</div>
          <div>
            <div>Field Buddy Pro</div>
            <div class="sidebar-version">v2.0 Enterprise</div>
          </div>
        </div>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
          <div class="nav-item active" onclick="showPage('service')">
            <span class="nav-icon">📋</span>
            <span>Service Calls</span>
          </div>
          <div class="nav-item" onclick="showPage('materials')">
            <span class="nav-icon">📦</span>
            <span>Materials</span>
          </div>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
          <div class="nav-item">
            <span class="nav-icon">📊</span>
            <span>Reports</span>
          </div>
          <div class="nav-item">
            <span class="nav-icon">⚙️</span>
            <span>Settings</span>
          </div>
        </div>
      </nav>
    </aside>
    
    <!-- MAIN CONTENT -->
    <main class="main-content">
      
      <!-- TOP HEADER -->
      <header class="top-header">
        <div class="header-title" id="page-title">Service Call</div>
        <div class="header-actions">
          <div class="header-user">
            <div class="user-avatar">TC</div>
            <span>Technician</span>
          </div>
        </div>
      </header>
      
      <!-- WORKSPACE -->
      <div class="workspace">
        
        <!-- SERVICE CALL PAGE -->
        <div id="service-page" class="page-content">
          
          <!-- System Mode Selector -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">System Mode</div>
              <div class="toggle-group">
                <button class="toggle-btn active" id="mode-cooling" onclick="setSystemMode('cooling')">
                  ❄️ Cooling
                </button>
                <button class="toggle-btn" id="mode-heating" onclick="setSystemMode('heating')">
                  🔥 Heating
                </button>
              </div>
            </div>
          </div>
          
          <!-- Job Information -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Job Information</div>
            </div>
            <div class="card-body">
              <div class="card-section">
                <label>Call Type</label>
                <div class="toggle-group">
                  <button class="toggle-btn active" id="call-trouble" onclick="setCallType('trouble')">
                    Trouble Call
                  </button>
                  <button class="toggle-btn" id="call-maintenance" onclick="setCallType('maintenance')">
                    Maintenance
                  </button>
                </div>
              </div>
              
              <div class="form-grid form-grid-2">
                <div class="form-group">
                  <label>Customer Name</label>
                  <input type="text" id="customer-name" placeholder="Enter customer name">
                </div>
                <div class="form-group">
                  <label>Date</label>
                  <input type="date" id="service-date">
                </div>
              </div>
              
              <div class="form-grid">
                <div class="form-group">
                  <label>Service Address</label>
                  <input type="text" id="service-address" placeholder="123 Main St, City, State ZIP">
                </div>
              </div>
              
              <div class="form-grid">
                <div class="form-group">
                  <label>Customer Complaint / Reason for Service</label>
                  <textarea id="customer-complaint" placeholder="Describe the issue or maintenance reason..."></textarea>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Equipment Information -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Equipment Information</div>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="form-group">
                  <label>Unit Type</label>
                  <select id="unit-type" onchange="updateUnitFields()">
                    <option value="">Select unit type...</option>
                    <option value="split">Split System</option>
                    <option value="package">Package Unit</option>
                    <option value="mini-split">Mini-Split</option>
                    <option value="heat-pump">Heat Pump</option>
                  </select>
                </div>
              </div>
              
              <div class="form-grid form-grid-2">
                <div class="form-group">
                  <label>Indoor Unit (Model/Serial)</label>
                  <input type="text" id="indoor-unit" placeholder="Model & Serial Number">
                </div>
                <div class="form-group" id="outdoor-unit-group">
                  <label>Outdoor Unit (Model/Serial)</label>
                  <input type="text" id="outdoor-unit" placeholder="Model & Serial Number">
                </div>
              </div>
              
              <div class="form-grid form-grid-3">
                <div class="form-group">
                  <label>Tonnage</label>
                  <select id="tonnage">
                    <option value="">Select...</option>
                    <option value="1.5">1.5 Ton</option>
                    <option value="2">2 Ton</option>
                    <option value="2.5">2.5 Ton</option>
                    <option value="3">3 Ton</option>
                    <option value="3.5">3.5 Ton</option>
                    <option value="4">4 Ton</option>
                    <option value="5">5 Ton</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Refrigerant Type</label>
                  <select id="refrigerant-type">
                    <option value="R410A">R-410A</option>
                    <option value="R22">R-22</option>
                    <option value="R454B">R-454B</option>
                    <option value="R32">R-32</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Filter Size</label>
                  <input type="text" id="filter-size" placeholder="e.g., 16x25x1">
                </div>
              </div>
            </div>
          </div>
          
          <!-- Cooling Measurements -->
          <div class="card" id="cooling-measurements">
            <div class="card-header">
              <div class="card-title">Diagnostic Measurements</div>
            </div>
            <div class="card-body">
              <div class="card-section">
                <div class="section-title">Temperature Readings</div>
                <div class="form-grid form-grid-3">
                  <div class="form-group">
                    <label>Ambient Temp (°F)</label>
                    <input type="number" step="0.1" id="ambient-temp" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Return Temp (°F)</label>
                    <input type="number" step="0.1" id="return-temp" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Supply Temp (°F)</label>
                    <input type="number" step="0.1" id="supply-temp" oninput="calculateDiagnostics()">
                  </div>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label>Delta-T</label>
                    <input type="text" id="delta-t" readonly>
                  </div>
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Refrigerant Pressures & Temps</div>
                <div class="form-grid form-grid-2">
                  <div class="form-group">
                    <label>Suction Pressure (PSI)</label>
                    <input type="number" step="0.1" id="suction-pressure" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Suction Line Temp (°F)</label>
                    <input type="number" step="0.1" id="suction-temp" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Liquid Pressure (PSI)</label>
                    <input type="number" step="0.1" id="liquid-pressure" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Liquid Line Temp (°F)</label>
                    <input type="number" step="0.1" id="liquid-temp" oninput="calculateDiagnostics()">
                  </div>
                </div>
                <div class="form-grid form-grid-2">
                  <div class="form-group">
                    <label>Superheat (°F)</label>
                    <input type="text" id="superheat" readonly>
                  </div>
                  <div class="form-group">
                    <label>Subcool (°F)</label>
                    <input type="text" id="subcool" readonly>
                  </div>
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Airflow & Electrical</div>
                <div class="form-grid form-grid-3">
                  <div class="form-group">
                    <label>Static Pressure (in w.c.)</label>
                    <input type="number" step="0.01" id="static-pressure" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Voltage (V)</label>
                    <input type="number" step="0.1" id="voltage">
                  </div>
                  <div class="form-group">
                    <label>Amperage (A)</label>
                    <input type="number" step="0.1" id="amperage">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Heating Measurements -->
          <div class="card hidden" id="heating-measurements">
            <div class="card-header">
              <div class="card-title">Heating Diagnostic Measurements</div>
            </div>
            <div class="card-body">
              <div class="card-section">
                <div class="section-title">Temperature Readings</div>
                <div class="form-grid form-grid-3">
                  <div class="form-group">
                    <label>Return Temp (°F)</label>
                    <input type="number" step="0.1" id="return-temp-heat" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Supply Temp (°F)</label>
                    <input type="number" step="0.1" id="supply-temp-heat" oninput="calculateDiagnostics()">
                  </div>
                  <div class="form-group">
                    <label>Temp Rise (°F)</label>
                    <input type="text" id="temp-rise" readonly>
                  </div>
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Gas Furnace / Heat Measurements</div>
                <div class="form-grid form-grid-3">
                  <div class="form-group">
                    <label>Manifold Pressure (in w.c.)</label>
                    <input type="number" step="0.01" id="manifold-pressure">
                  </div>
                  <div class="form-group">
                    <label>Voltage (V)</label>
                    <input type="number" step="0.1" id="voltage-heat">
                  </div>
                  <div class="form-group">
                    <label>Amperage (A)</label>
                    <input type="number" step="0.1" id="amperage-heat">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Diagnostic Results -->
          <div id="diagnostic-results" class="hidden"></div>
          
          <!-- Cooling Checklist -->
          <div class="card" id="cooling-checklist">
            <div class="card-header">
              <div class="card-title">Cooling Mode Inspection Checklist</div>
            </div>
            <div class="card-body">
              <div class="card-section">
                <div class="section-title">Air Filter & Indoor Unit</div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-filter" onchange="updateCheckbox(this)">
                  <label for="cool-check-filter">Air filter inspected/replaced (check size & MERV rating)</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-evap-coil" onchange="updateCheckbox(this)">
                  <label for="cool-check-evap-coil">Evaporator coil inspected for dirt/debris/restrictions</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-blower" onchange="updateCheckbox(this)">
                  <label for="cool-check-blower">Blower wheel/motor inspected (clean, proper rotation)</label>
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Outdoor Condensing Unit</div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-condenser-coil" onchange="updateCheckbox(this)">
                  <label for="cool-check-condenser-coil">Condenser coil cleaned (check fin condition)</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-fan-motor" onchange="updateCheckbox(this)">
                  <label for="cool-check-fan-motor">Condenser fan motor operation checked</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-capacitor" onchange="updateCheckbox(this)">
                  <label for="cool-check-capacitor">Capacitor(s) tested with meter (µF reading within spec)</label>
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Electrical & Refrigerant</div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-contactor" onchange="updateCheckbox(this)">
                  <label for="cool-check-contactor">Contactor inspected (pitting, burning, proper operation)</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="cool-check-pressures" onchange="updateCheckbox(this)">
                  <label for="cool-check-pressures">Operating pressures verified (superheat/subcool)</label>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Heating Checklist -->
          <div class="card hidden" id="heating-checklist">
            <div class="card-header">
              <div class="card-title">Heating Mode Inspection Checklist</div>
            </div>
            <div class="card-body">
              <div class="card-section">
                <div class="section-title">Air Filter & Airflow</div>
                <div class="checklist-item">
                  <input type="checkbox" id="heat-check-filter" onchange="updateCheckbox(this)">
                  <label for="heat-check-filter">Air filter inspected/replaced (check size & MERV rating)</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="heat-check-blower" onchange="updateCheckbox(this)">
                  <label for="heat-check-blower">Blower assembly cleaned and inspected</label>
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Heat Exchanger & Combustion</div>
                <div class="checklist-item">
                  <input type="checkbox" id="heat-check-exchanger" onchange="updateCheckbox(this)">
                  <label for="heat-check-exchanger">Heat exchanger visually inspected (cracks, rust, deterioration)</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="heat-check-burners" onchange="updateCheckbox(this)">
                  <label for="heat-check-burners">Burners cleaned and inspected (flame pattern checked)</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="heat-check-flame-sensor" onchange="updateCheckbox(this)">
                  <label for="heat-check-flame-sensor">Flame sensor cleaned and tested (microamp reading)</label>
                </div>
              </div>
              
              <div class="card-section">
                <div class="section-title">Safety Controls</div>
                <div class="checklist-item">
                  <input type="checkbox" id="heat-check-limit" onchange="updateCheckbox(this)">
                  <label for="heat-check-limit">High limit switch(es) tested</label>
                </div>
                <div class="checklist-item">
                  <input type="checkbox" id="heat-check-co" onchange="updateCheckbox(this)">
                  <label for="heat-check-co">Carbon monoxide levels tested (ambient & flue)</label>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Findings & Work Performed -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Findings & Work Performed</div>
            </div>
            <div class="card-body">
              <div class="card-section">
                <div class="form-group">
                  <label>Findings</label>
                  <textarea id="findings" placeholder="Describe what you found during the service call..."></textarea>
                </div>
              </div>
              
              <div class="card-section">
                <div class="form-group">
                  <label>Recommendations</label>
                  <textarea id="recommendations" placeholder="What do you recommend to the customer?"></textarea>
                </div>
              </div>
              
              <div class="card-section">
                <div class="form-group">
                  <label>Work Performed</label>
                  <textarea id="work-performed" placeholder="Detail the work you completed..."></textarea>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Technician Info -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Technician Information</div>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label>Technician Name</label>
                <input type="text" id="tech-name" placeholder="Your name">
              </div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="btn-group">
            <button class="btn btn-success" onclick="generateServiceReport()">
              ✓ Generate Report
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
              🗑️ Clear Form
            </button>
          </div>
          
          <!-- Report Preview -->
          <div id="report-container"></div>
          
        </div>
        
        <!-- MATERIALS PAGE -->
        <div id="materials-page" class="page-content hidden">
          
          <!-- Job Info -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Job Information</div>
            </div>
            <div class="card-body">
              <div class="form-grid form-grid-2">
                <div class="form-group">
                  <label>Customer/Job Name</label>
                  <input type="text" id="mat-customer" placeholder="Enter customer or job name">
                </div>
                <div class="form-group">
                  <label>Date</label>
                  <input type="date" id="mat-date">
                </div>
              </div>
              
              <div class="form-grid">
                <div class="form-group">
                  <label>Job Address</label>
                  <input type="text" id="mat-address" placeholder="123 Main St, City, State ZIP">
                </div>
              </div>
              
              <div class="form-grid">
                <div class="form-group">
                  <label>Job Notes</label>
                  <textarea id="mat-notes" placeholder="Special instructions, access codes, etc."></textarea>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Materials Catalog -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Materials Catalog</div>
              <div class="btn-group">
                <button class="btn btn-secondary" onclick="expandAllCategories()">
                  Expand All
                </button>
                <button class="btn btn-secondary" onclick="collapseAllCategories()">
                  Collapse All
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="form-group">
                <input type="text" id="material-search" placeholder="Search materials..." oninput="filterMaterials()">
              </div>
              <div id="materials-catalog"></div>
            </div>
          </div>
          
          <!-- Selected Materials -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Selected Materials</div>
            </div>
            <div class="card-body">
              <div id="selected-materials">
                <div class="status-card info">
                  ℹ️ No materials selected yet. Use the catalog above to add items.
                </div>
              </div>
            </div>
          </div>
          
          <!-- Technician Info -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Technician Information</div>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label>Technician Name</label>
                <input type="text" id="mat-tech-name" placeholder="Your name">
              </div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="btn-group">
            <button class="btn btn-success" onclick="generateMaterialsList()">
              ✓ Generate Materials List
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
              🗑️ Clear Form
            </button>
          </div>
          
          <!-- Report Preview -->
          <div id="report-container-mat"></div>
          
        </div>
        
      </div>
      
    </main>
    
  </div>
  
  <!-- TOAST NOTIFICATION -->
  <div class="toast" id="toast"></div>
  
  <!-- MODAL -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal">
      <div class="modal-title" id="modal-title">Confirm Action</div>
      <div class="modal-content" id="modal-content">Are you sure?</div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal(false)">Cancel</button>
        <button class="btn btn-primary" onclick="closeModal(true)">Confirm</button>
      </div>
    </div>
  </div>
  
  <script>
    // ==================== STATE MANAGEMENT ====================
    let currentPage = 'service';
    let callType = 'trouble';
    let systemMode = 'cooling';
    let selectedMaterials = [];
    let diagnosticResults = [];
    let categoryStates = {};
    
    // ==================== R410A PT CHART ====================
    const R410A_PT = {
      85: 40.4, 90: 44.7, 95: 47.1, 100: 49.6, 105: 52.2, 110: 54.9,
      115: 57.7, 120: 60.6, 125: 63.6, 130: 66.7, 135: 69.9, 140: 73.2,
      145: 76.6, 150: 80.1, 155: 83.7, 160: 87.4, 165: 91.3, 170: 95.2,
      175: 99.3, 180: 103.5, 185: 107.8, 190: 112.2, 195: 116.7, 200: 121.4
    };
    
    // ==================== MATERIALS CATALOG ====================
    const materialsCatalog = {
      equipment: {
        name: 'Equipment',
        icon: '🏠',
        items: [
          { id: 'furnace-gas', name: 'Gas Furnace', sizes: ['40K BTU', '60K BTU', '80K BTU', '100K BTU'] },
          { id: 'ac-unit', name: 'Air Conditioner', sizes: ['2 Ton', '2.5 Ton', '3 Ton', '4 Ton', '5 Ton'] },
          { id: 'heat-pump', name: 'Heat Pump', sizes: ['2 Ton', '3 Ton', '4 Ton', '5 Ton'] },
        ]
      },
      electrical: {
        name: 'Electrical',
        icon: '⚡',
        items: [
          { id: 'contactor', name: 'Contactor', sizes: ['1-Pole 30A', '2-Pole 30A', '2-Pole 40A'] },
          { id: 'capacitor-single', name: 'Run Capacitor', sizes: ['5µF', '10µF', '15µF', '20µF', '25µF', '30µF', '35µF', '40µF', '45µF'] },
          { id: 'capacitor-dual', name: 'Dual Run Capacitor', sizes: ['35/5µF', '40/5µF', '45/5µF', '50/5µF'] },
        ]
      },
      refrigeration: {
        name: 'Refrigeration',
        icon: '❄️',
        items: [
          { id: 'r410a', name: 'R-410A Refrigerant', sizes: ['25 lb', '50 lb'], unit: 'cylinder' },
          { id: 'lineset-small', name: 'Line Set (1.5-2.5 Ton)', sizes: ['15 ft', '25 ft', '35 ft', '50 ft'] },
          { id: 'txv', name: 'TXV Expansion Valve', sizes: ['2 Ton', '3 Ton', '4 Ton', '5 Ton'] },
        ]
      }
    };
    
    // ==================== HELPER FUNCTIONS ====================
    function $(id) {
      return document.getElementById(id);
    }
    
    function showToast(message, type = 'success') {
      const toast = $('toast');
      toast.textContent = message;
      toast.className = `toast show ${type}`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
    
    function showModal(title, content) {
      return new Promise((resolve) => {
        $('modal-title').textContent = title;
        $('modal-content').textContent = content;
        $('modal-overlay').classList.add('show');
        window.modalResolve = resolve;
      });
    }
    
    function closeModal(result) {
      $('modal-overlay').classList.remove('show');
      if (window.modalResolve) {
        window.modalResolve(result);
        window.modalResolve = null;
      }
    }
    
    // ==================== NAVIGATION ====================
    function showPage(page) {
      currentPage = page;
      $('service-page').classList.toggle('hidden', page !== 'service');
      $('materials-page').classList.toggle('hidden', page !== 'materials');
      
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      
      $('page-title').textContent = page === 'service' ? 'Service Call' : 'Materials';
    }
    
    function setCallType(type) {
      callType = type;
      $('call-trouble').classList.toggle('active', type === 'trouble');
      $('call-maintenance').classList.toggle('active', type === 'maintenance');
    }
    
    function setSystemMode(mode) {
      systemMode = mode;
      $('mode-cooling').classList.toggle('active', mode === 'cooling');
      $('mode-heating').classList.toggle('active', mode === 'heating');
      $('cooling-measurements').classList.toggle('hidden', mode !== 'cooling');
      $('heating-measurements').classList.toggle('hidden', mode !== 'heating');
      $('cooling-checklist').classList.toggle('hidden', mode !== 'cooling');
      $('heating-checklist').classList.toggle('hidden', mode !== 'heating');
      calculateDiagnostics();
    }
    
    function updateUnitFields() {
      const unitType = $('unit-type').value;
      const outdoorGroup = $('outdoor-unit-group');
      if (unitType === 'package' || unitType === 'mini-split') {
        outdoorGroup.classList.add('hidden');
      } else {
        outdoorGroup.classList.remove('hidden');
      }
    }
    
    function updateCheckbox(checkbox) {
      const item = checkbox.closest('.checklist-item');
      item.classList.toggle('checked', checkbox.checked);
    }
    
    // ==================== DIAGNOSTICS ====================
    function calculateDiagnostics() {
      if (systemMode === 'cooling') {
        calculateCoolingDiagnostics();
      } else {
        calculateHeatingDiagnostics();
      }
    }
    
    function calculateCoolingDiagnostics() {
      const returnTemp = parseFloat($('return-temp').value);
      const supplyTemp = parseFloat($('supply-temp').value);
      const suctionPressure = parseFloat($('suction-pressure').value);
      const suctionTemp = parseFloat($('suction-temp').value);
      const liquidPressure = parseFloat($('liquid-pressure').value);
      const liquidTemp = parseFloat($('liquid-temp').value);
      
      if (!isNaN(returnTemp) && !isNaN(supplyTemp)) {
        const deltaT = returnTemp - supplyTemp;
        $('delta-t').value = `${deltaT.toFixed(1)}°F`;
      }
      
      if (!isNaN(suctionPressure) && !isNaN(suctionTemp)) {
        const satTemp = getSaturationTemp(suctionPressure);
        if (satTemp) {
          const superheat = suctionTemp - satTemp;
          $('superheat').value = `${superheat.toFixed(1)}°F`;
        }
      }
      
      if (!isNaN(liquidPressure) && !isNaN(liquidTemp)) {
        const satTemp = getSaturationTemp(liquidPressure);
        if (satTemp) {
          const subcool = satTemp - liquidTemp;
          $('subcool').value = `${subcool.toFixed(1)}°F`;
        }
      }
      
      runDiagnosticAnalysis();
    }
    
    function calculateHeatingDiagnostics() {
      const returnTemp = parseFloat($('return-temp-heat').value);
      const supplyTemp = parseFloat($('supply-temp-heat').value);
      
      if (!isNaN(returnTemp) && !isNaN(supplyTemp)) {
        const tempRise = supplyTemp - returnTemp;
        $('temp-rise').value = `${tempRise.toFixed(1)}°F`;
      }
      
      runDiagnosticAnalysis();
    }
    
    function getSaturationTemp(pressure) {
      const pressures = Object.keys(R410A_PT).map(Number);
      const closest = pressures.reduce((prev, curr) => 
        Math.abs(curr - pressure) < Math.abs(prev - pressure) ? curr : prev
      );
      return R410A_PT[closest];
    }
    
    function runDiagnosticAnalysis() {
      diagnosticResults = [];
      
      if (systemMode === 'cooling') {
        const returnTemp = parseFloat($('return-temp').value);
        const supplyTemp = parseFloat($('supply-temp').value);
        const deltaT = returnTemp && supplyTemp ? returnTemp - supplyTemp : null;
        const superheat = parseFloat($('superheat').value.replace('°F', ''));
        const subcool = parseFloat($('subcool').value.replace('°F', ''));
        
        if (deltaT !== null) {
          if (deltaT < 14) {
            diagnosticResults.push({
              severity: 'danger',
              title: 'Low Delta-T Detected',
              message: `Delta-T is ${deltaT.toFixed(1)}°F (Expected: 16-22°F)`,
              recommendations: ['Check filter condition', 'Inspect evaporator coil', 'Verify blower operation']
            });
          } else if (deltaT >= 16 && deltaT <= 22) {
            diagnosticResults.push({
              severity: 'success',
              title: 'Delta-T in Optimal Range',
              message: `Delta-T is ${deltaT.toFixed(1)}°F`,
              recommendations: []
            });
          }
        }
        
        if (!isNaN(superheat) && !isNaN(subcool)) {
          if (superheat > 20 && subcool < 8) {
            diagnosticResults.push({
              severity: 'danger',
              title: 'System Appears Undercharged',
              message: `SH: ${superheat.toFixed(1)}°F, SC: ${subcool.toFixed(1)}°F`,
              recommendations: ['Check for refrigerant leaks', 'Add refrigerant by weight']
            });
          } else if (superheat >= 8 && superheat <= 15 && subcool >= 8 && subcool <= 12) {
            diagnosticResults.push({
              severity: 'success',
              title: 'Refrigerant Charge Within Range',
              message: `SH: ${superheat.toFixed(1)}°F, SC: ${subcool.toFixed(1)}°F`,
              recommendations: []
            });
          }
        }
      }
      
      displayDiagnosticResults();
    }
    
    function displayDiagnosticResults() {
      const container = $('diagnostic-results');
      
      if (diagnosticResults.length === 0) {
        container.classList.add('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      
      let html = '<div class="diagnostic-panel">';
      html += '<div class="diagnostic-header">🎯 Diagnostic Analysis</div>';
      
      diagnosticResults.forEach(result => {
        html += '<div class="diagnostic-card">';
        html += '<div class="diagnostic-card-header">';
        html += `<div class="diagnostic-card-title">${result.title}</div>`;
        html += `<span class="badge badge-${result.severity}">${result.severity}</span>`;
        html += '</div>';
        html += `<p style="margin-bottom: 8px; color: var(--gray-700);">${result.message}</p>`;
        
        if (result.recommendations.length > 0) {
          html += '<div class="diagnostic-recommendations">';
          html += '<strong style="font-size: 12px;">Recommended Actions:</strong>';
          html += '<ul>';
          result.recommendations.forEach(rec => {
            html += `<li>${rec}</li>`;
          });
          html += '</ul>';
          html += '</div>';
        }
        
        html += '</div>';
      });
      
      html += '</div>';
      container.innerHTML = html;
    }
    
    // ==================== MATERIALS ====================
    function initMaterialsCatalog() {
      const catalog = $('materials-catalog');
      let html = '';
      
      Object.keys(materialsCatalog).forEach(catKey => {
        const category = materialsCatalog[catKey];
        categoryStates[catKey] = false;
        
        html += `<div class="materials-category" id="cat-${catKey}">`;
        html += `<div class="category-header" onclick="toggleCategory('${catKey}')">`;
        html += '<div class="category-title-group">';
        html += `<span>${category.icon}</span>`;
        html += `<span class="category-name">${category.name}</span>`;
        html += `<span class="category-count">${category.items.length} items</span>`;
        html += '</div>';
        html += '<span class="category-arrow">▼</span>';
        html += '</div>';
        html += '<div class="category-items">';
        
        category.items.forEach(item => {
          const itemId = `${catKey}-${item.id}`;
          html += '<div class="material-item">';
          html += `<input type="checkbox" id="${itemId}" onchange="toggleMaterial('${catKey}', '${item.id}')">`;
          html += '<div class="material-info">';
          html += `<div class="material-name">${item.name}</div>`;
          html += `<div class="material-spec">${item.sizes.join(', ')}</div>`;
          html += '</div>';
          html += '</div>';
        });
        
        html += '</div>';
        html += '</div>';
      });
      
      catalog.innerHTML = html;
    }
    
    function toggleCategory(catKey) {
      const cat = $(`cat-${catKey}`);
      cat.classList.toggle('expanded');
      categoryStates[catKey] = !categoryStates[catKey];
    }
    
    function expandAllCategories() {
      Object.keys(materialsCatalog).forEach(catKey => {
        $(`cat-${catKey}`).classList.add('expanded');
        categoryStates[catKey] = true;
      });
    }
    
    function collapseAllCategories() {
      Object.keys(materialsCatalog).forEach(catKey => {
        $(`cat-${catKey}`).classList.remove('expanded');
        categoryStates[catKey] = false;
      });
    }
    
    function filterMaterials() {
      // Simplified for demo
    }
    
    function toggleMaterial(catKey, itemId) {
      const category = materialsCatalog[catKey];
      const item = category.items.find(i => i.id === itemId);
      const checkbox = $(`${catKey}-${itemId}`);
      
      if (checkbox.checked) {
        selectedMaterials.push({
          catKey, name: item.name, 
          spec: item.sizes[0], 
          sizes: item.sizes,
          unit: item.unit || 'ea',
          quantity: 1
        });
      } else {
        selectedMaterials = selectedMaterials.filter(m => !(m.catKey === catKey && m.name === item.name));
      }
      
      displaySelectedMaterials();
    }
    
    function displaySelectedMaterials() {
      const container = $('selected-materials');
      
      if (selectedMaterials.length === 0) {
        container.innerHTML = '<div class="status-card info">ℹ️ No materials selected yet.</div>';
        return;
      }
      
      let html = '';
      selectedMaterials.forEach((item, idx) => {
        html += '<div class="selected-material">';
        html += '<div class="selected-material-info">';
        html += `<div class="material-name">${item.name}</div>`;
        html += `<div class="material-spec">${item.spec}</div>`;
        html += '</div>';
        html += '<div class="selected-material-controls">';
        html += `<input type="number" value="${item.quantity}" min="1" onchange="selectedMaterials[${idx}].quantity = parseInt(this.value)">`;
        html += `<span>${item.unit}</span>`;
        html += '</div>';
        html += '</div>';
      });
      
      container.innerHTML = html;
    }
    
    // ==================== REPORTS ====================
    function generateServiceReport() {
      const customer = $('customer-name').value || 'N/A';
      const tech = $('tech-name').value || 'Technician';
      
      let report = `FIELD BUDDY PRO - SERVICE REPORT

Customer: ${customer}
Technician: ${tech}
Date: ${new Date().toLocaleDateString()}

[Full diagnostic report content...]
`;
      
      displayReport(report, 'report-container');
      showToast('Service report generated!');
    }
    
    function generateMaterialsList() {
      const customer = $('mat-customer').value || 'N/A';
      
      let report = `FIELD BUDDY PRO - MATERIALS LIST

Customer: ${customer}

Materials:
${selectedMaterials.map(m => `- ${m.name} (${m.spec}) x${m.quantity} ${m.unit}`).join('\n')}
`;
      
      displayReport(report, 'report-container-mat');
      showToast('Materials list generated!');
    }
    
    function displayReport(text, containerId) {
      const container = $(containerId);
      let html = '<div class="card mt-lg">';
      html += '<div class="card-header"><div class="card-title">Report Generated</div></div>';
      html += '<div class="card-body">';
      html += `<div class="report-container">${text}</div>`;
      html += '<div class="btn-group mt-lg">';
      html += '<button class="btn btn-success" onclick="copyReport()">📋 Copy</button>';
      html += '<button class="btn btn-secondary" onclick="window.print()">🖨️ Print</button>';
      html += '</div>';
      html += '</div>';
      html += '</div>';
      container.innerHTML = html;
    }
    
    function copyReport() {
      const text = document.querySelector('.report-container').textContent;
      navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard!');
      });
    }
    
    async function clearForm() {
      const confirmed = await showModal('Clear Form', 'Are you sure you want to clear all data?');
      if (!confirmed) return;
      
      document.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'checkbox') {
          el.checked = false;
        } else if (el.id !== 'service-date' && el.id !== 'mat-date') {
          el.value = '';
        }
      });
      
      selectedMaterials = [];
      displaySelectedMaterials();
      showToast('Form cleared');
    }
    
    // ==================== INIT ====================
    window.addEventListener('load', () => {
      const today = new Date().toISOString().split('T')[0];
      $('service-date').value = today;
      $('mat-date').value = today;
      initMaterialsCatalog();
    });
  </script>
</body>
</html>