<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <meta name="description" content="Professional HVAC field documentation system for sales, service, and installation">
  <title>Field Buddy - Hybrid Job System</title>
  <style>
    /* ==================== BASE STYLES ==================== */
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    html {
      scroll-padding-top: 20px;
    }
    
    body { 
      font: 16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f5f5;
      padding: 8px;
      padding-bottom: 90px;
      color: #1a1a1a;
    }
    
    /* ==================== INPUTS ==================== */
    input, select, textarea, button {
      font-size: 16px;
      padding: 14px;
      border: 2px solid #ddd;
      border-radius: 8px;
      width: 100%;
      margin: 8px 0;
      font-family: inherit;
      -webkit-appearance: none;
      background: white;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #007AFF;
      box-shadow: 0 0 0 2px rgba(0,122,255,0.2);
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: 1.5;
    }
    
    input[readonly] {
      background: #f8f8f8;
      color: #666;
      cursor: not-allowed;
    }
    
    input[type="checkbox"] {
      width: 24px;
      height: 24px;
      margin-right: 12px;
      cursor: pointer;
      accent-color: #007AFF;
      flex-shrink: 0;
    }
    
    label {
      display: block;
      font-size: 13px;
      color: #666;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    label.check {
      display: flex;
      align-items: center;
      font-size: 15px;
      color: #1a1a1a;
      margin: 10px 0;
      padding: 12px;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
    }
    
    label.check:hover {
      background: #f8f8f8;
      border-color: #007AFF;
    }
    
    label.check input:checked {
      accent-color: #34C759;
    }
    
    label.check.checked {
      background: #e6f7ec;
      border-color: #34C759;
    }
    
    /* ==================== BUTTONS ==================== */
    button {
      background: #007AFF;
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.2s;
    }
    
    button:active {
      opacity: 0.7;
      transform: scale(0.98);
    }
    
    button.secondary { background: #8E8E93; }
    button.success { background: #34C759; }
    button.danger { background: #FF3B30; }
    button.warning { background: #FF9500; }
    button.small { 
      padding: 10px 14px;
      font-size: 14px;
      min-height: 40px;
    }
    
    /* ==================== CARDS ==================== */
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .card-header {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .card-subheader {
      font-size: 15px;
      font-weight: 600;
      color: #007AFF;
      margin: 16px 0 8px 0;
      padding-top: 12px;
      border-top: 1px solid #e0e0e0;
    }
    
    /* ==================== GRID LAYOUTS ==================== */
    .grid-2 { 
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .grid-3 { 
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }
    
    .grid-4 { 
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    
    @media (max-width: 640px) {
      .grid-2, .grid-3, .grid-4 {
        grid-template-columns: 1fr;
      }
    }
    
    /* ==================== MODE TOGGLE ==================== */
    .mode-toggle {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin: 12px 0;
    }
    
    .mode-toggle button {
      background: white;
      color: #666;
      border: 2px solid #ddd;
      font-size: 15px;
      padding: 12px;
      min-height: 44px;
    }
    
    .mode-toggle button.active {
      background: #007AFF;
      color: white;
      border-color: #007AFF;
    }
    
    /* ==================== STATUS INDICATORS ==================== */
    .status {
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.4;
    }
    
    .status.good { 
      background: #D1F4E0; 
      color: #0F5132; 
      border-left: 4px solid #34C759;
    }
    
    .status.warn { 
      background: #FFF3CD; 
      color: #664D03; 
      border-left: 4px solid #FF9500;
    }
    
    .status.bad { 
      background: #F8D7DA; 
      color: #842029; 
      border-left: 4px solid #FF3B30;
    }
    
    .status.info {
      background: #D1ECF1;
      color: #0C5460;
      border-left: 4px solid #007AFF;
    }
    
    /* ==================== VOICE INPUT ==================== */
    .voice-wrapper {
      position: relative;
    }
    
    .voice-btn {
      position: absolute;
      right: 4px;
      top: 12px;
      transform: translateY(0);
      width: 40px;
      height: 40px;
      padding: 0;
      background: #007AFF;
      border-radius: 50%;
      font-size: 20px;
      z-index: 2;
      min-height: unset;
      margin: 0;
    }

    textarea + .voice-btn {
      top: 12px;
    }
    
    .voice-btn.listening { 
      background: #FF3B30;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .voice-wrapper input,
    .voice-wrapper textarea {
      padding-right: 50px;
    }

    /* ==================== DYNAMIC FIELDS ==================== */
    .dynamic-item {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      border: 1px solid #e0e0e0;
      position: relative;
    }
    
    .dynamic-item .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #FF3B30;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: unset;
      padding: 0;
      margin: 0;
    }
    
    .add-btn {
      background: #34C759;
      margin-top: 8px;
    }
    
    /* ==================== COLLAPSIBLE SECTIONS ==================== */
    .section {
      margin: 16px 0;
    }
    
    .section-toggle {
      background: white;
      border: 2px solid #ddd;
      color: #1a1a1a;
      font-weight: 600;
      padding: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      border-radius: 8px;
      margin: 8px 0;
      transition: all 0.2s;
      width: 100%;
      text-align: left;
      min-height: 48px;
    }
    
    .section-toggle:hover {
      background: #f8f8f8;
      border-color: #007AFF;
    }
    
    .section-toggle .arrow {
      font-size: 18px;
      transition: transform 0.2s;
      transform-origin: center;
    }
    
    .section.open .arrow {
      transform: rotate(180deg);
    }
    
    .section-content {
      display: none;
      background: white;
      padding: 16px;
      border-radius: 0 0 8px 8px;
      border: 2px solid #ddd;
      border-top: none;
      margin-top: -8px;
    }
    
    .section.open .section-content {
      display: block;
    }
    
    /* ==================== MODE-SPECIFIC VISIBILITY ==================== */
    .service-only,
    .install-only,
    .ductwork-only,
    .cooling-only,
    .heating-only { 
      display: none; 
    }
    
    body.mode-service .service-only { display: block; }
    body.mode-install .install-only { display: block; }
    body.mode-ductwork .ductwork-only { display: block; }
    
    body.mode-service.mode-cooling .cooling-only { display: block; }
    body.mode-service.mode-heating .heating-only { display: block; }
    
    body.mode-install.mode-cooling .cooling-only { display: block; }
    body.mode-install.mode-heating .heating-only { display: block; }

    /* Grid override for mode-specific items */
    .grid-2 .cooling-only,
    .grid-2 .heating-only,
    .grid-3 .cooling-only,
    .grid-3 .heating-only {
      display: none;
    }
    
    body.mode-service.mode-cooling .grid-2 .cooling-only,
    body.mode-service.mode-cooling .grid-3 .cooling-only,
    body.mode-install.mode-cooling .grid-2 .cooling-only,
    body.mode-install.mode-cooling .grid-3 .cooling-only {
      display: block;
    }
    
    body.mode-service.mode-heating .grid-2 .heating-only,
    body.mode-service.mode-heating .grid-3 .heating-only,
    body.mode-install.mode-heating .grid-2 .heating-only,
    body.mode-install.mode-heating .grid-3 .heating-only {
      display: block;
    }
    
    /* ==================== PHOTOS ==================== */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
      margin-top: 12px;
    }
    
    .photo-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      background: #f0f0f0;
    }
    
    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .photo-label {
      position: absolute;
      bottom: 4px;
      left: 4px;
      right: 4px;
      background: rgba(0,0,0,0.75);
      color: white;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      text-align: center;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .photo-delete {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #FF3B30;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.9;
      min-height: unset;
      padding: 0;
      margin: 0;
    }
    
    /* ==================== REPORT PREVIEW ==================== */
    .report-preview {
      background: #f8f8f8;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-x: auto;
      margin: 12px 0;
      border: 1px solid #ddd;
    }
    
    /* ==================== STICKY ACTION BAR ==================== */
    .actions {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 10px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      display: flex;
      gap: 8px;
      z-index: 100;
    }
    
    .actions button {
      flex: 1;
      font-size: 14px;
      padding: 12px 8px;
    }
    
    /* ==================== MODAL & TOAST ==================== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: scale(0.95);
      transition: transform 0.2s;
    }
    
    .modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-overlay.visible .modal-content {
      transform: scale(1);
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .modal-body {
      font-size: 15px;
      color: #333;
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    .modal-actions {
      display: flex;
      gap: 8px;
    }
    
    .modal-actions button {
      flex: 1;
    }
    
    .toast-notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s, top 0.3s;
    }
    
    .toast-notification.visible {
      opacity: 1;
      visibility: visible;
      top: 30px;
    }
    
    .toast-notification.success { background: #34C759; }
    .toast-notification.danger { background: #FF3B30; }
    
    /* ==================== HIDDEN / UTILITY ==================== */
    .hidden { display: none !important; }
    .mt-8 { margin-top: 8px; }
    .mt-16 { margin-top: 16px; }
    .mb-8 { margin-bottom: 8px; }
    .text-muted { color: #666; font-size: 13px; }
  </style>
</head>
<body class="mode-service mode-cooling">

  <!-- Header -->
  <div class="card">
    <div class="card-header">
      <div>
        <div style="font-size: 20px;">‚ö° Field Buddy</div>
        <div style="font-size: 12px; color: #666; font-weight: 400; margin-top: 4px;">Hybrid Job System</div>
      </div>
    </div>
    
    <div class="mode-toggle">
      <button onclick="setMode('service')" id="btn-service" class="active">üîß Service</button>
      <button onclick="setMode('install')" id="btn-install">üì¶ Install</button>
      <button onclick="setMode('ductwork')" id="btn-ductwork">üå¨Ô∏è Ductwork</button>
    </div>
  </div>

  <!-- Job Info -->
  <div class="card">
    <div class="card-header">
      <span>üìã Job Information</span>
    </div>
    
    <label for="customer">Customer Name</label>
    <input type="text" id="customer" placeholder="Full name">
    
    <label for="address">Address</label>
    <input type="text" id="address" placeholder="Street, City, State">
    
    <div class="grid-2">
      <div>
        <label for="sales-tech">Sold By (Sales Tech)</label>
        <input type="text" id="sales-tech" placeholder="Sales tech name">
      </div>
      <div>
        <label for="sale-date">Sale Date</label>
        <input type="date" id="sale-date">
      </div>
    </div>
    
    <div class="grid-2 install-only">
      <div>
        <label for="install-date">Scheduled Install Date</label>
        <input type="date" id="install-date">
      </div>
      <div>
        <label for="labor-hours">Estimated Labor Hours</label>
        <input type="number" id="labor-hours" step="0.5" placeholder="e.g., 6.5">
      </div>
    </div>
    
    <div class="service-only ductwork-only">
      <label>Job Type</label>
      <select id="job-type">
        <option value="">Select job type...</option>
        <option value="maintenance">Maintenance</option>
        <option value="repair">Repair</option>
        <option value="diagnostic">Diagnostic</option>
        <option value="ductwork">Ductwork Install/Repair</option>
      </select>
    </div>
    
    <div class="service-only">
      <label>Customer Complaint</label>
      <div class="voice-wrapper">
        <textarea id="complaint" placeholder="What's the issue? (in customer's words)" rows="3"></textarea>
        <button class="voice-btn" data-voice="complaint">üé§</button>
      </div>
    </div>
  </div>
  
  <!-- On-Site Time Tracking -->
  <div class="card service-only ductwork-only">
    <div class="card-header">
      <span>‚è±Ô∏è Time Tracking</span>
    </div>
    
    <div class="grid-2">
      <div>
        <label>Arrival Time</label>
        <input type="time" id="arrival-time">
      </div>
      <div>
        <label>Completion Time</label>
        <input type="time" id="completion-time" onchange="calculateLaborHours()">
      </div>
    </div>
    
    <div class="grid-2">
      <div>
        <label>Travel Time (minutes)</label>
        <input type="number" id="travel-time" min="0" step="5">
      </div>
      <div>
        <label>Total Labor Hours (auto)</label>
        <input type="text" id="total-hours" readonly>
      </div>
    </div>
  </div>
  
  <!-- Equipment Section (Mode-Aware) -->
  <div class="card">
    <div class="card-header">
      <span>‚öôÔ∏è Equipment</span>
    </div>

    <!-- Heat/Cool Toggle for Service/Install -->
    <div class="mode-toggle service-only install-only" style="grid-template-columns: 1fr 1fr; margin-bottom: 12px;">
      <button onclick="setHeatCoolMode('cooling')" id="btn-hc-cooling" class="active secondary">‚ùÑÔ∏è Cooling</button>
      <button onclick="setHeatCoolMode('heating')" id="btn-hc-heating" class="secondary">üî• Heating</button>
    </div>
    
    <!-- SERVICE/DUCTWORK: Document Existing Equipment -->
    <div class="service-only ductwork-only">
      <label>Unit Type</label>
      <select id="unit-type" onchange="toggleUnitData()">
          <option value="">Select unit type...</option>
          <option value="split">Split System</option>
          <option value="package">Package Unit</option>
          <option value="minisplit">Mini-Split</option>
          <option value="heatpump">Heat Pump</option>
      </select>
      
      <label for="brand">Brand</label>
      <select id="brand">
        <option value="">Select brand...</option>
        <option value="Carrier">Carrier</option>
        <option value="Trane">Trane</option>
        <option value="Lennox">Lennox</option>
        <option value="Rheem">Rheem</option>
        <option value="Goodman">Goodman</option>
        <option value="York">York</option>
        <option value="American Standard">American Standard</option>
        <option value="Bryant">Bryant</option>
        <option value="Daikin">Daikin</option>
        <option value="Mitsubishi">Mitsubishi</option>
        <option value="Other">Other</option>
      </select>
      
      <div id="indoor-unit-fields" class="mt-8">
          <label>Indoor Unit Data (Nameplate)</label>
          <div class="voice-wrapper mb-8">
              <input type="text" id="indoor-data" placeholder="Model/Serial/Tonnage">
              <button class="voice-btn" data-voice="indoor-data">üé§</button>
          </div>
      </div>

      <div id="outdoor-unit-fields">
          <label>Outdoor Unit Data (Nameplate)</label>
          <div class="voice-wrapper mb-8">
              <input type="text" id="outdoor-data" placeholder="Model/Serial/SEER-BTU">
              <button class="voice-btn" data-voice="outdoor-data">üé§</button>
          </div>
      </div>
      
      <div class="grid-2">
        <div>
          <label for="tonnage">System Tonnage</label>
          <select id="tonnage">
            <option value="">Select...</option>
            <option value="1.5">1.5 Ton</option>
            <option value="2">2 Ton</option>
            <option value="2.5">2.5 Ton</option>
            <option value="3">3 Ton</option>
            <option value="3.5">3.5 Ton</option>
            <option value="4">4 Ton</option>
            <option value="5">5 Ton</option>
          </select>
        </div>
        <div>
          <label for="refrigerant">Refrigerant Type</label>
          <select id="refrigerant" onchange="clearRefrigerantCalculations()">
            <option value="">Select...</option>
            <option value="R-410A">R-410A</option>
            <option value="R-22">R-22 (Legacy)</option>
            <option value="R-32">R-32</option>
            <option value="R-454B">R-454B (A2L)</option>
          </select>
        </div>
      </div>
      
      <label for="mfg-date">Manufacture Date</label>
      <input type="date" id="mfg-date" onchange="calculateAge()">
      <div id="equipment-age" class="text-muted"></div>
    </div>
    
    <!-- INSTALL: Select Equipment TO BE INSTALLED -->
    <div class="install-only">
      <div class="status warn">
        <span>‚ö†Ô∏è</span>
        <span>Check ALL items being replaced/installed</span>
      </div>
      
      <label class="check">
        <input type="checkbox" id="equip-condenser" onchange="toggleEquipmentSection('condenser')">
        <span>Condenser (Outdoor Unit)</span>
      </label>
      
      <div id="section-condenser" class="hidden mt-8">
        <div class="grid-2">
          <div>
            <label for="condenser-brand">Brand</label>
            <select id="condenser-brand">
              <option value="">Select brand...</option>
              <option value="Carrier">Carrier</option>
              <option value="Trane">Trane</option>
              <option value="Lennox">Lennox</option>
              <option value="Rheem">Rheem</option>
              <option value="Goodman">Goodman</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="condenser-tonnage">Tonnage</label>
            <select id="condenser-tonnage">
              <option value="">Select...</option>
              <option value="1.5">1.5 Ton</option>
              <option value="2">2 Ton</option>
              <option value="2.5">2.5 Ton</option>
              <option value="3">3 Ton</option>
              <option value="3.5">3.5 Ton</option>
              <option value="4">4 Ton</option>
              <option value="5">5 Ton</option>
            </select>
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label for="condenser-seer">SEER Rating</label>
            <select id="condenser-seer">
              <option value="">Select...</option>
              <option value="14">14 SEER</option>
              <option value="15">15 SEER</option>
              <option value="16">16 SEER</option>
              <option value="17">17 SEER</option>
              <option value="18">18 SEER</option>
              <option value="20">20 SEER</option>
            </select>
          </div>
          <div>
            <label for="condenser-model">Model Number</label>
            <input type="text" id="condenser-model" placeholder="e.g., 24ACC636">
          </div>
        </div>
        <label>Line Set Required</label>
        <div class="grid-2">
          <select id="condenser-lineset-size">
            <option value="">Select size...</option>
            <option value="1/4-3/8">1/4" x 3/8"</option>
            <option value="1/4-1/2">1/4" x 1/2"</option>
            <option value="3/8-3/4">3/8" x 3/4"</option>
            <option value="3/8-7/8">3/8" x 7/8"</option>
          </select>
          <input type="number" id="condenser-lineset-length" placeholder="Length (ft)" min="15">
        </div>
      </div>
      
      <label class="check">
        <input type="checkbox" id="equip-evap-coil" onchange="toggleEquipmentSection('evap-coil')">
        <span>Evaporator Coil</span>
      </label>
      
      <div id="section-evap-coil" class="hidden mt-8">
        <div class="grid-2">
          <div>
            <label for="evap-brand">Brand</label>
            <select id="evap-brand">
              <option value="">Select brand...</option>
              <option value="Carrier">Carrier</option>
              <option value="Trane">Trane</option>
              <option value="Lennox">Lennox</option>
              <option value="Rheem">Rheem</option>
              <option value="Goodman">Goodman</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="evap-tonnage">Tonnage</label>
            <select id="evap-tonnage">
              <option value="">Select...</option>
              <option value="1.5">1.5 Ton</option>
              <option value="2">2 Ton</option>
              <option value="2.5">2.5 Ton</option>
              <option value="3">3 Ton</option>
              <option value="3.5">3.5 Ton</option>
              <option value="4">4 Ton</option>
              <option value="5">5 Ton</option>
            </select>
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label for="evap-orientation">Orientation</label>
            <select id="evap-orientation">
              <option value="">Select...</option>
              <option value="Vertical Slab">Vertical Slab</option>
              <option value="Horizontal Slab">Horizontal Slab</option>
              <option value="A-Coil">A-Coil</option>
              <option value="N-Coil">N-Coil</option>
            </select>
          </div>
          <div>
            <label for="evap-model">Model Number</label>
            <input type="text" id="evap-model" placeholder="e.g., CNPVP3617">
          </div>
        </div>
      </div>
      
      <label class="check">
        <input type="checkbox" id="equip-air-handler" onchange="toggleEquipmentSection('air-handler')">
        <span>Air Handler</span>
      </label>
      
      <div id="section-air-handler" class="hidden mt-8">
        <div class="grid-2">
          <div>
            <label for="air-handler-brand">Brand</label>
            <select id="air-handler-brand">
              <option value="">Select brand...</option>
              <option value="Carrier">Carrier</option>
              <option value="Trane">Trane</option>
              <option value="Lennox">Lennox</option>
              <option value="Rheem">Rheem</option>
              <option value="Goodman">Goodman</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="air-handler-tonnage">Tonnage</label>
            <select id="air-handler-tonnage">
              <option value="">Select...</option>
              <option value="2">2 Ton</option>
              <option value="2.5">2.5 Ton</option>
              <option value="3">3 Ton</option>
              <option value="3.5">3.5 Ton</option>
              <option value="4">4 Ton</option>
              <option value="5">5 Ton</option>
            </select>
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label for="air-handler-type">Type</label>
            <select id="air-handler-type">
              <option value="">Select...</option>
              <option value="Multi-Speed">Multi-Speed</option>
              <option value="Variable Speed">Variable Speed</option>
              <option value="ECM">ECM Motor</option>
            </select>
          </div>
          <div>
            <label for="air-handler-model">Model Number</label>
            <input type="text" id="air-handler-model" placeholder="e.g., FE4ANB006">
          </div>
        </div>
      </div>
      
      <label class="check">
        <input type="checkbox" id="equip-furnace" onchange="toggleEquipmentSection('furnace')">
        <span>Furnace</span>
      </label>
      
      <div id="section-furnace" class="hidden mt-8">
        <div class="grid-2">
          <div>
            <label for="furnace-brand">Brand</label>
            <select id="furnace-brand">
              <option value="">Select brand...</option>
              <option value="Carrier">Carrier</option>
              <option value="Trane">Trane</option>
              <option value="Lennox">Lennox</option>
              <option value="Rheem">Rheem</option>
              <option value="Goodman">Goodman</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label for="furnace-btu">BTU Input</label>
            <select id="furnace-btu">
              <option value="">Select...</option>
              <option value="40000">40,000 BTU</option>
              <option value="60000">60,000 BTU</option>
              <option value="80000">80,000 BTU</option>
              <option value="100000">100,000 BTU</option>
              <option value="120000">120,000 BTU</option>
            </select>
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label for="furnace-efficiency">Efficiency</label>
            <select id="furnace-efficiency">
              <option value="">Select...</option>
              <option value="80">80% AFUE</option>
              <option value="92">92% AFUE</option>
              <option value="96">96% AFUE</option>
              <option value="98">98% AFUE (Condensing)</option>
            </select>
          </div>
          <div>
            <label for="furnace-model">Model Number</label>
            <input type="text" id="furnace-model" placeholder="e.g., 58MCA">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- INSTALL MODE: Sales Planning Sections -->
  <div class="install-only">
    
    <div class="section" id="section-plenum-ductwork">
      <button class="section-toggle" onclick="toggleSection('section-plenum-ductwork')">
        <span>üå¨Ô∏è Plenum & Ductwork Mods</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label class="check">
          <input type="checkbox" id="plenum-supply" onchange="toggleSubSection('supply-plenum-fields')">
          <span>Supply Plenum Replacement</span>
        </label>
        <div id="supply-plenum-fields" class="hidden mt-8">
          <label>Supply Plenum Dimensions</label>
          <div class="grid-3">
            <input type="number" id="supply-width" placeholder="Width (in)" min="10" max="36">
            <input type="number" id="supply-height" placeholder="Height (in)" min="10" max="36">
            <input type="number" id="supply-length" placeholder="Length (in)" min="12" max="72">
          </div>
          <label for="supply-gauge">Sheet Metal Gauge</label>
          <select id="supply-gauge">
            <option value="26ga">26 Gauge</option>
            <option value="24ga">24 Gauge</option>
            <option value="22ga">22 Gauge</option>
          </select>
        </div>
        
        <label class="check mt-16">
          <input type="checkbox" id="plenum-return" onchange="toggleSubSection('return-plenum-fields')">
          <span>Return Plenum Replacement</span>
        </label>
        <div id="return-plenum-fields" class="hidden mt-8">
          <label>Return Plenum Dimensions</label>
          <div class="grid-3">
            <input type="number" id="return-width" placeholder="Width (in)" min="14" max="36">
            <input type="number" id="return-height" placeholder="Height (in)" min="14" max="36">
            <input type="number" id="return-length" placeholder="Length (in)" min="12" max="48">
          </div>
          <label for="return-gauge">Sheet Metal Gauge</label>
          <select id="return-gauge">
            <option value="26ga">26 Gauge</option>
            <option value="24ga">24 Gauge</option>
            <option value="22ga">22 Gauge</option>
          </select>
        </div>
        
        <div class="card-subheader">Ductwork Materials</div>
        <label class="check">
          <input type="checkbox" id="duct-board">
          <span>Ductboard (e.g., 1" 4x10 sheet)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="duct-cleats">
          <span>Drive / S-Cleats (for transitions)</span>
        </label>
        
        <div class="card-subheader">Collar Schedule</div>
        <div class="status info">
          <span>‚ÑπÔ∏è</span>
          <span>Add all collars needed for supply and return connections</span>
        </div>
        <div id="collar-list"></div>
        <button class="add-btn small" onclick="addCollar()">+ Add Collar</button>
        
        <div class="card-subheader">Flex Duct Runs</div>
        <div id="flex-duct-list"></div>
        <button class="add-btn small" onclick="addFlexDuct()">+ Add Flex Duct Run</button>
        
        <div class="card-subheader">Registers & Grilles</div>
        <div id="register-list"></div>
        <button class="add-btn small" onclick="addRegister()">+ Add Register/Grille</button>
      </div>
    </div>
    
    <div class="section" id="section-gas-venting">
      <button class="section-toggle" onclick="toggleSection('section-gas-venting')">
        <span>üî• Gas & Venting (Flue)</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <div class="status warn">
          <span>‚ö†Ô∏è</span>
          <span>Crucial for furnace installs!</span>
        </div>
        
        <div class="card-subheader">Gas Line Materials</div>
        <div class="grid-2">
          <div>
            <label for="gas-pipe-type">Gas Pipe Type</label>
            <select id="gas-pipe-type">
              <option value="">N/A</option>
              <option value="Black Iron">Black Iron</option>
              <option value="CSST (Coated)">CSST (Coated)</option>
            </select>
          </div>
          <div>
            <label for="gas-pipe-size">Gas Pipe Size</label>
            <select id="gas-pipe-size">
              <option value="">N/A</option>
              <option value="1/2">1/2"</option>
              <option value="3/4">3/4"</option>
              <option value="1">1"</option>
            </select>
          </div>
        </div>
        <label for="gas-pipe-length">Gas Pipe Length (ft)</label>
        <input type="number" id="gas-pipe-length" placeholder="Total length" min="1">
        
        <label class="check">
          <input type="checkbox" id="gas-shutoff">
          <span>Gas Shutoff Valve</span>
        </label>
        <label class="check">
          <input type="checkbox" id="gas-drip-leg">
          <span>Drip Leg / Sediment Trap</span>
        </label>
        <label class="check">
          <input type="checkbox" id="gas-fittings">
          <span>Fittings Kit (Elbows, Tees, Couplings)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="gas-sealant">
          <span>Pipe Dope / Thread Sealant</span>
        </label>
        
        <div class="card-subheader">Venting (Flue) Materials</div>
        <div class="grid-2">
          <div>
            <label for="flue-type">Venting Type</label>
            <select id="flue-type">
              <option value="">N/A</option>
              <option value="B-Vent (80%)">B-Vent (80%)</option>
              <option value="PVC (90%+)">PVC (90%+)</option>
            </select>
          </div>
          <div>
            <label for="flue-size">Venting Size</label>
            <select id="flue-size">
              <option value="">N/A</option>
              <option value="2">2"</option>
              <option value="3">3"</option>
              <option value="4">4"</option>
            </select>
          </div>
        </div>
        <label for="flue-length">Venting Length (ft)</label>
        <input type="number" id="flue-length" placeholder="Total length" min="1">
        
        <label class="check">
          <input type="checkbox" id="flue-termination">
          <span>Termination Kit (Concentric, Side-wall, etc.)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="flue-cement">
          <span>Flue Cement / PVC Primer & Glue</span>
        </label>
      </div>
    </div>
    
    <div class="section" id="section-iaq-upgrades">
      <button class="section-toggle" onclick="toggleSection('section-iaq-upgrades')">
        <span>üí® Indoor Air Quality Upgrades</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label class="check">
          <input type="checkbox" id="iaq-reme-halo">
          <span>REME HALO (Standard)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="iaq-reme-halo-led">
          <span>REME HALO LED (Low Maintenance)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="iaq-uv-light">
          <span>UV Light System</span>
        </label>
        <label class="check">
          <input type="checkbox" id="iaq-media-filter" onchange="toggleSubSection('media-filter-fields')">
          <span>Media Filter Cabinet</span>
        </label>
        <div id="media-filter-fields" class="hidden mt-8">
          <label for="media-filter-size">Filter Cabinet Size</label>
          <select id="media-filter-size">
            <option value="">Select size...</option>
            <option value="16x25">16x25</option>
            <option value="20x25">20x25</option>
            <option value="20x20">20x20</option>
          </select>
          <label for="media-filter-merv">MERV Rating</label>
          <select id="media-filter-merv">
            <option value="11">MERV 11</option>
            <option value="13">MERV 13</option>
            <option value="16">MERV 16</option>
          </select>
        </div>
        <label class="check">
          <input type="checkbox" id="iaq-bipolar">
          <span>Bipolar Ionization</span>
        </label>
        <label for="iaq-other" class="mt-16">Other IAQ Equipment</label>
        <textarea id="iaq-other" placeholder="Specify any other air quality upgrades" rows="2"></textarea>
      </div>
    </div>
    
    <div class="section" id="section-drain-safety">
      <button class="section-toggle" onclick="toggleSection('section-drain-safety')">
        <span>üíß Drain System & Safety Devices</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label class="check">
          <input type="checkbox" id="drain-emergency-pan">
          <span>Emergency Drain Pan</span>
        </label>
        <label class="check">
          <input type="checkbox" id="drain-float-primary">
          <span>Float Switch (Primary)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="drain-float-secondary">
          <span>Float Switch (Secondary/Pan)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="drain-pump" onchange="toggleSubSection('pump-fields')">
          <span>Condensate Pump</span>
        </label>
        <div id="pump-fields" class="hidden mt-8">
          <label for="pump-tubing-length">Clear Vinyl Tubing Length (ft)</label>
          <input type="number" id="pump-tubing-length" placeholder="e.g., 20" min="1">
        </div>
        <label class="check">
          <input type="checkbox" id="drain-pvc-work" onchange="toggleSubSection('pvc-work-fields')">
          <span>PVC Drain Line Work</span>
        </label>
        <div id="pvc-work-fields" class="hidden mt-8">
          <div class="grid-2">
            <div>
              <label for="pvc-size">PVC Size</label>
              <select id="pvc-size">
                <option value="3/4">3/4"</option>
                <option value="1">1"</option>
                <option value="1-1/4">1-1/4"</option>
              </select>
            </div>
            <div>
              <label for="pvc-length">Length Needed (ft)</label>
              <input type="number" id="pvc-length" placeholder="e.g., 25" min="1">
            </div>
          </div>
          <label class="check">
            <input type="checkbox" id="pvc-trap">
            <span>P-Trap Required</span>
          </label>
          <label class="check">
            <input type="checkbox" id="pvc-straps">
            <span>Hanging Straps / Clamps</span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="section" id="section-electrical">
      <button class="section-toggle" onclick="toggleSection('section-electrical')">
        <span>‚ö° Electrical Materials</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label class="check">
          <input type="checkbox" id="elec-disconnect" onchange="toggleSubSection('disconnect-fields')">
          <span>Disconnect Box</span>
        </label>
        <div id="disconnect-fields" class="hidden mt-8">
          <label for="disconnect-rating">Disconnect Rating</label>
          <select id="disconnect-rating">
            <option value="">Select...</option>
            <option value="30A (Non-fused)">30A (Non-fused)</option>
            <option value="30A (Fused)">30A (Fused)</option>
            <option value="60A (Non-fused)">60A (Non-fused)</option>
            <option value="60A (Fused)">60A (Fused)</option>
          </select>
          <label class="check">
            <input type="checkbox" id="elec-whip">
            <span>Electrical Whip (e.g., 6ft 1/2")</span>
          </label>
          <label class="check">
            <input type="checkbox" id="elec-surge">
            <span>AC Surge Protector (at disconnect)</span>
          </label>
        </div>
        
        <label class="check">
          <input type="checkbox" id="elec-breaker" onchange="toggleSubSection('breaker-fields')">
          <span>Breaker</span>
        </label>
        <div id="breaker-fields" class="hidden mt-8">
          <label for="breaker-size">Breaker Size</label>
          <select id="breaker-size">
            <option value="">Select...</option>
            <option value="15A Single Pole">15A Single Pole</option>
            <option value="20A Double Pole">20A Double Pole</option>
            <option value="30A Double Pole">30A Double Pole</option>
            <option value="40A Double Pole">40A Double Pole</option>
            <option value="50A Double Pole">50A Double Pole</option>
            <option value="60A Double Pole">60A Double Pole</option>
          </select>
        </div>
        
        <label class="check">
          <input type="checkbox" id="elec-wire-run" onchange="toggleSubSection('wire-run-fields')">
          <span>High Voltage Wire Run</span>
        </label>
        <div id="wire-run-fields" class="hidden mt-8">
          <div class="grid-3">
            <div>
              <label for="wire-gauge">Gauge</label>
              <select id="wire-gauge">
                <option value="14">14</option>
                <option value="12">12</option>
                <option value="10">10</option>
                <option value="8">8</option>
                <option value="6">6</option>
              </select>
            </div>
            <div>
              <label for="wire-type">Type</label>
              <select id="wire-type">
                <option value="THHN (stranded)">THHN (stranded)</option>
                <option value="Romex (solid)">Romex (solid)</option>
              </select>
            </div>
            <div>
              <label for="wire-length">Length (ft)</label>
              <input type="number" id="wire-length" placeholder="e.g., 50" min="1">
            </div>
          </div>
        </div>
        
        <label class="check">
          <input type="checkbox" id="elec-tstat-wire" onchange="toggleSubSection('tstat-wire-fields')">
          <span>Thermostat Wire Run</span>
        </label>
        <div id="tstat-wire-fields" class="hidden mt-8">
          <div class="grid-2">
            <div>
              <label for="tstat-wire-type">Type</label>
              <select id="tstat-wire-type">
                <option value="18/2">18/2</option>
                <option value="18/3">18/3</option>
                <option value="18/5">18/5</option>
                <option value="18/7">18/7</option>
                <option value="18/8">18/8</option>
                <option value="18/10">18/10</option>
              </select>
            </div>
            <div>
              <label for="tstat-wire-length">Length (ft)</label>
              <input type="number" id="tstat-wire-length" placeholder="e.g., 75" min="1">
            </div>
          </div>
        </div>
        
        <label class="check">
          <input type="checkbox" id="elec-thermostat" onchange="toggleSubSection('thermostat-fields')">
          <span>Thermostat</span>
        </label>
        <div id="thermostat-fields" class="hidden mt-8">
          <label for="thermostat-model">Thermostat Model</label>
          <input type="text" id="thermostat-model" placeholder="e.g., Honeywell T6, Ecobee">
        </div>
      </div>
    </div>
    
    <div class="section" id="section-mounting-accessories">
      <button class="section-toggle" onclick="toggleSection('section-mounting-accessories')">
        <span>üî© Mounting & Accessories</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label class="check">
          <input type="checkbox" id="mount-pad">
          <span>Condenser Pad / Stand</span>
        </label>
        <label class="check">
          <input type="checkbox" id="mount-vibration">
          <span>Vibration Isolators (Pad or Hangers)</span>
        </label>
        <label class="check">
          <input type="checkbox" id="mount-hangers">
          <span>Duct Hangers / Straps</span>
        </label>
        <label class="check">
          <input type="checkbox" id="mount-refrigerant">
          <span>Refrigerant (R-410A) - 1 Jug</span>
        </label>
        <label class="check">
          <input type="checkbox" id="mount-brazing">
          <span>Brazing Rods</span>
        </label>
        <label class="check">
          <input type="checkbox" id="mount-nitrogen">
          <span>Nitrogen (for brazing)</span>
        </label>
        
        <div class="grid-2">
          <div>
            <label for="mount-mastic">Mastic (quarts)</label>
            <input type="number" id="mount-mastic" placeholder="Qty" min="1">
          </div>
          <div>
            <label for="mount-foil-tape">Foil Tape (rolls)</label>
            <input type="number" id="mount-foil-tape" placeholder="Qty" min="1">
          </div>
        </div>
        
        <label for="mount-other" class="mt-16">Other Supplies</label>
        <textarea id="mount-other" placeholder="e.g., Zip ties, Pookie, Sheet metal screws..." rows="2"></textarea>
      </div>
    </div>
    
    <div class="section" id="section-site-conditions">
      <button class="section-toggle" onclick="toggleSection('section-site-conditions')">
        <span>üìç Site Conditions & Access</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label for="site-location">Equipment Location</label>
        <select id="site-location">
          <option value="">Select...</option>
          <option value="Attic">Attic</option>
          <option value="Crawlspace">Crawlspace</option>
          <option value="Garage">Garage</option>
          <option value="Basement">Basement</option>
          <option value="Closet">Closet</option>
          <option value="Rooftop">Rooftop</option>
        </select>
        
        <label for="site-access-type">Access Type</label>
        <select id="site-access-type">
          <option value="">Select...</option>
          <option value="Attic Pull-Down Ladder">Attic Pull-Down Ladder</option>
          <option value="Scuttle Hole">Scuttle Hole</option>
          <option value="Stairs">Stairs</option>
          <option value="Door">Door</option>
          <option value="Hatch">Hatch</option>
          <option value="Ladder (External)">Ladder (External)</option>
        </select>
        
        <label for="site-access-size">Access Opening Size</label>
        <input type="text" id="site-access-size" placeholder="e.g., 22&quot; x 30&quot;">
        
        <label for="site-workspace">Workspace Condition</label>
        <select id="site-workspace">
          <option value="">Select...</option>
          <option value="Adequate - No Issues">Adequate - No Issues</option>
          <option value="Tight - Be Careful">Tight - Be Careful</option>
          <option value="Floored">Floored</option>
          <option value="Trusses Only - Bring Planks">Trusses Only - Bring Planks</option>
        </select>
        
        <label for="site-parking">Parking Situation</label>
        <input type="text" id="site-parking" placeholder="e.g., Driveway, Street, Garage">
        
        <label class="check mt-16">
          <input type="checkbox" id="site-customer-home">
          <span>Customer will be home</span>
        </label>
        <label class="check">
          <input type="checkbox" id="site-power-off">
          <span>Main power shutoff required</span>
        </label>
        
        <label for="site-notes" class="mt-16">Site Notes</label>
        <textarea id="site-notes" placeholder="e.g., Watch out for dog, cover new carpet, long walk from truck..." rows="3"></textarea>
      </div>
    </div>
    
    <div class="section" id="section-special-instructions">
      <button class="section-toggle" onclick="toggleSection('section-special-instructions')">
        <span>‚ùó Special Instructions for Crew</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label for="instruct-reason">Reason for Replacement</label>
        <textarea id="instruct-reason" placeholder="e.g., Compressor failed, heat exchanger cracked..." rows="2"></textarea>
        
        <label for="instruct-concerns">Customer Concerns</label>
        <textarea id="instruct-concerns" placeholder="e.g., Worried about noise, wants better airflow in master..." rows="3"></textarea>
        
        <label for="instruct-pre-install">Pre-Install Checks</label>
        <textarea id="instruct-pre-install" placeholder="e.g., Verify duct sizing, double-check line set..." rows="2"></textarea>
        
        <label for="instruct-post-install">Post-Install Testing</label>
        <textarea id="instruct-post-install" placeholder="e.g., Commission system, check static pressure, walk customer through thermostat..." rows="3"></textarea>
      </div>
    </div>
  </div>
  
  <!-- SERVICE MODE: On-Site Sections -->
  <div class="service-only">
    
    <div class="section" id="section-materials-service">
      <button class="section-toggle" onclick="toggleSection('section-materials-service')">
        <span>üîß Parts & Materials Used</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <label>Refrigerant</label>
        <div class="grid-2">
          <select id="refrigerant-added-type">
            <option value="">Type...</option>
            <option value="R-410A">R-410A</option>
            <option value="R-22">R-22</option>
            <option value="R-32">R-32</option>
            <option value="R-454B">R-454B</option>
          </select>
          <input type="text" id="refrigerant-amount" placeholder="Amount (lbs/oz)">
        </div>
        <input type="text" id="refrigerant-recovered" placeholder="Amount Recovered (if any)">
        
        <label>Filter Replaced</label>
        <div class="grid-2">
          <select id="filter-size">
            <option value="">Size...</option>
            <option value="16x25x1">16x25x1</option>
            <option value="20x25x1">20x25x1</option>
            <option value="20x25x4">20x25x4 (Media)</option>
            <option value="other">Other Size</option>
          </select>
          <select id="filter-merv">
            <option value="">MERV...</option>
            <option value="8">MERV 8</option>
            <option value="11">MERV 11</option>
            <option value="13">MERV 13</option>
          </select>
        </div>
        
        <label>Capacitor Replaced</label>
        <div class="grid-2">
          <select id="capacitor-type">
            <option value="">Type...</option>
            <option value="dual-35/5">Dual 35/5¬µF</option>
            <option value="dual-40/5">Dual 40/5¬µF</option>
            <option value="dual-45/5">Dual 45/5¬µF</option>
            <option value="other">Other Rating</option>
          </select>
          <input type="number" id="capacitor-qty" placeholder="Qty" min="0" value="0">
        </div>
        
        <label>Contactor Replaced</label>
        <div class="grid-2">
          <select id="contactor-rating">
            <option value="">Rating...</option>
            <option value="30A-2P">30A Double Pole</option>
            <option value="40A-2P">40A Double Pole</option>
            <option value="other">Other Rating</option>
          </select>
          <input type="number" id="contactor-qty" placeholder="Qty" min="0" value="0">
        </div>
        
        <label>Other Parts Used</label>
        <textarea id="other-parts" rows="3" placeholder="List any other materials: fuses, relays, transformers, etc."></textarea>
      </div>
    </div>
    
    <div class="section" id="section-service-diagnostics">
      <button class="section-toggle" onclick="toggleSection('section-service-diagnostics')">
        <span>üìä Full Diagnostic Measurements</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <div class="status info">
          <span>‚ÑπÔ∏è</span>
          <span>Diagnostic Method: Power ‚Üí Airflow ‚Üí Electrical ‚Üí Refrigerant ‚Üí Controls</span>
        </div>
        
        <div class="card-subheader">General Readings</div>
        <div class="grid-2">
          <div><label>Outdoor Temp (¬∞F)</label><input type="number" id="outdoor-temp" step="0.1"></div>
          <div><label>Outdoor Humidity (%)</label><input type="number" id="outdoor-humidity" min="0" max="100"></div>
        </div>
        <div class="grid-2">
          <div><label>Return Air (¬∞F)</label><input type="number" id="return-temp" step="0.1" oninput="calcDelta()"></div>
          <div><label>Supply Air (¬∞F)</label><input type="number" id="supply-temp" step="0.1" oninput="calcDelta()"></div>
        </div>
        <div class="grid-2">
          <div><label>Return Static (in w.c.)</label><input type="number" id="return-static" step="0.01" oninput="calcStatic()"></div>
          <div><label>Supply Static (in w.c.)</label><input type="number" id="supply-static" step="0.01" oninput="calcStatic()"></div>
        </div>
        <div class="grid-2 mb-8">
          <div><label>Delta T (auto)</label><input type="text" id="delta-t" readonly></div>
          <div><label>Total Static (auto)</label><input type="text" id="total-static" readonly></div>
        </div>
        <div id="delta-status"></div>
        <div id="static-status"></div>
        
        <div class="card-subheader mt-16">Electrical Measurements</div>
        <div class="grid-2">
          <div><label>Voltage L1-L2</label><input type="number" id="voltage-line" step="0.1" oninput="validateVoltage()"></div>
          <div><label>Control Voltage (24V)</label><input type="number" id="control-voltage" step="0.1"></div>
        </div>
        <div id="voltage-status"></div>
        
        <div class="grid-2 mt-8">
          <div><label>Blower Amps</label><input type="text" id="blower-amps" placeholder="Actual/Rated"></div>
          <div class="cooling-only"><label>Compressor Amps</label><input type="text" id="comp-amps" placeholder="Actual/Rated"></div>
          <div class="heating-only"><label>Inducer Amps</label><input type="number" id="inducer-amps" step="0.1"></div>
        </div>
        
        <div class="cooling-only">
          <div class="card-subheader mt-16">Refrigerant Circuit</div>
          <div class="grid-2">
            <div><label>Suction P (psig)</label><input type="number" id="suction-pressure" step="0.1" oninput="calcRefrigerant()"></div>
            <div><label>Liquid P (psig)</label><input type="number" id="liquid-pressure" step="0.1" oninput="calcRefrigerant()"></div>
          </div>
          <div class="grid-2">
            <div><label>Suction T (¬∞F)</label><input type="number" id="suction-temp" step="0.1" oninput="calcRefrigerant()"></div>
            <div><label>Liquid T (¬∞F)</label><input type="number" id="liquid-temp" step="0.1" oninput="calcRefrigerant()"></div>
          </div>
          <div class="grid-2 mt-8">
              <div><label>Superheat (auto)</label><input type="text" id="superheat" readonly></div>
              <div><label>Subcool (auto)</label><input type="text" id="subcool" readonly></div>
          </div>
          <div id="superheat-status"></div>
          <div id="subcool-status"></div>
        </div>
        
        <div class="heating-only">
          <div class="card-subheader mt-16">Heating Circuit</div>
          <div class="grid-2">
            <div><label>Heat Exchanger</label>
              <select id="heat-exchanger">
                <option value="">Inspect...</option>
                <option value="clean">Clean - OK</option>
                <option value="sooted">Sooted</option>
                <option value="cracked">Cracked - DANGER</option>
              </select>
            </div>
            <div><label>Flame Appearance</label>
              <select id="flame-appearance">
                <option value="">Inspect...</option>
                <option value="blue">Blue - Normal</option>
                <option value="yellow">Yellow - Incomplete Combustion</option>
                <option value="lazy">Lazy/Rolling</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="section" id="section-service-component">
      <button class="section-toggle" onclick="toggleSection('section-service-component')">
        <span>üîç Component Inspection & Safety</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <div class="card-subheader">Safety Checklist</div>
        <div class="grid-2">
          <label class="check"><input type="checkbox" id="safety-disconnect"> Disconnect present & functional</label>
          <label class="check"><input type="checkbox" id="safety-clearances"> Clearances adequate</label>
          <label class="check"><input type="checkbox" id="safety-drain"> Drain trapped & flowing</label>
          <label class="check"><input type="checkbox" id="safety-floats"> Float switches tested</label>
        </div>
        <div class="heating-only grid-2">
          <label class="check"><input type="checkbox" id="safety-gas"> Gas piping OK</label>
          <label class="check"><input type="checkbox" id="safety-vent"> Vent termination secure</label>
          <label class="check"><input type="checkbox" id="safety-co"> No CO detected</label>
          <label class="check"><input type="checkbox" id="safety-flame-sensor"> Flame sensor clean</label>
        </div>
        
        <div class="card-subheader mt-16">Component Health</div>
        <label>Filter Condition</label>
        <div class="voice-wrapper">
          <input type="text" id="filter" placeholder="Size and condition (e.g., 16x25x1 - Light Dust)">
          <button class="voice-btn" data-voice="filter">üé§</button>
        </div>
        
        <div class="grid-2">
          <div>
            <label>Evaporator Coil</label>
            <select id="evap-coil">
              <option value="">Evap coil condition...</option>
              <option value="clean">Clean</option>
              <option value="light-dust">Light dust</option>
              <option value="restricted">Restricted - needs cleaning</option>
              <option value="frozen">Frozen</option>
              <option value="corroded">Corroded</option>
              <option value="leaking">Leaking</option>
            </select>
          </div>
          <div>
            <label>Condenser Coil</label>
            <select id="cond-coil">
              <option value="">Cond coil condition...</option>
              <option value="clean">Clean</option>
              <option value="light-debris">Light debris</option>
              <option value="restricted">Restricted - needs cleaning</option>
              <option value="bent-fins">Bent fins</option>
              <option value="corroded">Corroded</option>
            </select>
          </div>
        </div>
        
        <div class="grid-2">
          <div>
            <label>Capacitor (¬µF)</label>
            <div class="voice-wrapper">
              <input type="text" id="capacitor-reading" placeholder="Actual/Rated ¬µF">
              <button class="voice-btn" data-voice="capacitor-reading">üé§</button>
            </div>
          </div>
          <div>
            <label>Contactor</label>
            <select id="contactor-condition">
              <option value="">Contactor condition...</option>
              <option value="excellent">Good - clean contacts</option>
              <option value="light-pitting">Light pitting</option>
              <option value="heavy-pitting">Heavy pitting - recommend replacement</option>
              <option value="burned">Burned/welded</option>
            </select>
          </div>
        </div>
        
        <label>Blower Motor Condition</label>
        <select id="blower-condition">
          <option value="">Blower condition...</option>
          <option value="clean-quiet">Clean, runs quietly</option>
          <option value="dusty">Dusty but functional</option>
          <option value="noisy">Noisy - bearings worn</option>
          <option value="struggling">Struggling to start</option>
          <option value="failed">Failed/not running</option>
        </select>
      </div>
    </div>
  </div>
  
  <!-- INSTALL MODE: On-Site Sections -->
  <div class="install-only">
    
    <div class="card" id="card-install-checklist">
      <div class="card-header">
          <span>‚úÖ Installation Checklist</span>
      </div>
      <div class="status info">
        <span>‚ÑπÔ∏è</span>
        <span>Complete all items before startup</span>
      </div>
      <div class="grid-2">
        <label class="check"><input type="checkbox" id="install-pads"> Pads/Stands Level & Secure</label>
        <label class="check"><input type="checkbox" id="install-vacuum"> Line-set Evacuated (500 microns)</label>
        <label class="check"><input type="checkbox" id="install-nitrogen"> Nitrogen Purge During Brazing</label>
        <label class="check"><input type="checkbox" id="install-leak-test"> Leak Test Passed</label>
        <label class="check"><input type="checkbox" id="install-drain-primary"> Primary Drain Installed & Tested</label>
        <label class="check"><input type="checkbox" id="install-drain-aux"> Auxiliary Drain Installed</label>
        <label class="check"><input type="checkbox" id="install-electrical"> Electrical Connections Torqued</label>
        <label class="check"><input type="checkbox" id="install-disconnect"> Disconnect Box Installed</label>
        <label class="check"><input type="checkbox" id="install-tstat"> Thermostat Wired & Programmed</label>
        <label class="check"><input type="checkbox" id="install-filter"> Filter Installed</label>
        <label class="check"><input type="checkbox" id="install-plenum"> Plenum Sealed & Secured</label>
        <label class="check"><input type="checkbox" id="install-startup"> Startup Measurements Recorded</label>
      </div>
      
      <label class="mt-8">Final Superheat/Subcool at Startup</label>
      <div class="grid-2">
        <input type="text" id="startup-superheat" placeholder="Superheat (¬∞F)">
        <input type="text" id="startup-subcool" placeholder="Subcool (¬∞F)">
      </div>
      
      <label>Startup Notes</label>
      <div class="voice-wrapper">
        <textarea id="startup-notes" placeholder="Final pressures, voltages, AHRI match confirmation, etc." rows="3"></textarea>
        <button class="voice-btn" data-voice="startup-notes">üé§</button>
      </div>
    </div>
  </div>
  
  <!-- DUCTWORK MODE: On-Site Sections -->
  <div class="ductwork-only">
    
    <div class="section" id="section-materials-duct">
      <button class="section-toggle" onclick="toggleSection('section-materials-duct')">
        <span>üå¨Ô∏è Ductwork Materials Used</span>
        <span class="arrow">‚ñº</span>
      </button>
      <div class="section-content">
        <div class="card-subheader">Flex Duct</div>
        <div class="grid-3">
          <select id="flex-duct-size">
            <option value="">Diameter...</option>
            <option value="6">6"</option>
            <option value="8">8"</option>
            <option value="10">10"</option>
            <option value="12">12"</option>
          </select>
          <select id="flex-duct-r-value">
            <option value="">R-Value...</option>
            <option value="R-6">R-6</option>
            <option value="R-8">R-8</option>
          </select>
          <input type="number" id="flex-duct-length" placeholder="Length (ft)" min="0">
        </div>
        
        <div class="card-subheader mt-16">Sealing & Insulation</div>
        <div class="grid-2">
          <input type="number" id="mastic-gallons" placeholder="Mastic (gallons)" min="0" step="0.5">
          <input type="number" id="foil-tape-rolls" placeholder="Foil Tape (rolls)" min="0">
        </div>
        
        <label>Other Materials</label>
        <textarea id="other-duct-materials" rows="2" placeholder="Dampers, boots, collars, etc."></textarea>
      </div>
    </div>
    
    <div class="card" id="card-ductwork-audit">
      <div class="card-header">
        <span>üìê Ductwork & Air Audit</span>
      </div>
      <label>Duct Material</label>
      <select id="duct-material">
        <option value="">Select material...</option>
        <option value="flex-r6">Flex Duct (R-6)</option>
        <option value="flex-r8">Flex Duct (R-8)</option>
        <option value="fiberglass">Fiberglass Board</option>
        <option value="sheet-metal">Sheet Metal</option>
        <option value="mixed">Mixed Materials</option>
      </select>
      
      <label>Sealing Condition</label>
      <select id="duct-sealing">
        <option value="">Select condition...</option>
        <option value="excellent">Excellent - fully mastic sealed</option>
        <option value="good">Good - metallic tape used</option>
        <option value="fair">Fair - some visible gaps</option>
        <option value="poor">Poor - significant leakage</option>
      </select>
      
      <div class="grid-2">
        <div>
          <label>Number of Supply Vents</label>
          <input type="number" id="num-supply-vents" min="0">
        </div>
        <div>
          <label>Number of Return Grilles</label>
          <input type="number" id="num-return-grilles" min="0">
        </div>
      </div>
      
      <label>Ductwork Issues Found</label>
      <div class="grid-2">
        <label class="check"><input type="checkbox" id="duct-issue-leaks"> Air leaks detected</label>
        <label class="check"><input type="checkbox" id="duct-issue-crushed"> Crushed/kinked ducts</label>
        <label class="check"><input type="checkbox" id="duct-issue-disconnected"> Disconnected sections</label>
        <label class="check"><input type="checkbox" id="duct-issue-insulation"> Missing insulation</label>
      </div>
      
      <label>Airflow Audit Notes</label>
      <div class="voice-wrapper">
        <textarea id="airflow-audit-notes" rows="2" placeholder="Note static issues, room temps, register velocities"></textarea>
        <button class="voice-btn" data-voice="airflow-audit-notes">üé§</button>
      </div>
      
      <label>Ductwork Repair/Install Summary</label>
      <div class="voice-wrapper">
        <textarea id="duct-repair-summary" placeholder="Work performed and final status" rows="3"></textarea>
        <button class="voice-btn" data-voice="duct-repair-summary">üé§</button>
      </div>
    </div>
  </div>

  <!-- GLOBAL: Photo Documentation -->
  <div class="card">
    <div class="card-header">
      <span>üì∏ Photo Documentation</span>
    </div>
    
    <div class="status info">
      <span>üì∑</span>
      <span>Take photos: Nameplate, before/after, problem areas, final install</span>
    </div>

    <div class="grid-4">
      <button onclick="takePhoto('Nameplate')" class="secondary small">üì∑ Nameplate</button>
      <button onclick="takePhoto('Problem')" class="secondary small">üì∑ Problem</button>
      <button onclick="takePhoto('Before')" class="secondary small">üì∑ Before</button>
      <button onclick="takePhoto('After')" class="secondary small">üì∑ After</button>
      <button onclick="takePhoto('Electrical')" class="secondary small">üì∑ Electrical</button>
      <button onclick="takePhoto('Coils')" class="secondary small">üì∑ Coils</button>
      <button onclick="takePhoto('Drain')" class="secondary small">üì∑ Drain</button>
      <button onclick="takePhoto('Ductwork')" class="secondary small">üì∑ Ductwork</button>
    </div>
    <div class="photo-grid" id="photo-preview"></div>
  </div>

  <!-- GLOBAL: Final Review -->
  <div class="card" id="card-final-review">
    <div class="card-header">
      <span>üìù Final Review & Sign-Off</span>
    </div>
    
    <div class="service-only">
        <label>Primary Findings Summary</label>
        <div class="voice-wrapper">
            <textarea id="findings" placeholder="What's wrong and why - be specific" rows="3"></textarea>
            <button class="voice-btn" data-voice="findings">üé§</button>
        </div>
        
        <label>Repair Recommendations</label>
        <div class="voice-wrapper">
            <textarea id="recommendations" placeholder="Repair options and next steps" rows="3"></textarea>
            <button class="voice-btn" data-voice="recommendations">üé§</button>
        </div>

        <label>Work Performed Today</label>
        <div class="voice-wrapper">
            <textarea id="work-performed" placeholder="What was done during this service call" rows="2"></textarea>
            <button class="voice-btn" data-voice="work-performed">üé§</button>
        </div>
    </div>

    <div class="install-only">
        <label>Final System Status</label>
        <div class="voice-wrapper">
            <textarea id="install-final-status" placeholder="Confirm all checks passed, system operational" rows="3"></textarea>
            <button class="voice-btn" data-voice="install-final-status">üé§</button>
        </div>
    </div>
    
    <div class="ductwork-only">
        <label>Work Completion Summary</label>
        <div class="voice-wrapper">
            <textarea id="duct-completion" placeholder="Final ductwork status and improvements" rows="3"></textarea>
            <button class="voice-btn" data-voice="duct-completion">üé§</button>
        </div>
    </div>

    <div class="mt-16">
        <label for="tech-name">Technician Name</label>
        <input type="text" id="tech-name" placeholder="Your name">
    </div>

    <div class="grid-2">
      <div>
        <label for="tech-signature-date">Tech Signature Date</label>
        <input type="date" id="tech-signature-date">
      </div>
      <div>
        <label for="customer-signature">Customer Signature</label>
        <input type="text" id="customer-signature" placeholder="Customer name">
      </div>
    </div>
  </div>

  <!-- GLOBAL: Sticky Action Bar -->
  <div class="actions">
    <button class="success" onclick="generate()" id="generate-btn">
      <span>‚úì</span> Generate
    </button>
    <button class="warning" onclick="exportReport()">
      <span>üóé</span> Export
    </button>
    <button class="danger" onclick="clearForm()">
      <span>‚úï</span> Clear All
    </button>
  </div>
  
  <!-- GLOBAL: Modal & Toast -->
  <div class="modal-overlay" id="modal-container">
    <div class="modal-content">
      <div class="modal-title" id="modal-title">Confirmation</div>
      <div class="modal-body" id="modal-body">Are you sure?</div>
      <div class="modal-actions">
        <button class="secondary" id="modal-cancel">Cancel</button>
        <button class="danger" id="modal-confirm">Confirm</button>
      </div>
    </div>
  </div>
  
  <div class="toast-notification" id="toast-notification">
    Message here
  </div>

  <script>
    // ==================== GLOBAL STATE ====================
    const $ = (id) => document.getElementById(id);
    const num = val => { const n = parseFloat(val); return isNaN(n) ? null : n; };
    
    let currentMode = 'service';
    let heatCoolMode = 'cooling';
    let photos = [];
    
    // Dynamic list arrays
    let collars = [];
    let flexDucts = [];
    let registers = [];
    
    // Enhanced R-410A PT chart
    const R410A_PT = {
      90: 44.7, 95: 47.1, 100: 49.6, 105: 52.2, 110: 54.9, 115: 57.7,
      120: 60.6, 125: 63.6, 130: 66.7, 135: 69.9, 140: 73.
