```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Pro Field - Technician App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .header .subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            border-color: var(--primary);
            background: var(--gray-50);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--gray-100);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .input-group {
            display: flex;
            gap: 0.5rem;
        }

        .input-addon {
            padding: 0.75rem;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-secondary {
            background: var(--gray-600);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--gray-700);
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-block {
            width: 100%;
        }

        .btn-group {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .checkbox-item input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            margin-top: 0.125rem;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 0.9375rem;
        }

        .job-card {
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .job-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .job-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .job-type-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-maintenance {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-repair {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-install {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-diagnostic {
            background: #fef3c7;
            color: #92400e;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
        }

        .readings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .reading-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .reading-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .reading-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 2px solid var(--gray-200);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-upload {
            aspect-ratio: 1;
            border: 2px dashed var(--gray-300);
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-upload:hover {
            border-color: var(--primary);
            background: var(--gray-50);
        }

        .signature-pad {
            border: 2px solid var(--gray-300);
            border-radius: 0.5rem;
            cursor: crosshair;
            background: white;
        }

        .hidden {
            display: none;
        }

        .section-divider {
            border: none;
            border-top: 2px solid var(--gray-200);
            margin: 2rem 0;
        }

        .calculation-result {
            background: var(--primary);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            margin-top: 0.5rem;
        }

        .calculation-result .label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .calculation-result .value {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }

        .parts-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .parts-table th,
        .parts-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .parts-table th {
            background: var(--gray-50);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .parts-table tr:last-child td {
            border-bottom: none;
        }

        .time-tracker {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .time-display {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.75rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .readings-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-wrap: nowrap;
            }
        }

        @media print {
            .header,
            .nav-tabs,
            .btn,
            .photo-upload {
                display: none;
            }

            .card {
                break-inside: avoid;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 0.75rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-600);
        }

        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: var(--gray-200);
            border-radius: 0.25rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }

        .equipment-specs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .equipment-specs dt {
            font-weight: 600;
            color: var(--gray-700);
        }

        .equipment-specs dd {
            color: var(--gray-600);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HVAC Pro Field</h1>
            <div class="subtitle">Technician: <span id="techName">John Smith</span> | <span id="currentDate"></span></div>
        </div>

        <div class="nav-tabs" id="navTabs"></div>

        <div id="viewContainer"></div>
    </div>

    <div class="modal" id="signatureModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeSignatureModal()">&times;</span>
            <div class="modal-header">Customer Signature</div>
            <canvas id="signaturePad" class="signature-pad" width="500" height="200"></canvas>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="clearSignature()">Clear</button>
                <button class="btn btn-primary" onclick="saveSignature()">Save Signature</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== DATA STRUCTURES ====================
        
        const EQUIPMENT_BRANDS = [
            'Carrier', 'Trane', 'Lennox', 'Rheem', 'Goodman', 'American Standard',
            'York', 'Bryant', 'Daikin', 'Mitsubishi', 'Fujitsu', 'Bosch', 'Amana',
            'Ruud', 'Coleman', 'Tempstar', 'Heil', 'Comfortmaker', 'Payne', 'Armstrong'
        ];

        const REFRIGERANT_TYPES = [
            'R-410A', 'R-22', 'R-32', 'R-407C', 'R-134a', 'R-404A'
        ];

        const FILTER_SIZES = [
            '16x20x1', '16x25x1', '20x20x1', '20x25x1', '16x20x4', '16x25x4',
            '20x20x4', '20x25x4', '14x25x1', '12x24x1', '14x20x1', '18x24x1'
        ];

        const SYSTEM_TYPES = [
            'Split System', 'Package Unit', 'Heat Pump', 'Mini-Split', 'Geothermal'
        ];

        const COMMON_PARTS = [
            { name: 'Capacitor - Run', price: 35 },
            { name: 'Capacitor - Start', price: 25 },
            { name: 'Contactor - 1 Pole', price: 45 },
            { name: 'Contactor - 2 Pole', price: 55 },
            { name: 'Contactor - 3 Pole', price: 65 },
            { name: 'Thermostat - Basic', price: 75 },
            { name: 'Thermostat - Programmable', price: 150 },
            { name: 'Thermostat - Smart', price: 250 },
            { name: 'Filter - 1 inch', price: 20 },
            { name: 'Filter - 4 inch', price: 45 },
            { name: 'Disconnect - 60A', price: 35 },
            { name: 'Blower Motor', price: 350 },
            { name: 'Condenser Fan Motor', price: 275 },
            { name: 'Reversing Valve', price: 185 },
            { name: 'TXV Valve', price: 125 },
            { name: 'Refrigerant - per lb', price: 75 },
            { name: 'Condensate Pump', price: 150 },
            { name: 'Float Switch', price: 45 }
        ];

        const MAINTENANCE_CHECKLIST = {
            indoor: [
                { id: 'filterCondition', label: 'Filter Condition', type: 'select', options: ['Clean', 'Dirty - Replaced', 'Dirty - Customer Declined', 'Missing', 'Wrong Size'] },
                { id: 'filterSize', label: 'Filter Size', type: 'select', options: FILTER_SIZES },
                { id: 'evapCoil', label: 'Evaporator Coil Condition', type: 'select', options: ['Clean', 'Light Dust', 'Dirty - Cleaned', 'Restricted - Recommend Pro Clean', 'Leaking - Recommend Replacement'] },
                { id: 'blowerMotor', label: 'Blower Motor Condition', type: 'select', options: ['Normal Operation', 'Noisy - Lubricated', 'Noisy - Monitor', 'Failing - Recommend Replacement'] },
                { id: 'blowerAmps', label: 'Blower Motor Amps', type: 'number', unit: 'A' },
                { id: 'blowerRating', label: 'Blower FLA Rating', type: 'number', unit: 'A' },
                { id: 'condensateDrain', label: 'Condensate Drain', type: 'select', options: ['Clear', 'Slow - Cleared', 'Blocked - Cleared', 'Algae Tab Added', 'Float Switch Tested'] },
                { id: 'drainPan', label: 'Drain Pan Condition', type: 'select', options: ['Clean', 'Cleaned', 'Rust - Monitor', 'Recommend Replacement'] },
                { id: 'supplyTemp', label: 'Supply Air Temperature', type: 'number', unit: '°F' },
                { id: 'returnTemp', label: 'Return Air Temperature', type: 'number', unit: '°F' },
                { id: 'supplyHumidity', label: 'Supply Air Humidity', type: 'number', unit: '%' },
                { id: 'returnHumidity', label: 'Return Air Humidity', type: 'number', unit: '%' },
                { id: 'ductwork', label: 'Ductwork Inspection', type: 'select', options: ['Sealed', 'Minor Leaks - Sealed', 'Major Leaks - Recommend Professional Sealing', 'Disconnected - Reconnected'] },
                { id: 'insulation', label: 'Insulation Condition', type: 'select', options: ['Good', 'Deteriorated - Monitor', 'Missing - Recommend Replacement', 'Wet - Recommend Replacement'] }
            ],
            outdoor: [
                { id: 'condenserCoil', label: 'Condenser Coil Condition', type: 'select', options: ['Clean', 'Light Debris - Cleaned', 'Heavy Debris - Cleaned', 'Bent Fins - Straightened', 'Leaking - Recommend Replacement'] },
                { id: 'compressorSound', label: 'Compressor Sound', type: 'select', options: ['Normal', 'Slightly Noisy', 'Loud - Monitor', 'Grinding - Recommend Replacement'] },
                { id: 'compressorAmps', label: 'Compressor RLA', type: 'number', unit: 'A' },
                { id: 'compressorRating', label: 'Compressor RLA Rating', type: 'number', unit: 'A' },
                { id: 'compressorLRA', label: 'Compressor LRA', type: 'number', unit: 'A' },
                { id: 'fanMotorAmps', label: 'Fan Motor Amps', type: 'number', unit: 'A' },
                { id: 'fanMotorRating', label: 'Fan Motor FLA Rating', type: 'number', unit: 'A' },
                { id: 'suctionPressure', label: 'Suction Pressure', type: 'number', unit: 'PSI' },
                { id: 'suctionTemp', label: 'Suction Line Temperature', type: 'number', unit: '°F' },
                { id: 'dischargePressure', label: 'Discharge Pressure', type: 'number', unit: 'PSI' },
                { id: 'liquidTemp', label: 'Liquid Line Temperature', type: 'number', unit: '°F' },
                { id: 'outdoorAmbient', label: 'Outdoor Ambient Temperature', type: 'number', unit: '°F' },
                { id: 'refrigerantType', label: 'Refrigerant Type', type: 'select', options: REFRIGERANT_TYPES },
                { id: 'subcooling', label: 'Subcooling', type: 'calculated', calc: 'subcool' },
                { id: 'superheat', label: 'Superheat', type: 'calculated', calc: 'superheat' },
                { id: 'approach', label: 'Approach Temperature', type: 'calculated', calc: 'approach' },
                { id: 'runCapacitor', label: 'Run Capacitor', type: 'select', options: ['Good - Tested', 'Weak - Replaced', 'Failed - Replaced', 'Not Tested'] },
                { id: 'runCapacitorRating', label: 'Run Capacitor Rating', type: 'text', placeholder: 'e.g., 45+5 MFD' },
                { id: 'startCapacitor', label: 'Start Capacitor', type: 'select', options: ['Good - Tested', 'Weak - Replaced', 'Failed - Replaced', 'Not Present', 'Not Tested'] },
                { id: 'contactor', label: 'Contactor Condition', type: 'select', options: ['Good', 'Pitted - Monitor', 'Burned - Replaced', 'Welded - Replaced'] },
                { id: 'contactorRating', label: 'Contactor Rating', type: 'text', placeholder: 'e.g., 40A 2-Pole' }
            ],
            electrical: [
                { id: 'voltageL1L2', label: 'Voltage L1-L2', type: 'number', unit: 'V' },
                { id: 'voltageL1N', label: 'Voltage L1-Neutral', type: 'number', unit: 'V' },
                { id: 'voltageL2N', label: 'Voltage L2-Neutral', type: 'number', unit: 'V' },
                { id: 'connections', label: 'Wire Connections', type: 'select', options: ['Tight', 'Tightened', 'Loose - Corrected', 'Corrosion - Cleaned', 'Burned - Replaced'] },
                { id: 'wireCondition', label: 'Wire Insulation', type: 'select', options: ['Good', 'Worn - Monitor', 'Damaged - Replaced', 'Undersized - Recommend Upgrade'] },
                { id: 'groundWire', label: 'Ground Wire', type: 'select', options: ['Present and Secure', 'Loose - Secured', 'Missing - Installed', 'Corroded - Cleaned'] },
                { id: 'disconnect', label: 'Disconnect Box', type: 'select', options: ['Good', 'Fuses Good', 'Fuses Replaced', 'Corroded - Cleaned', 'Recommend Replacement'] }
            ],
            safety: [
                { id: 'lowPressureSwitch', label: 'Low Pressure Switch', type: 'select', options: ['Tested - Good', 'Not Tested', 'Tripped - Reset', 'Faulty - Replaced'] },
                { id: 'highPressureSwitch', label: 'High Pressure Switch', type: 'select', options: ['Tested - Good', 'Not Tested', 'Tripped - Reset', 'Faulty - Replaced'] },
                { id: 'freezeStat', label: 'Freeze Stat', type: 'select', options: ['Tested - Good', 'Not Present', 'Tripped - Reset', 'Faulty - Replaced'] },
                { id: 'rolloutSwitch', label: 'Rollout Switch (Heat)', type: 'select', options: ['Tested - Good', 'Not Present', 'Tripped - Reset', 'Faulty - Replaced'] },
                { id: 'flameRod', label: 'Flame Rod (Heat)', type: 'select', options: ['Clean', 'Cleaned', 'Not Present', 'Faulty - Replaced'] },
                { id: 'heatExchanger', label: 'Heat Exchanger (if applicable)', type: 'select', options: ['Inspected - Good', 'Not Present', 'Rust Spots - Monitor', 'Cracks Found - Recommend Replacement'] },
                { id: 'gasConnections', label: 'Gas Connections (if applicable)', type: 'select', options: ['Leak Test - Passed', 'Not Present', 'Leak Detected - Fixed', 'Leak Detected - Shut Down'] },
                { id: 'coDetector', label: 'CO Levels', type: 'number', unit: 'PPM' },
                { id: 'thermostat', label: 'Thermostat Operation', type: 'select', options: ['Normal', 'Calibrated', 'Batteries Replaced', 'Recommend Upgrade', 'Faulty - Replaced'] }
            ]
        };

        const RECOMMENDATIONS = [
            { id: 'filter', text: 'Replace air filter monthly (customer supply)', category: 'maintenance' },
            { id: 'filterUpgrade', text: 'Upgrade to high-efficiency filter system', category: 'upgrade', price: 350 },
            { id: 'ductCleaning', text: 'Schedule professional duct cleaning', category: 'service', price: 450 },
            { id: 'ductSealing', text: 'Seal ductwork to improve efficiency', category: 'service', price: 650 },
            { id: 'coilCleaning', text: 'Deep evaporator coil cleaning', category: 'service', price: 275 },
            { id: 'thermostatUpgrade', text: 'Upgrade to smart thermostat', category: 'upgrade', price: 350 },
            { id: 'capacitor', text: 'Replace capacitor preventatively', category: 'repair', price: 185 },
            { id: 'uvLight', text: 'Install UV light for IAQ improvement', category: 'upgrade', price: 550 },
            { id: 'humidifier', text: 'Install whole-home humidifier', category: 'upgrade', price: 850 },
            { id: 'dehumidifier', text: 'Install whole-home dehumidifier', category: 'upgrade', price: 1850 },
            { id: 'zoning', text: 'Install zone control system', category: 'upgrade', price: 2500 },
            { id: 'replacement', text: 'System nearing end of life - recommend replacement', category: 'replacement' },
            { id: 'coilProtection', text: 'Apply coil protection coating', category: 'service', price: 325 },
            { id: 'maintenancePlan', text: 'Enroll in annual maintenance plan', category: 'service', price: 250 }
        ];

        // ==================== STATE MANAGEMENT ====================
        
        let appState = {
            currentView: 'dashboard',
            currentJob: null,
            jobs: [
                { 
                    id: 'JOB-2024-1547', 
                    type: 'maintenance', 
                    customer: 'Johnson Residence',
                    address: '425 Oak Street',
                    phone: '(555) 123-4567',
                    scheduledTime: '2:00 PM',
                    equipment: { indoor: {}, outdoor: {} }
                },
                { 
                    id: 'JOB-2024-1548', 
                    type: 'repair', 
                    customer: 'Smith Commercial',
                    address: '1200 Industrial Blvd',
                    phone: '(555) 987-6543',
                    scheduledTime: '4:00 PM',
                    equipment: { indoor: {}, outdoor: {} }
                },
                { 
                    id: 'JOB-2024-1549', 
                    type: 'diagnostic', 
                    customer: 'Williams Home',
                    address: '88 Maple Drive',
                    phone: '(555) 456-7890',
                    scheduledTime: '6:00 PM',
                    equipment: { indoor: {}, outdoor: {} }
                }
            ],
            inspectionData: {
                indoor: {},
                outdoor: {},
                electrical: {},
                safety: {}
            },
            photos: [],
            parts: [],
            recommendations: [],
            startTime: null,
            endTime: null,
            signature: null,
            techNotes: '',
            customerNotes: ''
        };

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('hvacAppState');
            if (saved) {
                appState = { ...appState, ...JSON.parse(saved) };
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('hvacAppState', JSON.stringify(appState));
        }

        // ==================== CALCULATIONS ====================
        
        function calculateSubcooling() {
            const dischargePressure = parseFloat(appState.inspectionData.outdoor.dischargePressure);
            const liquidTemp = parseFloat(appState.inspectionData.outdoor.liquidTemp);
            const refrigerantType = appState.inspectionData.outdoor.refrigerantType;
            
            if (!dischargePressure || !liquidTemp || !refrigerantType) return null;
            
            // Simplified saturation temperature lookup (in production, use full PT chart)
            const satTempMap = {
                'R-410A': { 100: 75, 150: 92, 200: 107, 250: 120, 300: 132, 350: 143, 400: 153 },
                'R-22': { 100: 72, 150: 91, 200: 108, 250: 123, 300: 137, 350: 150, 400: 162 }
            };
            
            const ptData = satTempMap[refrigerantType] || satTempMap['R-410A'];
            const pressures = Object.keys(ptData).map(Number).sort((a, b) => a - b);
            
            let satTemp = null;
            for (let i = 0; i < pressures.length - 1; i++) {
                if (dischargePressure >= pressures[i] && dischargePressure <= pressures[i + 1]) {
                    const ratio = (dischargePressure - pressures[i]) / (pressures[i + 1] - pressures[i]);
                    satTemp = ptData[pressures[i]] + ratio * (ptData[pressures[i + 1]] - ptData[pressures[i]]);
                    break;
                }
            }
            
            if (!satTemp) {
                if (dischargePressure < pressures[0]) satTemp = ptData[pressures[0]];
                if (dischargePressure > pressures[pressures.length - 1]) satTemp = ptData[pressures[pressures.length - 1]];
            }
            
            return satTemp ? (satTemp - liquidTemp).toFixed(1) : null;
        }

        function calculateSuperheat() {
            const suctionPressure = parseFloat(appState.inspectionData.outdoor.suctionPressure);
            const suctionTemp = parseFloat(appState.inspectionData.outdoor.suctionTemp);
            const refrigerantType = appState.inspectionData.outdoor.refrigerantType;
            
            if (!suctionPressure || !suctionTemp || !refrigerantType) return null;
            
            // Simplified saturation temperature lookup
            const satTempMap = {
                'R-410A': { 40: 10, 60: 25, 80: 37, 100: 48, 120: 57, 140: 66, 160: 74 },
                'R-22': { 40: 16, 60: 30, 80: 41, 100: 51, 120: 60, 140: 68, 160: 76 }
            };
            
            const ptData = satTempMap[refrigerantType] || satTempMap['R-410A'];
            const pressures = Object.keys(ptData).map(Number).sort((a, b) => a - b);
            
            let satTemp = null;
            for (let i = 0; i < pressures.length - 1; i++) {
                if (suctionPressure >= pressures[i] && suctionPressure <= pressures[i + 1]) {
                    const ratio = (suctionPressure - pressures[i]) / (pressures[i + 1] - pressures[i]);
                    satTemp = ptData[pressures[i]] + ratio * (ptData[pressures[i + 1]] - ptData[pressures[i]]);
                    break;
                }
            }
            
            if (!satTemp) {
                if (suctionPressure < pressures[0]) satTemp = ptData[pressures[0]];
                if (suctionPressure > pressures[pressures.length - 1]) satTemp = ptData[pressures[pressures.length - 1]];
            }
            
            return satTemp ? (suctionTemp - satTemp).toFixed(1) : null;
        }

        function calculateApproach() {
            const liquidTemp = parseFloat(appState.inspectionData.outdoor.liquidTemp);
            const outdoorAmbient = parseFloat(appState.inspectionData.outdoor.outdoorAmbient);
            
            if (!liquidTemp || !outdoorAmbient) return null;
            
            return (liquidTemp - outdoorAmbient).toFixed(1);
        }

        function calculateDeltaT() {
            const returnTemp = parseFloat(appState.inspectionData.indoor.returnTemp);
            const supplyTemp = parseFloat(appState.inspectionData.indoor.supplyTemp);
            
            if (!returnTemp || !supplyTemp) return null;
            
            return (returnTemp - supplyTemp).toFixed(1);
        }

        // ==================== VIEW RENDERING ====================
        
        function render() {
            updateDate();
            renderNavigation();
            renderView();
            saveState();
        }

        function updateDate() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function renderNavigation() {
            const navTabs = document.getElementById('navTabs');
            
            if (!appState.currentJob) {
                navTabs.innerHTML = '';
                return;
            }
            
            const tabs = [
                { id: 'customer', label: 'Customer' },
                { id: 'equipment', label: 'Equipment' },
                { id: 'inspection', label: 'Inspection' },
                { id: 'photos', label: 'Photos' },
                { id: 'parts', label: 'Parts' },
                { id: 'recommendations', label: 'Recommendations' },
                { id: 'summary', label: 'Summary' }
            ];
            
            navTabs.innerHTML = tabs.map(tab => `
                <button class="nav-tab ${appState.currentView === tab.id ? 'active' : ''}" 
                        onclick="navigateTo('${tab.id}')">
                    ${tab.label}
                </button>
            `).join('');
        }

        function navigateTo(view) {
            appState.currentView = view;
            render();
        }

        function renderView() {
            const container = document.getElementById('viewContainer');
            
            switch (appState.currentView) {
                case 'dashboard':
                    container.innerHTML = renderDashboard();
                    break;
                case 'customer':
                    container.innerHTML = renderCustomerInfo();
                    break;
                case 'equipment':
                    container.innerHTML = renderEquipmentInfo();
                    break;
                case 'inspection':
                    container.innerHTML = renderInspection();
                    attachInspectionListeners();
                    break;
                case 'photos':
                    container.innerHTML = renderPhotos();
                    attachPhotoListeners();
                    break;
                case 'parts':
                    container.innerHTML = renderParts();
                    break;
                case 'recommendations':
                    container.innerHTML = renderRecommendations();
                    break;
                case 'summary':
                    container.innerHTML = renderSummary();
                    break;
            }
        }

        function renderDashboard() {
            const completedToday = 1;
            const totalToday = appState.jobs.length;
            
            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${totalToday}</div>
                        <div class="stat-label">Jobs Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${completedToday}</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalToday - completedToday}</div>
                        <div class="stat-label">Remaining</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">Job Queue</div>
                    ${appState.jobs.map(job => `
                        <div class="job-card" onclick="startJob('${job.id}')">
                            <div class="job-card-header">
                                <div>
                                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.25rem;">
                                        ${job.customer}
                                    </h3>
                                    <p style="font-size: 0.875rem; color: var(--gray-600);">${job.address}</p>
                                    <p style="font-size: 0.875rem; color: var(--gray-600);">${job.phone}</p>
                                </div>
                                <div style="text-align: right;">
                                    <div class="job-type-badge badge-${job.type}">
                                        ${job.type}
                                    </div>
                                    <p style="font-size: 1rem; font-weight: 600; margin-top: 0.5rem;">
                                        ${job.scheduledTime}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderCustomerInfo() {
            const job = appState.currentJob;
            
            return `
                <div class="card">
                    <div class="card-header">Customer Information</div>
                    
                    <div class="time-tracker">
                        <div>
                            <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 0.25rem;">Job Time</div>
                            <div class="time-display" id="jobTimer">00:00:00</div>
                        </div>
                        <button class="btn btn-primary" onclick="toggleTimer()">
                            ${appState.startTime && !appState.endTime ? 'Stop Timer' : 'Start Timer'}
                        </button>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Job ID</label>
                            <input type="text" class="form-input" value="${job.id}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Job Type</label>
                            <input type="text" class="form-input" value="${job.type}" readonly style="text-transform: capitalize;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Customer Name</label>
                            <input type="text" class="form-input" value="${job.customer}" onchange="updateJob('customer', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-input" value="${job.phone}" onchange="updateJob('phone', this.value)">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Service Address</label>
                        <input type="text" class="form-input" value="${job.address}" onchange="updateJob('address', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Customer Concerns / Reason for Service</label>
                        <textarea class="form-textarea" onchange="updateCustomerNotes(this.value)">${appState.customerNotes}</textarea>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="navigateTo('equipment')">Continue to Equipment Info</button>
                    </div>
                </div>
            `;
        }

        function renderEquipmentInfo() {
            const job = appState.currentJob;
            
            return `
                <div class="card">
                    <div class="card-header">Indoor Unit</div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Brand</label>
                            <select class="form-select" onchange="updateEquipment('indoor', 'brand', this.value)">
                                <option value="">Select Brand...</option>
                                ${EQUIPMENT_BRANDS.map(brand => `
                                    <option value="${brand}" ${job.equipment.indoor.brand === brand ? 'selected' : ''}>
                                        ${brand}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">System Type</label>
                            <select class="form-select" onchange="updateEquipment('indoor', 'systemType', this.value)">
                                <option value="">Select Type...</option>
                                ${SYSTEM_TYPES.map(type => `
                                    <option value="${type}" ${job.equipment.indoor.systemType === type ? 'selected' : ''}>
                                        ${type}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Model Number</label>
                            <input type="text" class="form-input" value="${job.equipment.indoor.model || ''}" 
                                   onchange="updateEquipment('indoor', 'model', this.value)" placeholder="Enter model number...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Serial Number</label>
                            <input type="text" class="form-input" value="${job.equipment.indoor.serial || ''}" 
                                   onchange="updateEquipment('indoor', 'serial', this.value)" placeholder="Enter serial number...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tonnage</label>
                            <select class="form-select" onchange="updateEquipment('indoor', 'tonnage', this.value)">
                                <option value="">Select Tonnage...</option>
                                ${[1.5, 2, 2.5, 3, 3.5, 4, 5].map(ton => `
                                    <option value="${ton}" ${job.equipment.indoor.tonnage == ton ? 'selected' : ''}>
                                        ${ton} Ton
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Installation Year</label>
                            <input type="number" class="form-input" value="${job.equipment.indoor.year || ''}" 
                                   onchange="updateEquipment('indoor', 'year', this.value)" 
                                   placeholder="YYYY" min="1990" max="2024">
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">Outdoor Unit</div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Brand</label>
                            <select class="form-select" onchange="updateEquipment('outdoor', 'brand', this.value)">
                                <option value="">Select Brand...</option>
                                ${EQUIPMENT_BRANDS.map(brand => `
                                    <option value="${brand}" ${job.equipment.outdoor.brand === brand ? 'selected' : ''}>
                                        ${brand}
                                    </option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Model Number</label>
                            <input type="text" class="form-input" value="${job.equipment.outdoor.model || ''}" 
                                   onchange="updateEquipment('outdoor', 'model', this.value)" placeholder="Enter model number...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Serial Number</label>
                            <input type="text" class="form-input" value="${job.equipment.outdoor.serial || ''}" 
                                   onchange="updateEquipment('outdoor', 'serial', this.value)" placeholder="Enter serial number...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Installation Year</label>
                            <input type="number" class="form-input" value="${job.equipment.outdoor.year || ''}" 
                                   onchange="updateEquipment('outdoor', 'year', this.value)" 
                                   placeholder="YYYY" min="1990" max="2024">
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateTo('customer')">Back</button>
                    <button class="btn btn-primary" onclick="navigateTo('inspection')">Begin Inspection</button>
                </div>
            `;
        }

        function renderInspection() {
            return `
                <div class="alert alert-info">
                    Complete all sections of the multi-point inspection. Required measurements will auto-calculate subcooling, superheat, and other critical values.
                </div>
                
                ${renderInspectionSection('Indoor Unit', MAINTENANCE_CHECKLIST.indoor, 'indoor')}
                ${renderInspectionSection('Outdoor Unit', MAINTENANCE_CHECKLIST.outdoor, 'outdoor')}
                ${renderInspectionSection('Electrical', MAINTENANCE_CHECKLIST.electrical, 'electrical')}
                ${renderInspectionSection('Safety Checks', MAINTENANCE_CHECKLIST.safety, 'safety')}
                
                <div class="card">
                    <div class="card-header">Technician Notes</div>
                    <textarea class="form-textarea" id="techNotes" 
                              placeholder="Additional observations, diagnostics, work performed...">${appState.techNotes}</textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateTo('equipment')">Back</button>
                    <button class="btn btn-primary" onclick="navigateTo('photos')">Continue to Photos</button>
                </div>
            `;
        }

        function renderInspectionSection(title, items, section) {
            return `
                <div class="card">
                    <div class="card-header">${title}</div>
                    <div class="form-grid">
                        ${items.map(item => {
                            if (item.type === 'calculated') {
                                let value = null;
                                if (item.calc === 'subcool') value = calculateSubcooling();
                                if (item.calc === 'superheat') value = calculateSuperheat();
                                if (item.calc === 'approach') value = calculateApproach();
                                
                                return `
                                    <div class="form-group" style="grid-column: span 2;">
                                        <label class="form-label">${item.label}</label>
                                        <div class="calculation-result">
                                            <div class="label">${item.label}</div>
                                            <div class="value">${value ? value + '°F' : 'N/A'}</div>
                                        </div>
                                    </div>
                                `;
                            }
                            
                            const value = appState.inspectionData[section][item.id] || '';
                            
                            if (item.type === 'select') {
                                return `
                                    <div class="form-group">
                                        <label class="form-label">${item.label}</label>
                                        <select class="form-select inspection-field" 
                                                data-section="${section}" 
                                                data-id="${item.id}">
                                            <option value="">Select...</option>
                                            ${item.options.map(opt => `
                                                <option value="${opt}" ${value === opt ? 'selected' : ''}>${opt}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                `;
                            } else if (item.type === 'number') {
                                return `
                                    <div class="form-group">
                                        <label class="form-label">${item.label}</label>
                                        <div class="input-group">
                                            <input type="number" 
                                                   step="0.1" 
                                                   class="form-input inspection-field" 
                                                   data-section="${section}" 
                                                   data-id="${item.id}"
                                                   value="${value}"
                                                   placeholder="0.0">
                                            ${item.unit ? `<div class="input-addon">${item.unit}</div>` : ''}
                                        </div>
                                    </div>
                                `;
                            } else {
                                return `
                                    <div class="form-group">
                                        <label class="form-label">${item.label}</label>
                                        <input type="text" 
                                               class="form-input inspection-field" 
                                               data-section="${section}" 
                                               data-id="${item.id}"
                                               value="${value}"
                                               placeholder="${item.placeholder || ''}">
                                    </div>
                                `;
                            }
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function attachInspectionListeners() {
            document.querySelectorAll('.inspection-field').forEach(field => {
                field.addEventListener('change', (e) => {
                    const section = e.target.dataset.section;
                    const id = e.target.dataset.id;
                    appState.inspectionData[section][id] = e.target.value;
                    render();
                });
            });
            
            const techNotes = document.getElementById('techNotes');
            if (techNotes) {
                techNotes.addEventListener('change', (e) => {
                    appState.techNotes = e.target.value;
                    saveState();
                });
            }
        }

        function renderPhotos() {
            return `
                <div class="card">
                    <div class="card-header">Job Photos</div>
                    
                    <div class="alert alert-info">
                        Capture photos of equipment, issues found, work performed, and any recommendations.
                    </div>
                    
                    <div class="photo-grid">
                        <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                <circle cx="12" cy="13" r="4"></circle>
                            </svg>
                            <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">Add Photo</div>
                        </div>
                        ${appState.photos.map((photo, index) => `
                            <div class="photo-item">
                                <img src="${photo}" alt="Job photo ${index + 1}">
                                <button class="delete-btn" onclick="deletePhoto(${index})">×</button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <input type="file" 
                           id="photoInput" 
                           accept="image/*" 
                           capture="environment"
                           style="display: none;"
                           multiple>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateTo('inspection')">Back</button>
                    <button class="btn btn-primary" onclick="navigateTo('parts')">Continue to Parts</button>
                </div>
            `;
        }

        function attachPhotoListeners() {
            const photoInput = document.getElementById('photoInput');
            if (photoInput) {
                photoInput.addEventListener('change', handlePhotoUpload);
            }
        }

        function handlePhotoUpload(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    appState.photos.push(event.target.result);
                    render();
                };
                reader.readAsDataURL(file);
            });
        }

        function deletePhoto(index) {
            if (confirm('Delete this photo?')) {
                appState.photos.splice(index, 1);
                render();
            }
        }

        function renderParts() {
            const total = appState.parts.reduce((sum, part) => sum + (part.quantity * part.price), 0);
            
            return `
                <div class="card">
                    <div class="card-header">Parts Used</div>
                    
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: span 2;">
                            <label class="form-label">Select Part</label>
                            <select class="form-select" id="partSelect">
                                <option value="">Choose a part...</option>
                                ${COMMON_PARTS.map((part, idx) => `
                                    <option value="${idx}">${part.name} - $${part.price}</option>
                                `).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="addPart()">Add Part</button>
                    
                    ${appState.parts.length > 0 ? `
                        <table class="parts-table">
                            <thead>
                                <tr>
                                    <th>Part Name</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                ${appState.parts.map((part, index) => `
                                    <tr>
                                        <td>${part.name}</td>
                                        <td>
                                            <input type="number" 
                                                   value="${part.quantity}" 
                                                   min="1" 
                                                   style="width: 60px; padding: 0.25rem;"
                                                   onchange="updatePartQuantity(${index}, this.value)">
                                        </td>
                                        <td>$${part.price.toFixed(2)}</td>
                                        <td>$${(part.quantity * part.price).toFixed(2)}</td>
                                        <td>
                                            <button class="btn btn-secondary" 
                                                    style="padding: 0.25rem 0.5rem; font-size: 0.875rem;"
                                                    onclick="removePart(${index})">Remove</button>
                                        </td>
                                    </tr>
                                `).join('')}
                                <tr style="font-weight: 700; border-top: 2px solid var(--gray-300);">
                                    <td colspan="3" style="text-align: right;">Total Parts:</td>
                                    <td colspan="2">$${total.toFixed(2)}</td>
                                </tr>
                            </tbody>
                        </table>
                    ` : `
                        <div class="alert alert-info" style="margin-top: 1rem;">
                            No parts added yet. Select parts used during this service call.
                        </div>
                    `}
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateTo('photos')">Back</button>
                    <button class="btn btn-primary" onclick="navigateTo('recommendations')">Continue to Recommendations</button>
                </div>
            `;
        }

        function addPart() {
            const select = document.getElementById('partSelect');
            const index = parseInt(select.value);
            
            if (index >= 0) {
                const part = COMMON_PARTS[index];
                const existing = appState.parts.find(p => p.name === part.name);
                
                if (existing) {
                    existing.quantity++;
                } else {
                    appState.parts.push({ ...part, quantity: 1 });
                }
                
                select.value = '';
                render();
            }
        }

        function removePart(index) {
            appState.parts.splice(index, 1);
            render();
        }

        function updatePartQuantity(index, quantity) {
            appState.parts[index].quantity = parseInt(quantity) || 1;
            render();
        }

        function renderRecommendations() {
            return `
                <div class="card">
                    <div class="card-header">Customer Recommendations</div>
                    
                    <div class="alert alert-info">
                        Select recommendations based on inspection findings. These will appear on the customer report.
                    </div>
                    
                    <div class="checkbox-group">
                        ${RECOMMENDATIONS.map(rec => {
                            const isChecked = appState.recommendations.includes(rec.id);
                            return `
                                <div class="checkbox-item">
                                    <input type="checkbox" 
                                           id="rec-${rec.id}" 
                                           ${isChecked ? 'checked' : ''}
                                           onchange="toggleRecommendation('${rec.id}')">
                                    <label for="rec-${rec.id}">
                                        <strong>${rec.text}</strong>
                                        ${rec.price ? `<br><span style="color: var(--gray-600); font-size: 0.875rem;">Estimated: $${rec.price}</span>` : ''}
                                        <br><span style="color: var(--gray-600); font-size: 0.75rem; text-transform: uppercase;">${rec.category}</span>
                                    </label>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateTo('parts')">Back</button>
                    <button class="btn btn-success" onclick="navigateTo('summary')">Complete Job</button>
                </div>
            `;
        }

        function toggleRecommendation(id) {
            const index = appState.recommendations.indexOf(id);
            if (index > -1) {
                appState.recommendations.splice(index, 1);
            } else {
                appState.recommendations.push(id);
            }
            saveState();
        }

        function renderSummary() {
            const deltaT = calculateDeltaT();
            const subcool = calculateSubcooling();
            const superheat = calculateSuperheat();
            const approach = calculateApproach();
            
            const partsTotal = appState.parts.reduce((sum, part) => sum + (part.quantity * part.price), 0);
            const recommendationsTotal = appState.recommendations
                .map(id => RECOMMENDATIONS.find(r => r.id === id))
                .filter(r => r && r.price)
                .reduce((sum, r) => sum + r.price, 0);
            
            return `
                <div class="alert alert-success">
                    <strong>✓ Job Complete!</strong> Review the summary below and get customer signature.
                </div>
                
                <div class="card">
                    <div class="card-header">Service Summary - ${appState.currentJob.customer}</div>
                    
                    <div style="margin-bottom: 1rem;">
                        <strong>Job ID:</strong> ${appState.currentJob.id}<br>
                        <strong>Date:</strong> ${new Date().toLocaleDateString()}<br>
                        <strong>Technician:</strong> ${document.getElementById('techName').textContent}
                    </div>
                    
                    <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--primary);">
                        System Readings
                    </h3>
                    
                    <div class="readings-grid">
                        ${deltaT ? `
                            <div class="reading-card">
                                <div class="reading-label">Delta T</div>
                                <div class="reading-value">${deltaT}°F</div>
                            </div>
                        ` : ''}
                        ${subcool ? `
                            <div class="reading-card">
                                <div class="reading-label">Subcooling</div>
                                <div class="reading-value">${subcool}°F</div>
                            </div>
                        ` : ''}
                        ${superheat ? `
                            <div class="reading-card">
                                <div class="reading-label">Superheat</div>
                                <div class="reading-value">${superheat}°F</div>
                            </div>
                        ` : ''}
                        ${approach ? `
                            <div class="reading-card">
                                <div class="reading-label">Approach</div>
                                <div class="reading-value">${approach}°F</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                ${appState.parts.length > 0 ? `
                    <div class="card">
                        <div class="card-header">Parts Used</div>
                        <table class="parts-table">
                            <thead>
                                <tr>
                                    <th>Part</th>
                                    <th>Qty</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${appState.parts.map(part => `
                                    <tr>
                                        <td>${part.name}</td>
                                        <td>${part.quantity}</td>
                                        <td>$${(part.quantity * part.price).toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                                <tr style="font-weight: 700;">
                                    <td colspan="2">Parts Total:</td>
                                    <td>$${partsTotal.toFixed(2)}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                ` : ''}
                
                ${appState.recommendations.length > 0 ? `
                    <div class="card">
                        <div class="card-header">Recommendations</div>
                        <ul style="margin-left: 1.5rem;">
                            ${appState.recommendations.map(id => {
                                const rec = RECOMMENDATIONS.find(r => r.id === id);
                                return `<li style="margin-bottom: 0.5rem;">
                                    ${rec.text}
                                    ${rec.price ? ` - <strong>$${rec.price}</strong>` : ''}
                                </li>`;
                            }).join('')}
                        </ul>
                        ${recommendationsTotal > 0 ? `
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--gray-200); font-weight: 700;">
                                Estimated Investment: $${recommendationsTotal.toFixed(2)}
                            </div>
                        ` : ''}
                    </div>
                ` : ''}
                
                ${appState.techNotes ? `
                    <div class="card">
                        <div class="card-header">Technician Notes</div>
                        <p style="white-space: pre-wrap;">${appState.techNotes}</p>
                    </div>
                ` : ''}
                
                ${appState.photos.length > 0 ? `
                    <div class="card">
                        <div class="card-header">Documentation Photos (${appState.photos.length})</div>
                        <div class="photo-grid">
                            ${appState.photos.map(photo => `
                                <div class="photo-item">
                                    <img src="${photo}" alt="Job photo">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div class="card">
                    <div class="card-header">Customer Signature</div>
                    ${appState.signature ? `
                        <img src="${appState.signature}" alt="Customer signature" style="max-width: 400px; border: 1px solid var(--gray-300); border-radius: 0.5rem;">
                        <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="openSignatureModal()">
                            Re-capture Signature
                        </button>
                    ` : `
                        <button class="btn btn-primary btn-block" onclick="openSignatureModal()">
                            Get Customer Signature
                        </button>
                    `}
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateTo('recommendations')">Back</button>
                    <button class="btn btn-primary" onclick="emailReport()">Email Report to Customer</button>
                    <button class="btn btn-success" onclick="completeJob()">Complete & Return to Dashboard</button>
                </div>
            `;
        }

        // ==================== INTERACTION HANDLERS ====================
        
        function startJob(jobId) {
            appState.currentJob = appState.jobs.find(j => j.id === jobId);
            appState.currentView = 'customer';
            appState.startTime = new Date();
            render();
            startJobTimer();
        }

        function updateJob(field, value) {
            appState.currentJob[field] = value;
            saveState();
        }

        function updateCustomerNotes(value) {
            appState.customerNotes = value;
            saveState();
        }

        function updateEquipment(unit, field, value) {
            appState.currentJob.equipment[unit][field] = value;
            saveState();
        }

        function toggleTimer() {
            if (!appState.startTime) {
                appState.startTime = new Date();
                startJobTimer();
            } else if (!appState.endTime) {
                appState.endTime = new Date();
            } else {
                appState.startTime = new Date();
                appState.endTime = null;
                startJobTimer();
            }
            render();
        }

        let timerInterval;

        function startJobTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                const timer = document.getElementById('jobTimer');
                if (timer && appState.startTime && !appState.endTime) {
                    const elapsed = Math.floor((new Date() - new Date(appState.startTime)) / 1000);
                    const hours = Math.floor(elapsed / 3600);
                    const minutes = Math.floor((elapsed % 3600) / 60);
                    const seconds = elapsed % 60;
                    timer.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
            }, 1000);
        }

        // Signature functionality
        let signaturePadCanvas, signaturePadContext, isDrawing = false;

        function openSignatureModal() {
            const modal = document.getElementById('signatureModal');
            modal.classList.add('active');
            
            signaturePadCanvas = document.getElementById('signaturePad');
            signaturePadContext = signaturePadCanvas.getContext('2d');
            
            signaturePadContext.strokeStyle = '#000';
            signaturePadContext.lineWidth = 2;
            signaturePadContext.lineCap = 'round';
            
            signaturePadCanvas.addEventListener('mousedown', startDrawing);
            signaturePadCanvas.addEventListener('mousemove', draw);
            signaturePadCanvas.addEventListener('mouseup', stopDrawing);
            signaturePadCanvas.addEventListener('mouseout', stopDrawing);
            
            signaturePadCanvas.addEventListener('touchstart', handleTouchStart);
            signaturePadCanvas.addEventListener('touchmove', handleTouchMove);
            signaturePadCanvas.addEventListener('touchend', stopDrawing);
        }

        function closeSignatureModal() {
            document.getElementById('signatureModal').classList.remove('active');
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = signaturePadCanvas.getBoundingClientRect();
            signaturePadContext.beginPath();
            signaturePadContext.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = signaturePadCanvas.getBoundingClientRect();
            signaturePadContext.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            signaturePadContext.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = signaturePadCanvas.getBoundingClientRect();
            isDrawing = true;
            signaturePadContext.beginPath();
            signaturePadContext.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;
            const touch = e.touches[0];
            const rect = signaturePadCanvas.getBoundingClientRect();
            signaturePadContext.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
            signaturePadContext.stroke();
        }

        function clearSignature() {
            signaturePadContext.clearRect(0, 0, signaturePadCanvas.width, signaturePadCanvas.height);
        }

        function saveSignature() {
            appState.signature = signaturePadCanvas.toDataURL();
            closeSignatureModal();
            render();
        }

        function emailReport() {
            alert('Report would be emailed to customer. In production, this would generate a PDF and send via email service.');
        }

        function completeJob() {
            if (!appState.signature) {
                if (!confirm('No customer signature captured. Complete job anyway?')) {
                    return;
                }
            }
            
            // Reset state
            appState.currentJob = null;
            appState.currentView = 'dashboard';
            appState.inspectionData = { indoor: {}, outdoor: {}, electrical: {}, safety: {} };
            appState.photos = [];
            appState.parts = [];
            appState.recommendations = [];
            appState.startTime = null;
            appState.endTime = null;
            appState.signature = null;
            appState.techNotes = '';
            appState.customerNotes = '';
            
            if (timerInterval) clearInterval(timerInterval);
            
            render();
            alert('Job completed successfully!');
        }

        // ==================== INITIALIZATION ====================
        
        function init() {
            loadState();
            render();
            
            // Auto-save every 30 seconds
            setInterval(saveState, 30000);
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
```
